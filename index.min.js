!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).forceDirectedGraph=e()}(this,(function(){"use strict";var t={csv:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=t.join(", ");return e&&(n=n.replace(/, ([^,]*)$/," and $1")),n}};function e(){return["#a50026","#f46d43","#fdae61","#a6d96a","#66bd63","#006837"].reverse()}function n(){var t=e();return d3.scaleLinear().domain(d3.range(t.length)).range(t).clamp(!0)}var i={update:function(){var t=this;this.settings.text=[].concat(this.settings.explanation.filter((function(e){return!(t.settings.hideControls&&e.includes("controls"))}))).concat(this.settings.information).filter((function(t){return"string"==typeof t}))},id_var:"id",event_var:"event",event_order_var:"event_order",start_timepoint_var:"stdy",end_timepoint_var:"endy",duration_var:"duration",sequence_var:"seq",timepoint:0,timeUnit:"days since randomization",duration:null,resetDelay:15e3,events:null,eventCentral:null,eventCount:!0,eventChangeCount:null,eventChangeCountAesthetic:"color",drawStaticSeparately:!0,speed:"medium",speeds:{slow:1e3,medium:500,fast:100},playPause:"play",width:null,height:null,padding:1,nOrbits:null,orbitRadius:150,chargeStrength:null,nFoci:null,translate:!1,hideControls:!1,colorBy:{type:"frequency",variable:null,label:null},colors:e,colorScale:n,color:function(t){return n()(Math.min(t,n().domain().length))},fill:null,minRadius:null,maxRadius:null,shape:"circle",modal:!0,modalSpeed:15e3,modalIndex:0,explanation:["Each bubble in this animation represents an individual.","As individuals experience events and change states, their bubble gravitates toward the focus representing that event.","The number of state changes dictates the color and/or size of the bubbles.","Static bubbles represent individuals whose state never changes.","Use the controls on the right to interact with and alter the animation."],information:null};function r(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function a(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function o(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?a(Object(n),!0).forEach((function(e){r(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function s(t){return function(t){if(Array.isArray(t))return u(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||c(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(t,e){if(t){if("string"==typeof t)return u(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?u(t,e):void 0}}function u(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function l(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=c(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function h(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"div",i=e.append(n).classed("fdg-".concat(t),!0);return i}function f(t){var e=h("controls",t).classed("fdg-hidden",this.settings.hideControls);h("hide",e,"span");return{controls:e}}var d="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var p=function(t,e,n){return t(n={path:e,exports:{},require:function(t,e){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==e&&n.path)}},n.exports),n.exports}((function(t,e){
/*! Shifty 2.12.0 - https://github.com/jeremyckahn/shifty */
var n;n=function(){return function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){n.r(e),n.d(e,"processTweens",(function(){return it})),n.d(e,"Tweenable",(function(){return ot})),n.d(e,"tween",(function(){return st})),n.d(e,"interpolate",(function(){return Ft})),n.d(e,"Scene",(function(){return Lt})),n.d(e,"setBezierFunction",(function(){return Ut})),n.d(e,"unsetBezierFunction",(function(){return Qt}));var i={};n.r(i),n.d(i,"linear",(function(){return a})),n.d(i,"easeInQuad",(function(){return o})),n.d(i,"easeOutQuad",(function(){return s})),n.d(i,"easeInOutQuad",(function(){return c})),n.d(i,"easeInCubic",(function(){return u})),n.d(i,"easeOutCubic",(function(){return l})),n.d(i,"easeInOutCubic",(function(){return h})),n.d(i,"easeInQuart",(function(){return f})),n.d(i,"easeOutQuart",(function(){return p})),n.d(i,"easeInOutQuart",(function(){return g})),n.d(i,"easeInQuint",(function(){return v})),n.d(i,"easeOutQuint",(function(){return y})),n.d(i,"easeInOutQuint",(function(){return m})),n.d(i,"easeInSine",(function(){return _})),n.d(i,"easeOutSine",(function(){return b})),n.d(i,"easeInOutSine",(function(){return w})),n.d(i,"easeInExpo",(function(){return x})),n.d(i,"easeOutExpo",(function(){return S})),n.d(i,"easeInOutExpo",(function(){return C})),n.d(i,"easeInCirc",(function(){return k})),n.d(i,"easeOutCirc",(function(){return O})),n.d(i,"easeInOutCirc",(function(){return A})),n.d(i,"easeOutBounce",(function(){return P})),n.d(i,"easeInBack",(function(){return j})),n.d(i,"easeOutBack",(function(){return M})),n.d(i,"easeInOutBack",(function(){return E})),n.d(i,"elastic",(function(){return T})),n.d(i,"swingFromTo",(function(){return R})),n.d(i,"swingFrom",(function(){return I})),n.d(i,"swingTo",(function(){return F})),n.d(i,"bounce",(function(){return q})),n.d(i,"bouncePast",(function(){return N})),n.d(i,"easeFromTo",(function(){return W})),n.d(i,"easeFrom",(function(){return B})),n.d(i,"easeTo",(function(){return D}));var r={};n.r(r),n.d(r,"doesApply",(function(){return Ot})),n.d(r,"tweenCreated",(function(){return At})),n.d(r,"beforeTween",(function(){return Pt})),n.d(r,"afterTween",(function(){return jt}));
/*!
                         * All equations are adapted from Thomas Fuchs'
                         * [Scripty2](https://github.com/madrobby/scripty2/blob/master/src/effects/transitions/penner.js).
                         *
                         * Based on Easing Equations (c) 2003 [Robert
                         * Penner](http://www.robertpenner.com/), all rights reserved. This work is
                         * [subject to terms](http://www.robertpenner.com/easing_terms_of_use.html).
                         */
/*!
                         *  TERMS OF USE - EASING EQUATIONS
                         *  Open source under the BSD License.
                         *  Easing Equations (c) 2003 Robert Penner, all rights reserved.
                         */
var a=function(t){return t},o=function(t){return Math.pow(t,2)},s=function(t){return-(Math.pow(t-1,2)-1)},c=function(t){return(t/=.5)<1?.5*Math.pow(t,2):-.5*((t-=2)*t-2)},u=function(t){return Math.pow(t,3)},l=function(t){return Math.pow(t-1,3)+1},h=function(t){return(t/=.5)<1?.5*Math.pow(t,3):.5*(Math.pow(t-2,3)+2)},f=function(t){return Math.pow(t,4)},p=function(t){return-(Math.pow(t-1,4)-1)},g=function(t){return(t/=.5)<1?.5*Math.pow(t,4):-.5*((t-=2)*Math.pow(t,3)-2)},v=function(t){return Math.pow(t,5)},y=function(t){return Math.pow(t-1,5)+1},m=function(t){return(t/=.5)<1?.5*Math.pow(t,5):.5*(Math.pow(t-2,5)+2)},_=function(t){return 1-Math.cos(t*(Math.PI/2))},b=function(t){return Math.sin(t*(Math.PI/2))},w=function(t){return-.5*(Math.cos(Math.PI*t)-1)},x=function(t){return 0===t?0:Math.pow(2,10*(t-1))},S=function(t){return 1===t?1:1-Math.pow(2,-10*t)},C=function(t){return 0===t?0:1===t?1:(t/=.5)<1?.5*Math.pow(2,10*(t-1)):.5*(2-Math.pow(2,-10*--t))},k=function(t){return-(Math.sqrt(1-t*t)-1)},O=function(t){return Math.sqrt(1-Math.pow(t-1,2))},A=function(t){return(t/=.5)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},P=function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},j=function(t){var e=1.70158;return t*t*((e+1)*t-e)},M=function(t){var e=1.70158;return(t-=1)*t*((e+1)*t+e)+1},E=function(t){var e=1.70158;return(t/=.5)<1?t*t*((1+(e*=1.525))*t-e)*.5:.5*((t-=2)*t*((1+(e*=1.525))*t+e)+2)},T=function(t){return-1*Math.pow(4,-8*t)*Math.sin((6*t-1)*(2*Math.PI)/2)+1},R=function(t){var e=1.70158;return(t/=.5)<1?t*t*((1+(e*=1.525))*t-e)*.5:.5*((t-=2)*t*((1+(e*=1.525))*t+e)+2)},I=function(t){var e=1.70158;return t*t*((e+1)*t-e)},F=function(t){var e=1.70158;return(t-=1)*t*((e+1)*t+e)+1},q=function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},N=function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?2-(7.5625*(t-=1.5/2.75)*t+.75):t<2.5/2.75?2-(7.5625*(t-=2.25/2.75)*t+.9375):2-(7.5625*(t-=2.625/2.75)*t+.984375)},W=function(t){return(t/=.5)<1?.5*Math.pow(t,4):-.5*((t-=2)*Math.pow(t,3)-2)},B=function(t){return Math.pow(t,4)},D=function(t){return Math.pow(t,.25)};function z(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return L(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?L(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function L(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function V(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function U(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Q(t){return(Q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function $(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function Y(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?$(Object(n),!0).forEach((function(e){X(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):$(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function X(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var H="undefined"!=typeof window?window:d,G=H.requestAnimationFrame||H.webkitRequestAnimationFrame||H.oRequestAnimationFrame||H.msRequestAnimationFrame||H.mozCancelRequestAnimationFrame&&H.mozRequestAnimationFrame||setTimeout,J=function(){},K=null,Z=null,tt=Y({},i),et=function(t,e,n,i,r,a,o){var s=t<a?0:(t-a)/r;for(var c in e){var u=o[c],l=u.call?u:tt[u],h=n[c];e[c]=h+(i[c]-h)*l(s)}return e},nt=function(t,e){var n=t._data,i=t._currentState,r=t._delay,a=t._easing,o=t._originalState,s=t._duration,c=t._render,u=t._targetState,l=t._timestamp,h=l+r+s,f=e>h?h:e,d=s-(h-f);f>=h?(c(u,n,d),t.stop(!0)):(t._applyFilter("beforeTween"),f<l+r?(f=1,s=1,l=1):l+=r,et(f,i,o,u,s,l,a),t._applyFilter("afterTween"),c(i,n,d))},it=function(){for(var t=ot.now(),e=K;e;){var n=e._next;nt(e,t),e=n}},rt=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"linear",n={},i=Q(e);if("string"===i||"function"===i)for(var r in t)n[r]=e;else for(var a in t)n[a]=e[a]||"linear";return n},at=function(t){if(t===K)(K=t._next)?K._previous=null:Z=null;else if(t===Z)(Z=t._previous)?Z._next=null:K=null;else{var e=t._previous,n=t._next;e._next=n,n._previous=e}t._previous=t._next=null},ot=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;V(this,t),X(this,"_config",null),X(this,"_data",{}),X(this,"_filters",[]),X(this,"_next",null),X(this,"_previous",null),X(this,"_timestamp",null),X(this,"_resolve",null),X(this,"_reject",null),this._currentState=e,n&&this.setConfig(n)}var e,n,i;return e=t,(n=[{key:"_applyFilter",value:function(t){var e,n=z(this._filters);try{for(n.s();!(e=n.n()).done;){var i=e.value[t];i&&i(this)}}catch(t){n.e(t)}finally{n.f()}}},{key:"tween",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,n=this._data,i=this._config;return this._isPlaying&&this.stop(),!e&&i||this.setConfig(e),this._pausedAtTime=null,this._timestamp=t.now(),this._start(this.get(),n),this.resume()}},{key:"setConfig",value:function(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=Y(Y({},this._config),n),r=this._config=i,a=r.attachment,o=r.data,s=r.duration,c=void 0===s?500:s,u=r.easing,l=r.promise,h=void 0===l?Promise:l,f=r.start,d=void 0===f?J:f,p=r.render,g=void 0===p?i.step||J:p,v=r.step,y=void 0===v?J:v,m=n.delay,_=void 0===m?0:m,b=n.from,w=n.to;this._data=o||a||this._data,this._isPlaying=!1,this._pausedAtTime=null,this._scheduleId=null,this._delay=_,this._start=d,this._render=g||y,this._duration=c,this._currentState=Y({},b||this.get()),this._originalState=this.get(),this._targetState=Y({},w||this.get());var x=this._currentState;this._targetState=Y(Y({},x),this._targetState),this._easing=rt(x,u);var S=t.filters;for(var C in this._filters.length=0,S)S[C].doesApply(this)&&this._filters.push(S[C]);return this._applyFilter("tweenCreated"),this._promise=new h((function(t,n){e._resolve=t,e._reject=n})),this._promise.catch(J),this}},{key:"get",value:function(){return Y({},this._currentState)}},{key:"set",value:function(t){this._currentState=t}},{key:"pause",value:function(){if(this._isPlaying)return this._pausedAtTime=t.now(),this._isPlaying=!1,at(this),this}},{key:"resume",value:function(){if(null===this._timestamp)return this.tween();if(this._isPlaying)return this._promise;var e=t.now();return this._pausedAtTime&&(this._timestamp+=e-this._pausedAtTime,this._pausedAtTime=null),this._isPlaying=!0,null===K?(K=this,Z=this,function t(){K&&(G.call(H,t,1e3/60),it())}()):(this._previous=Z,Z._next=this,Z=this),this._promise}},{key:"seek",value:function(e){e=Math.max(e,0);var n=t.now();return this._timestamp+e===0||(this._timestamp=n-e,this._isPlaying||nt(this,n)),this}},{key:"stop",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=this._currentState,n=this._data,i=this._easing,r=this._originalState,a=this._resolve,o=this._targetState;return this._isPlaying?(this._isPlaying=!1,at(this),t&&(this._applyFilter("beforeTween"),et(1,e,r,o,1,0,i),this._applyFilter("afterTween"),this._applyFilter("afterTweenEnd")),a&&a({data:n,state:e,tweenable:this}),this._resolve=null,this._reject=null,this):this}},{key:"cancel",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=this._currentState,n=this._data,i=this._isPlaying;return i?(this._reject({data:n,state:e,tweenable:this}),this._resolve=null,this._reject=null,this.stop(t)):this}},{key:"isPlaying",value:function(){return this._isPlaying}},{key:"setScheduleFunction",value:function(e){t.setScheduleFunction(e)}},{key:"data",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return t&&(this._data=Y({},t)),this._data}},{key:"dispose",value:function(){for(var t in this)delete this[t]}}])&&U(e.prototype,n),i&&U(e,i),t}();function st(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=new ot,n=e.tween(t);return n.tweenable=e,n}ot.setScheduleFunction=function(t){return G=t},ot.formulas=tt,ot.filters={},ot.now=Date.now||function(){return+new Date};var ct,ut,lt=/(\d|-|\.)/,ht=/([^\-0-9.]+)/g,ft=/[0-9.-]+/g,dt=(ct=ft.source,ut=/,\s*/.source,new RegExp("rgb\\(".concat(ct).concat(ut).concat(ct).concat(ut).concat(ct,"\\)"),"g")),pt=/^.*\(/,gt=/#([0-9]|[a-f]){3,6}/gi,vt=function(t,e){return t.map((function(t,n){return"_".concat(e,"_").concat(n)}))};function yt(t){return parseInt(t,16)}var mt=function(t){return"rgb(".concat((e=t,3===(e=e.replace(/#/,"")).length&&(e=(e=e.split(""))[0]+e[0]+e[1]+e[1]+e[2]+e[2]),[yt(e.substr(0,2)),yt(e.substr(2,2)),yt(e.substr(4,2))]).join(","),")");var e},_t=function(t,e,n){var i=e.match(t),r=e.replace(t,"VAL");return i&&i.forEach((function(t){return r=r.replace("VAL",n(t))})),r},bt=function(t){for(var e in t){var n=t[e];"string"==typeof n&&n.match(gt)&&(t[e]=_t(gt,n,mt))}},wt=function(t){var e=t.match(ft).map(Math.floor),n=t.match(pt)[0];return"".concat(n).concat(e.join(","),")")},xt=function(t){return t.match(ft)},St=function(t,e){var n={};return e.forEach((function(e){n[e]=t[e],delete t[e]})),n},Ct=function(t,e){return e.map((function(e){return t[e]}))},kt=function(t,e){return e.forEach((function(e){return t=t.replace("VAL",+e.toFixed(4))})),t},Ot=function(t){var e=t._currentState;return Object.keys(e).some((function(t){return"string"==typeof e[t]}))};function At(t){var e=t._currentState;[e,t._originalState,t._targetState].forEach(bt),t._tokenData=function(t){var e,n,i={};for(var r in t){var a=t[r];"string"==typeof a&&(i[r]={formatString:(e=a,n=void 0,n=e.match(ht),n?(1===n.length||e.charAt(0).match(lt))&&n.unshift(""):n=["",""],n.join("VAL")),chunkNames:vt(xt(a),r)})}return i}(e)}function Pt(t){var e=t._currentState,n=t._originalState,i=t._targetState,r=t._easing,a=t._tokenData;!function(t,e){var n=function(n){var i=e[n].chunkNames,r=t[n];if("string"==typeof r){var a=r.split(" "),o=a[a.length-1];i.forEach((function(e,n){return t[e]=a[n]||o}))}else i.forEach((function(e){return t[e]=r}));delete t[n]};for(var i in e)n(i)}(r,a),[e,n,i].forEach((function(t){return function(t,e){var n=function(n){xt(t[n]).forEach((function(i,r){return t[e[n].chunkNames[r]]=+i})),delete t[n]};for(var i in e)n(i)}(t,a)}))}function jt(t){var e=t._currentState,n=t._originalState,i=t._targetState,r=t._easing,a=t._tokenData;[e,n,i].forEach((function(t){return function(t,e){for(var n in e){var i=e[n],r=i.chunkNames,a=i.formatString,o=kt(a,Ct(St(t,r),r));t[n]=_t(dt,o,wt)}}(t,a)})),function(t,e){for(var n in e){var i=e[n].chunkNames,r=t[i[0]];t[n]="string"==typeof r?i.map((function(e){var n=t[e];return delete t[e],n})).join(" "):r}}(r,a)}function Mt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function Et(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Mt(Object(n),!0).forEach((function(e){Tt(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Mt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function Tt(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Rt=new ot,It=ot.filters,Ft=function(t,e,n,i){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=Et({},t),o=rt(t,i);for(var s in Rt._filters.length=0,Rt.set({}),Rt._currentState=a,Rt._originalState=t,Rt._targetState=e,Rt._easing=o,It)It[s].doesApply(Rt)&&Rt._filters.push(It[s]);Rt._applyFilter("tweenCreated"),Rt._applyFilter("beforeTween");var c=et(n,a,t,e,1,r,o);return Rt._applyFilter("afterTween"),c};function qt(t){return function(t){if(Array.isArray(t))return Nt(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return Nt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Nt(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Nt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function Wt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Bt(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Dt(t,e){var n=e.get(t);if(!n)throw new TypeError("attempted to get private field on non-instance");return n.get?n.get.call(t):n.value}var zt=new WeakMap,Lt=function(){function t(){Wt(this,t),zt.set(this,{writable:!0,value:[]});for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];n.forEach(this.add.bind(this))}var e,n,i;return e=t,(n=[{key:"add",value:function(t){return Dt(this,zt).push(t),t}},{key:"remove",value:function(t){var e=Dt(this,zt).indexOf(t);return~e&&Dt(this,zt).splice(e,1),t}},{key:"empty",value:function(){return this.tweenables.map(this.remove.bind(this))}},{key:"isPlaying",value:function(){return Dt(this,zt).some((function(t){return t.isPlaying()}))}},{key:"play",value:function(){return Dt(this,zt).forEach((function(t){return t.tween()})),this}},{key:"pause",value:function(){return Dt(this,zt).forEach((function(t){return t.pause()})),this}},{key:"resume",value:function(){return Dt(this,zt).forEach((function(t){return t.resume()})),this}},{key:"stop",value:function(t){return Dt(this,zt).forEach((function(e){return e.stop(t)})),this}},{key:"tweenables",get:function(){return qt(Dt(this,zt))}},{key:"promises",get:function(){return Dt(this,zt).map((function(t){return t._promise}))}}])&&Bt(e.prototype,n),i&&Bt(e,i),t}();function Vt(t,e,n,i,r,a){var o,s,c=0,u=0,l=0,h=0,f=0,d=0,p=function(t){return((c*t+u)*t+l)*t},g=function(t){return(3*c*t+2*u)*t+l},v=function(t){return t>=0?t:0-t};return c=1-(l=3*e)-(u=3*(i-e)-l),h=1-(d=3*n)-(f=3*(r-n)-d),o=t,s=function(t){return 1/(200*t)}(a),function(t){return((h*t+f)*t+d)*t}(function(t,e){var n,i,r,a,o,s;for(r=t,s=0;s<8;s++){if(a=p(r)-t,v(a)<e)return r;if(o=g(r),v(o)<1e-6)break;r-=a/o}if((r=t)<(n=0))return n;if(r>(i=1))return i;for(;n<i;){if(a=p(r),v(a-t)<e)return r;t>a?n=r:i=r,r=.5*(i-n)+n}return r}(o,s))}var Ut=function(t,e,n,i,r){var a=function(t,e,n,i){return function(r){return Vt(r,t,e,n,i,1)}}(e,n,i,r);return a.displayName=t,a.x1=e,a.y1=n,a.x2=i,a.y2=r,ot.formulas[t]=a},Qt=function(t){return delete ot.formulas[t]};ot.filters.token=r}])},t.exports=n()})),g="Webkit Moz O ms".split(" ");function v(t,e,n){for(var i=t.style,r=0;r<g.length;++r){i[g[r]+y(e)]=n}i[e]=n}function y(t){return t.charAt(0).toUpperCase()+t.slice(1)}function m(t){return!function(t){return"[object Array]"===Object.prototype.toString.call(t)}(t)&&("object"===typeof t&&!!t)}function _(t,e){for(var n in t){if(t.hasOwnProperty(n))e(t[n],n)}}var b={extend:function t(e,n,i){for(var r in e=e||{},i=i||!1,n=n||{})if(n.hasOwnProperty(r)){var a=e[r],o=n[r];i&&m(a)&&m(o)?e[r]=t(a,o,i):e[r]=o}return e},render:function(t,e){var n=t;for(var i in e)if(e.hasOwnProperty(i)){var r=e[i],a=new RegExp("\\{"+i+"\\}","g");n=n.replace(a,r)}return n},setStyle:v,setStyles:function(t,e){_(e,(function(e,n){null!=e&&(m(e)&&!0===e.prefix?v(t,n,e.value):t.style[n]=e)}))},capitalize:y,isString:function(t){return"string"==typeof t||t instanceof String},isFunction:function(t){return"function"==typeof t},isObject:m,forEachObject:_,floatEquals:function(t,e){return Math.abs(t-e)<.001},removeChildren:function(t){for(;t.firstChild;)t.removeChild(t.firstChild)}},w=p.Tweenable,x={easeIn:"easeInCubic",easeOut:"easeOutCubic",easeInOut:"easeInOutCubic"},S=function t(e,n){if(!(this instanceof t))throw new Error("Constructor was called without new keyword");var i;n=b.extend({delay:0,duration:800,easing:"linear",from:{},to:{},step:function(){}},n),i=b.isString(e)?document.querySelector(e):e,this.path=i,this._opts=n,this._tweenable=null;var r=this.path.getTotalLength();this.path.style.strokeDasharray=r+" "+r,this.set(0)};S.prototype.value=function(){var t=this._getComputedDashOffset(),e=this.path.getTotalLength();return parseFloat((1-t/e).toFixed(6),10)},S.prototype.set=function(t){this.stop(),this.path.style.strokeDashoffset=this._progressToOffset(t);var e=this._opts.step;if(b.isFunction(e)){var n=this._easing(this._opts.easing);e(this._calculateTo(t,n),this._opts.shape||this,this._opts.attachment)}},S.prototype.stop=function(){this._stopTween(),this.path.style.strokeDashoffset=this._getComputedDashOffset()},S.prototype.animate=function(t,e,n){e=e||{},b.isFunction(e)&&(n=e,e={});var i=b.extend({},e),r=b.extend({},this._opts);e=b.extend(r,e);var a=this._easing(e.easing),o=this._resolveFromAndTo(t,a,i);this.stop(),this.path.getBoundingClientRect();var s=this._getComputedDashOffset(),c=this._progressToOffset(t),u=this;this._tweenable=new w,this._tweenable.tween({from:b.extend({offset:s},o.from),to:b.extend({offset:c},o.to),duration:e.duration,delay:e.delay,easing:a,step:function(t){u.path.style.strokeDashoffset=t.offset;var n=e.shape||u;e.step(t,n,e.attachment)}}).then((function(t){b.isFunction(n)&&n()}))},S.prototype._getComputedDashOffset=function(){var t=window.getComputedStyle(this.path,null);return parseFloat(t.getPropertyValue("stroke-dashoffset"),10)},S.prototype._progressToOffset=function(t){var e=this.path.getTotalLength();return e-t*e},S.prototype._resolveFromAndTo=function(t,e,n){return n.from&&n.to?{from:n.from,to:n.to}:{from:this._calculateFrom(e),to:this._calculateTo(t,e)}},S.prototype._calculateFrom=function(t){return p.interpolate(this._opts.from,this._opts.to,this.value(),t)},S.prototype._calculateTo=function(t,e){return p.interpolate(this._opts.from,this._opts.to,t,e)},S.prototype._stopTween=function(){null!==this._tweenable&&(this._tweenable.stop(),this._tweenable=null)},S.prototype._easing=function(t){return x.hasOwnProperty(t)?x[t]:t};var C=S,k="Object is destroyed",O=function t(e,n){if(!(this instanceof t))throw new Error("Constructor was called without new keyword");if(0!==arguments.length){this._opts=b.extend({color:"#555",strokeWidth:1,trailColor:null,trailWidth:null,fill:null,text:{style:{color:null,position:"absolute",left:"50%",top:"50%",padding:0,margin:0,transform:{prefix:!0,value:"translate(-50%, -50%)"}},autoStyleContainer:!0,alignToBottom:!0,value:null,className:"progressbar-text"},svgStyle:{display:"block",width:"100%"},warnings:!1},n,!0),b.isObject(n)&&void 0!==n.svgStyle&&(this._opts.svgStyle=n.svgStyle),b.isObject(n)&&b.isObject(n.text)&&void 0!==n.text.style&&(this._opts.text.style=n.text.style);var i,r=this._createSvgView(this._opts);if(!(i=b.isString(e)?document.querySelector(e):e))throw new Error("Container does not exist: "+e);this._container=i,this._container.appendChild(r.svg),this._opts.warnings&&this._warnContainerAspectRatio(this._container),this._opts.svgStyle&&b.setStyles(r.svg,this._opts.svgStyle),this.svg=r.svg,this.path=r.path,this.trail=r.trail,this.text=null;var a=b.extend({attachment:void 0,shape:this},this._opts);this._progressPath=new C(r.path,a),b.isObject(this._opts.text)&&null!==this._opts.text.value&&this.setText(this._opts.text.value)}};O.prototype.animate=function(t,e,n){if(null===this._progressPath)throw new Error(k);this._progressPath.animate(t,e,n)},O.prototype.stop=function(){if(null===this._progressPath)throw new Error(k);void 0!==this._progressPath&&this._progressPath.stop()},O.prototype.pause=function(){if(null===this._progressPath)throw new Error(k);void 0!==this._progressPath&&this._progressPath._tweenable&&this._progressPath._tweenable.pause()},O.prototype.resume=function(){if(null===this._progressPath)throw new Error(k);void 0!==this._progressPath&&this._progressPath._tweenable&&this._progressPath._tweenable.resume()},O.prototype.destroy=function(){if(null===this._progressPath)throw new Error(k);this.stop(),this.svg.parentNode.removeChild(this.svg),this.svg=null,this.path=null,this.trail=null,this._progressPath=null,null!==this.text&&(this.text.parentNode.removeChild(this.text),this.text=null)},O.prototype.set=function(t){if(null===this._progressPath)throw new Error(k);this._progressPath.set(t)},O.prototype.value=function(){if(null===this._progressPath)throw new Error(k);return void 0===this._progressPath?0:this._progressPath.value()},O.prototype.setText=function(t){if(null===this._progressPath)throw new Error(k);null===this.text&&(this.text=this._createTextContainer(this._opts,this._container),this._container.appendChild(this.text)),b.isObject(t)?(b.removeChildren(this.text),this.text.appendChild(t)):this.text.innerHTML=t},O.prototype._createSvgView=function(t){var e=document.createElementNS("http://www.w3.org/2000/svg","svg");this._initializeSvg(e,t);var n=null;(t.trailColor||t.trailWidth)&&(n=this._createTrail(t),e.appendChild(n));var i=this._createPath(t);return e.appendChild(i),{svg:e,path:i,trail:n}},O.prototype._initializeSvg=function(t,e){t.setAttribute("viewBox","0 0 100 100")},O.prototype._createPath=function(t){var e=this._pathString(t);return this._createPathElement(e,t)},O.prototype._createTrail=function(t){var e=this._trailString(t),n=b.extend({},t);return n.trailColor||(n.trailColor="#eee"),n.trailWidth||(n.trailWidth=n.strokeWidth),n.color=n.trailColor,n.strokeWidth=n.trailWidth,n.fill=null,this._createPathElement(e,n)},O.prototype._createPathElement=function(t,e){var n=document.createElementNS("http://www.w3.org/2000/svg","path");return n.setAttribute("d",t),n.setAttribute("stroke",e.color),n.setAttribute("stroke-width",e.strokeWidth),e.fill?n.setAttribute("fill",e.fill):n.setAttribute("fill-opacity","0"),n},O.prototype._createTextContainer=function(t,e){var n=document.createElement("div");n.className=t.text.className;var i=t.text.style;return i&&(t.text.autoStyleContainer&&(e.style.position="relative"),b.setStyles(n,i),i.color||(n.style.color=t.color)),this._initializeTextContainer(t,e,n),n},O.prototype._initializeTextContainer=function(t,e,n){},O.prototype._pathString=function(t){throw new Error("Override this function for each progress bar")},O.prototype._trailString=function(t){throw new Error("Override this function for each progress bar")},O.prototype._warnContainerAspectRatio=function(t){if(this.containerAspectRatio){var e=window.getComputedStyle(t,null),n=parseFloat(e.getPropertyValue("width"),10),i=parseFloat(e.getPropertyValue("height"),10);b.floatEquals(this.containerAspectRatio,n/i)||(console.warn("Incorrect aspect ratio of container","#"+t.id,"detected:",e.getPropertyValue("width")+"(width)","/",e.getPropertyValue("height")+"(height)","=",n/i),console.warn("Aspect ratio of should be",this.containerAspectRatio))}};var A=O,P=function(t,e){this._pathTemplate="M 0,{center} L 100,{center}",A.apply(this,arguments)};(P.prototype=new A).constructor=P,P.prototype._initializeSvg=function(t,e){t.setAttribute("viewBox","0 0 100 "+e.strokeWidth),t.setAttribute("preserveAspectRatio","none")},P.prototype._pathString=function(t){return b.render(this._pathTemplate,{center:t.strokeWidth/2})},P.prototype._trailString=function(t){return this._pathString(t)};var j=P,M=function(t,e){this._pathTemplate="M 50,50 m 0,-{radius} a {radius},{radius} 0 1 1 0,{2radius} a {radius},{radius} 0 1 1 0,-{2radius}",this.containerAspectRatio=1,A.apply(this,arguments)};(M.prototype=new A).constructor=M,M.prototype._pathString=function(t){var e=t.strokeWidth;t.trailWidth&&t.trailWidth>t.strokeWidth&&(e=t.trailWidth);var n=50-e/2;return b.render(this._pathTemplate,{radius:n,"2radius":2*n})},M.prototype._trailString=function(t){return this._pathString(t)};var E=M,T=function(t,e){this._pathTemplate="M 50,50 m -{radius},0 a {radius},{radius} 0 1 1 {2radius},0",this.containerAspectRatio=2,A.apply(this,arguments)};(T.prototype=new A).constructor=T,T.prototype._initializeSvg=function(t,e){t.setAttribute("viewBox","0 0 100 50")},T.prototype._initializeTextContainer=function(t,e,n){t.text.style&&(n.style.top="auto",n.style.bottom="0",t.text.alignToBottom?b.setStyle(n,"transform","translate(-50%, 0)"):b.setStyle(n,"transform","translate(-50%, 50%)"))},T.prototype._pathString=E.prototype._pathString,T.prototype._trailString=E.prototype._trailString;var R=T,I=function(t,e){this._pathTemplate="M 0,{halfOfStrokeWidth} L {width},{halfOfStrokeWidth} L {width},{width} L {halfOfStrokeWidth},{width} L {halfOfStrokeWidth},{strokeWidth}",this._trailTemplate="M {startMargin},{halfOfStrokeWidth} L {width},{halfOfStrokeWidth} L {width},{width} L {halfOfStrokeWidth},{width} L {halfOfStrokeWidth},{halfOfStrokeWidth}",A.apply(this,arguments)};(I.prototype=new A).constructor=I,I.prototype._pathString=function(t){var e=100-t.strokeWidth/2;return b.render(this._pathTemplate,{width:e,strokeWidth:t.strokeWidth,halfOfStrokeWidth:t.strokeWidth/2})},I.prototype._trailString=function(t){var e=100-t.strokeWidth/2;return b.render(this._trailTemplate,{width:e,strokeWidth:t.strokeWidth,halfOfStrokeWidth:t.strokeWidth/2,startMargin:t.strokeWidth/2-t.trailWidth/2})};var F={Line:j,Circle:E,SemiCircle:R,Square:I,Path:C,Shape:A,utils:b};function q(t){return new F.Circle(t.node(),{trailColor:"#ccc",trailWidth:5,easing:"easeInOut",duration:1,text:{autoStyleContainer:!1},from:{color:"#66bd63",width:5},to:{color:"#006837",width:5},step:function(t,e){e.path.setAttribute("stroke",t.color),e.path.setAttribute("stroke-width",t.width),e.setText("".concat(e.value()<.0095?d3.format(".1%")(e.value()):d3.format(".0%")(e.value())," complete"))}})}function N(t){var e=this.settings.resetDelay/1e3;return h("countdown",t).classed("fdg-sidebar__label",!0).selectAll("div").data(d3.range(-1,e)).join("div").text((function(t){return"Looping in ".concat(t+1," second").concat(0===t?"":"s")})).classed("fdg-hidden",(function(t){return t!==e-1})).classed("fdg-invisible",(function(t){return t===e-1}))}function W(t){var e=h("sidebar",t),n=h("legends",e),i=h("progress",e),r=h("timer",i).classed("fdg-sidebar__label",!0);return i.circle=q.call(this,i),{sidebar:e,legends:n,progress:i,timer:r,countdown:N.call(this,i),freqTable:h("freq-table",e)}}function B(t){var e=h("animation",t);this.settings.width=e.node().clientWidth,this.settings.height=e.node().clientHeight;var n=h("svg--background",e,"svg").attr("width",this.settings.width).attr("height",this.settings.height),i=h("canvas",e,"canvas").attr("width",this.settings.width).attr("height",this.settings.height);i.context=i.node().getContext("2d");var r=h("svg--foreground",e,"svg").attr("width",this.settings.width).attr("height",this.settings.height),a=h("modal",e);return{animation:e,svgBackground:n,canvas:i,svgForeground:r,modal:h("modal__text",a)}}function D(t){var e=this;this.settings.orbitRadius=this.settings.width/(t.orbit.length+1);var n=this.settings.orbitRadius/2,i=this.settings.height/2,r=2*Math.PI/(this.settings.nFoci||t.event.length-!!this.settings.eventCentral-1);t.event.forEach((function(t,a){t.radius=t.order*e.settings.orbitRadius,t.theta=0!==t.position?2*Math.PI*t.position/360:a*r,t.x=0===t.order?n:n+t.radius*Math.cos(t.theta),t.y=0===t.order?i:i+t.radius*Math.sin(t.theta)})),t.orbit.forEach((function(t,r){t.cx=n,t.cy=i,t.r=(r+1)*e.settings.orbitRadius}))}function z(){var t=this.containers.animation.node();this.settings.width=t.clientWidth,this.settings.height=this.containers.animation.node().clientHeight,this.containers.svgBackground.attr("width",this.settings.width).attr("height",this.settings.height),this.containers.canvas.attr("width",this.settings.width).attr("height",this.settings.height),this.containers.svgForeground.attr("width",this.settings.width).attr("height",this.settings.height),D.call(this,this.metadata),this.orbits.attr("cx",(function(t){return t.cx})).attr("cy",(function(t){return t.cy})).attr("r",(function(t){return t.r})),this.staticForceSimulation.simulation.force("center",d3.forceCenter(this.settings.orbitRadius/2,this.settings.height/2)).force("x",d3.forceX(this.settings.orbitRadius/2).strength(.3)).force("y",d3.forceY(this.settings.height/2).strength(.3));for(var e=0;e<30;e++)this.staticForceSimulation.simulation.tick();this.staticForceSimulation.nodes.attr("cx",(function(t){return t.x})).attr("cy",(function(t){return t.y})),this.metadata.event.forEach((function(t){t.forceSimulation.forEach((function(e){e.force("x",d3.forceX(t.x).strength(.3)).force("y",d3.forceY(t.y).strength(.3))}))})),this.focusAnnotations.attr("transform",(function(t){return"translate(".concat(t.x,",").concat(t.y,")")}))}function L(){var t=h("main",d3.select(this.element)),e=f.call(this,t),n=W.call(this,t),i=B.call(this,t);return window.addEventListener("resize",z.bind(this)),o(o(o({main:t},e),n),i)}function V(){var t=d3.nest().key((function(t){return t.id})).rollup((function(t){return{duration:d3.sum(t,(function(t){return+t.duration})),static:1===t.length}})).entries(this.data);return t.forEach((function(t,e){Object.assign(t,t.value),t.value=t.key,t.duration=t.value,delete t.key})),t}function U(){var t=d3.nest().key((function(t){return t.event})).rollup((function(t){var e=t[0];return{order:parseInt(e.event_order),position:e.hasOwnProperty("event_position")?parseInt(e.event_position):0,count:0,prevCount:0,cumulative:0,nEvents:t.length}})).entries(this.data);return t.forEach((function(t){Object.assign(t,t.value),t.value=t.key,delete t.key})),t.sort((function(t,e){return t.order-e.order||e.nEvents-t.nEvents})),t}function Q(t){var e=this;return d3.nest().key((function(t){return t.order})).entries(t.filter((function(t){return t.value!==e.settings.eventCentral})))}function $(){var t=this,e={};e.id=V.call(this),this.settings.duration=this.settings.duration||d3.max(e.id,(function(t){return t.duration})),this.settings.minRadius=this.settings.minRadius||3e3/e.id.filter((function(e){return!(t.settings.drawStaticSeparately&&e.static)})).length,this.settings.staticRadius=this.settings.staticRadius||3e3/e.id.length,this.settings.maxRadius=this.settings.maxRadius||this.settings.minRadius+this.settings.colors().length,this.settings.chargeStrength=-2e3/e.id.filter((function(e){return!(t.settings.drawStaticSeparately&&e.static)})).length,this.settings.staticChargeStrength=-2e3/e.id.length,this.settings.fill=this.settings.fill||e.id.length<=2500,e.event=U.call(this),this.settings.eventCentral=this.settings.eventCentral||e.event[0].value,this.settings.nFoci=this.settings.nFoci||e.event.length-!!this.settings.eventCentral,this.settings.eventChangeCount=this.settings.eventChangeCount||e.event.slice(1).map((function(t){return t.value})),e.orbit=Q.call(this,e.event),D.call(this,e);var n,i=this.settings.colors();if("frequency"===this.settings.colorBy.type)n=d3.range(i.length),this.colorScale=d3.scaleLinear().domain(n).range(i).clamp(!0);else if("continuous"===this.settings.colorBy.type){n=d3.extent(this.data,(function(e){return e[t.settings.colorBy.variable]})),this.colorScale=d3.scaleSequential(d3.interpolateRdYlGn).domain(n);var r=this.colorScale.interpolator();this.settings.colorBy.mirror&&this.colorScale.interpolator((function(t){return r(1-t)}))}else if("categorical"===this.settings.colorBy.type){n=s(new Set(this.data.map((function(e){return e[t.settings.colorBy.variable]}))).values()),this.colorScale=d3.scaleOrdinal().domain(n).range(d3.schemeTableau10);var a=2*Math.PI/n.length;e.event.forEach((function(t){t.foci=n.map((function(e,n){return{key:e,x:t.x+50*Math.cos(n*a),y:t.y+50*Math.sin(n*a)}}))}))}return this.domain=n,e}function Y(t,e){var n=this;return void 0!==e?t[e]:t.find((function(e,i){return e.start_timepoint<=n.settings.timepoint&&n.settings.timepoint<=e.end_timepoint||i===t.length-1}))}function X(t){var e=this;return t.filter((function(t){return t.start_timepoint<=e.settings.timepoint})).sort((function(t,e){return t.start_timepoint-e.start_timepoint})).filter((function(t,n,i){var r=i[n-1]?i[n-1].event:null;return!e.settings.eventChangeCount.includes(r)&&e.settings.eventChangeCount.includes(t.event)})).length}function H(t){return"color"!==this.settings.eventChangeCountAesthetic?Math.min(this.settings.minRadius+t,this.settings.maxRadius):this.settings.minRadius}function G(t){var e="size"!==this.settings.eventChangeCountAesthetic?d3.rgb(this.colorScale(t)).toString():"rgb(170,170,170)",n=e.replace("rgb","rgba").replace(")",", 0.5)"),i=e.replace("rgb","rgba").replace(")",", 1)");return{color:e,fill:n,stroke:i}}function J(t,e,n){var i=X.call(this,t,n),r="frequency"===this.settings.colorBy.type?i:e[this.settings.colorBy.variable];return o({nStateChanges:i,aesthetic:r,r:H.call(this,r)},G.call(this,r))}function K(){var t=this;this.metadata.event.forEach((function(t){t.prevCount=t.count})),this.data.nested.forEach((function(e){e.value.statePrevious=e.value.state,e.value.state=Y.call(t,e.value.group);var n=J.call(t,e.value.group,e.value.state,e.value.statePrevious);Object.assign(e.value,n)})),this.metadata.event.forEach((function(e){e.data=t.data.nested.filter((function(t){return t.value.state.event===e.value})),e.count=e.data.length,e.cumulative=t.data.filter((function(n){return n.event===e.value&&n.start_timepoint<=t.settings.timepoint})).length,e.change=e.count-e.prevCount}))}function Z(){var t=this;this.orbits.each((function(e){e.change=d3.sum(e.values,(function(t){return t.change})),e.change>0&&d3.select(this).transition().duration(t.settings.speeds[t.settings.speed]/2).attr("stroke-width",.5*e.change).transition().duration(t.settings.speeds[t.settings.speed]/2).attr("stroke-width",.5)}))}function tt(){var t=this;this.controls.timepoint.inputs.property("value",this.settings.timepoint),this.containers.timer.text("".concat(this.settings.timepoint," ").concat(this.settings.timeUnit)),this.containers.progress.attr("title","The animation is ".concat(d3.format(".1%")(this.settings.timepoint/this.settings.duration)," complete with ").concat(this.settings.duration-this.settings.timepoint," ").concat(this.settings.timeUnit.split(" ")[0]," to go.")),this.containers.progress.circle.animate(this.settings.timepoint/this.settings.duration),this.settings.eventCount&&this.focusAnnotations.selectAll("tspan.fdg-focus-annotation__event-count").text((function(e){return"".concat(e.count," (").concat(d3.format(".1%")(e.count/t.data.nested.length),")")})),this.freqTable.tr.selectAll("td").data((function(t){return[t.value,t.cumulative]})).join("td").text((function(t){return"number"==typeof t?d3.format(",d")(t):t}))}function et(){K.call(this),Z.call(this),tt.call(this)}function nt(){var t=this,e=this.settings.resetDelay/1e3-1;return this.containers.countdown.classed("fdg-invisible",!1).classed("fdg-hidden",(function(t){return t!==e})),window.setInterval((function(){e--,t.containers.countdown.classed("fdg-hidden",(function(t){return t!==e}))}),1e3)}function it(t){d3.select(this).transition().duration(t/15).delay(t-t/15*2).style("opacity",0)}function rt(t,e){t.style("opacity",0).transition().duration(e/15).style("opacity",1).on("end",(function(){it.call(this,e)}))}function at(){var t=this;this.containers.modal.html(this.settings.text[this.settings.modalIndex]).call(rt,this.settings.modalSpeed),this.modal=d3.interval((function(){t.settings.modalIndex++,t.settings.modalIndex===t.settings.text.length-1&&t.modal.stop(),t.containers.modal.html(t.settings.text[t.settings.modalIndex]).call(rt,t.settings.modalSpeed)}),this.settings.modalSpeed)}function ot(){var t=this;this.settings.timepoint=0,this.settings.modalIndex=0,this.controls.timepoint.inputs.attr("value",0),this.metadata.event.forEach((function(t){t.prevCount=0,t.count=0,t.cumulative=0})),this.data.nested.forEach((function(e){e.value.statePrevious=null,e.value.state=Y.call(t,e.value.group,0);var n=J.call(t,e.value.group,e.value.state,e.value.statePrevious);Object.assign(e.value,n)})),this.modal&&this.modal.stop(),at.call(this)}function st(t){var e=this,n=window.setTimeout((function(){ot.call(e),e.containers.timer.text("".concat(e.settings.timepoint," ").concat(e.settings.timeUnit)),e.containers.progress.circle.animate(e.settings.timepoint/e.settings.duration),window.clearInterval(t),window.clearTimeout(n),e.containers.countdown.classed("fdg-invisible",(function(t){return t===e.settings.resetDelay/1e3-1})).classed("fdg-hidden",(function(t){return t!==e.settings.resetDelay/1e3-1})),e.interval=ht.call(e)}),this.settings.resetDelay);return n}function ct(){this.interval.stop();var t=nt.call(this);st.call(this,t)}function ut(){var t=this;this.metadata.event.forEach((function(e){e.forceSimulation.forEach((function(n){1===t.settings.timepoint&&n.force("center",null),n.nodes(e.data.filter((function(t){return!t.value.noStateChange&&t.value.category===n.category}))),n.alpha(1).restart()}))}))}var lt=function(t){this.settings.timepoint+=!!t,this.settings.timepoint<=this.settings.duration?et.call(this):ct.call(this),ut.call(this)};function ht(){return d3.interval(lt.bind(this),this.settings.speeds[this.settings.speed])}var ft=[{action:"play",label:"Play",html:"&#9658;"},{action:"pause",label:"Pause",html:"&#10074;&#10074;"}];function dt(){var t=this;this.settings.playPause=ft.find((function(e){return e.action!==t.settings.playPause})).action,this.controls.playPause.inputs.attr("title","".concat(ft.find((function(e){return e.action!==t.settings.playPause})).label," animation")).html(ft.find((function(e){return e.action!==t.settings.playPause})).html),"play"===this.settings.playPause?this.interval=ht.call(this):this.interval.stop()}function pt(){var t=this,e=this,n=this.controls.container.append("div").classed("fdg-control fdg-control--speed",!0),i=n.selectAll("div").data(Object.keys(this.settings.speeds).map((function(e){return{label:e,value:t.settings.speeds[e]}}))).enter().append("div").attr("class",(function(e){return"fdg-button ".concat(e.label," ").concat(e.label===t.settings.speed?"current":"")})).attr("title",(function(e){return"Advance the animation every ".concat(t.settings.speeds[e.label]/1e3," second(s).")})).text((function(t){return t.label}));return i.on("click",(function(t){e.settings.speed=t.label,i.classed("current",(function(e){return e.label===t.label})),"play"===e.settings.playPause&&(e.interval.stop(),e.interval=ht.call(e))})),{container:n,inputs:i}}function gt(){var t=this,e=this.controls.container.append("div").classed("fdg-control fdg-control--play-pause",!0),n=e.append("div").classed("fdg-button fdg-input",!0).attr("title","".concat(ft.find((function(e){return e.action!==t.settings.playPause})).label," animation.")).html(ft.find((function(e){return e.action!==t.settings.playPause})).html);return n.on("click",(function(){dt.call(t)})),{container:e,inputs:n}}function vt(){var t=this,e=this.controls.container.append("div").classed("fdg-control fdg-control--step",!0),n=e.append("div").classed("fdg-button fdg-input",!0).attr("title","Advance animation by one time unit.").text("Step");return n.on("click",(function(){"pause"!==t.settings.playPause&&dt.call(t),lt.call(t,!0)})),{container:e,inputs:n}}function yt(){var t=this,e=this,n=this.controls.container.append("div").classed("fdg-control fdg-control--timepoint",!0),i=n.append("div").classed("fdg-button fdg-input",!0).append("input").attr("type","number").attr("title","Choose a timepoint.").attr("value",+this.settings.timepoint).attr("min",1).attr("max",this.settings.duration);return i.on("click",(function(){"pause"!==t.settings.playPause&&dt.call(t)})),i.on("change",(function(){"pause"!==e.settings.playPause&&dt.call(e),e.settings.timepoint=+this.value-1,lt.call(e,!0)})),{container:n,inputs:i}}function mt(){var t=this,e=this.controls.container.append("div").classed("fdg-control fdg-control--reset",!0),n=e.append("div").classed("fdg-button fdg-input",!0).attr("title","Reset animation.").html("&#x21ba;");return n.on("click",(function(){ot.call(t),"play"!==t.settings.playPause&&dt.call(t)})),{container:e,inputs:n}}function _t(){var t=this,e=this,n=this.controls.container.append("div").classed("fdg-control fdg-control--event-list",!0),i=n.selectAll("div").data(this.metadata.event).enter().append("div").attr("class",(function(e){return"fdg-button ".concat(t.settings.eventChangeCount.includes(e.value)?"current":"")})).attr("title",(function(e){return"".concat(t.settings.eventChangeCount.includes(e.value)?"Remove":"Add"," ").concat(e.value," ").concat(t.settings.eventChangeCount.includes(e.value)?"from":"to"," the list of events that control bubble ").concat("both"===t.settings.eventChangeCountAesthetic?"color and size":t.settings.eventChangeCountAesthetic,".")})).text((function(t){return t.value}));return i.on("click",(function(t){var n=this;this.classList.toggle("current"),e.settings.eventChangeCount.includes(this.textContent)?e.settings.eventChangeCount.splice(e.settings.eventChangeCount.findIndex((function(t){return t===n.textContent})),1):e.settings.eventChangeCount.push(this.textContent),this.title="".concat(e.settings.eventChangeCount.includes(t.value)?"Remove":"Add"," ").concat(t.value," ").concat(e.settings.eventChangeCount.includes(t.value)?"from":"to"," the list of events that control bubble ").concat("both"===e.settings.eventChangeCountAesthetic?"color and size":e.settings.eventChangeCountAesthetic,"."),e.controls.colorSizeToggle.inputs.attr("title",(function(t){return"Quantify the number of ".concat(e.util.csv(e.settings.eventChangeCount)," events by ").concat("both"!==t?t:"color and size",".")})),e.legends.container.classed("fdg-invisible",0===e.settings.eventChangeCount.length).selectAll("span.fdg-measure").text(e.util.csv(e.settings.eventChangeCount)),lt.call(e,!1)})),{container:n,inputs:i}}function bt(){var t=this,e=this,n=this.controls.container.append("div").classed("fdg-control fdg-control--color-size",!0),i=n.selectAll("div").data(["color","size","both"]).enter().append("div").attr("class",(function(e){return"fdg-button ".concat(e," ").concat(e===t.settings.eventChangeCountAesthetic?"current":"")})).attr("title",(function(n){return"Quantify the number of ".concat(e.util.csv(t.settings.eventChangeCount)," events by ").concat("both"!==n?n:"color and size")})).text((function(t){return t}));return i.on("click",(function(t){i.classed("current",(function(e){return e===t})),e.settings.eventChangeCountAesthetic=t,e.controls.eventList.inputs.attr("title",(function(t){return"".concat(e.settings.eventChangeCount.includes(t.value)?"Remove":"Add"," ").concat(t.value," ").concat(e.settings.eventChangeCount.includes(t.value)?"from":"to"," the list of events that control bubble ").concat("both"===e.settings.eventChangeCountAesthetic?"color and size":e.settings.eventChangeCountAesthetic,".")})),e.legends.container.selectAll(".fdg-legend").classed("fdg-hidden",(function(){return!Array.from(this.classList).some((function(e){return e.includes(t)}))})),lt.call(e,!1)})),{container:n,inputs:i}}function wt(){this.controls={container:this.containers.controls},this.controls.speed=pt.call(this),this.controls.playPause=gt.call(this),this.controls.step=vt.call(this),this.controls.timepoint=yt.call(this),this.controls.reset=mt.call(this),"frequency"===this.settings.colorBy.type&&(this.controls.eventList=_t.call(this),this.controls.colorSizeToggle=bt.call(this)),this.controls.container.selectAll(".fdg-button").on("mousedown",(function(){this.classList.toggle("clicked")})).on("mouseup",(function(){this.classList.toggle("clicked")})).on("mouseout",(function(){this.classList.contains("clicked")&&this.classList.toggle("clicked")}))}function xt(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:256,n=document.createElement("canvas");n.width=e,n.height=1;for(var i=n.getContext("2d"),r=0;r<e;++r)i.fillStyle=t(r/(e-1)),i.fillRect(r,0,1,1);return n}var St={color:function(t,e){var n=this;return t.selectAll("rect.legend-mark").data(this.settings.colors()).enter().append("rect").classed("legend-mark",!0).attr("x",(function(t,i){return i*(e[0]/n.settings.colors().length)})).attr("y",0).attr("width",e[0]/this.settings.colors().length).attr("height",e[1]/3).attr("fill",(function(t){return t})).attr("fill-opacity",.5).attr("stroke",(function(t){return t})).attr("stroke-opacity",1)},size:function(t,e){var n=this;return t.selectAll("circle.legend-mark").data(this.settings.colors()).enter().append("circle").classed("legend-mark",!0).attr("cx",(function(t,i){return i*(e[0]/n.settings.colors().length)+e[0]/n.settings.colors().length/2})).attr("cy",e[1]/4).attr("r",(function(t,e){return e+n.settings.minRadius})).attr("fill","#aaa").attr("fill-opacity",.5).attr("stroke","#aaa").attr("stroke-opacity",1)},both:function(t,e){var n=this;return t.selectAll("circle.legend-mark").data(this.settings.colors()).enter().append("circle").classed("legend-mark",!0).attr("cx",(function(t,i){return i*(e[0]/n.settings.colors().length)+e[0]/n.settings.colors().length/2})).attr("cy",e[1]/4).attr("r",(function(t,e){return e+n.settings.minRadius})).attr("fill",(function(t){return t})).attr("fill-opacity",.5).attr("stroke",(function(t){return t})).attr("stroke-opacity",1)}};function Ct(t){var e=[200,50],n=this.legends.container.append("div").classed("fdg-legend fdg-legend--".concat(t),!0).classed("fdg-hidden",this.settings.eventChangeCountAesthetic!==t||0===this.settings.eventChangeCount.length),i=n.append("div").classed("fdg-sidebar__label fdg-legend__label",!0).html('Number of <span class = "fdg-measure">'.concat(this.util.csv(this.settings.eventChangeCount),"</span> events")),r=n.append("svg").attr("width",e[0]).attr("height",e[1]).append("g"),a=St[t].call(this,r,e),o=r.append("text").attr("x",e[0]/this.settings.colors().length/2).attr("y",e[1]/2+16).attr("text-anchor","middle").text("0"),s=r.append("text").attr("x",e[0]-e[0]/this.settings.colors().length/2).attr("y",e[1]/2+16).attr("text-anchor","middle").text("".concat(this.settings.colors().length-1,"+"));return{container:n,label:i,svg:r,marks:a,lower:o,upper:s}}function kt(){var t=this;if(this.legends={container:this.containers.legends},"continuous"===this.settings.colorBy.type)this.legends.container.append("div").classed("fdg-legend fdg-legend--continuous",!0).node().appendChild(function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.color,i=e.title,r=e.tickSize,a=void 0===r?6:r,o=e.width,s=void 0===o?320:o,c=e.height,u=void 0===c?44+a:c,l=e.marginTop,h=void 0===l?18:l,f=e.marginRight,d=void 0===f?0:f,p=e.marginBottom,g=void 0===p?16+a:p,v=e.marginLeft,y=void 0===v?0:v,m=e.ticks,_=void 0===m?s/64:m,b=e.tickFormat,w=e.tickValues,x=d3.create("svg").attr("width",s).attr("height",u).attr("viewBox",[0,0,s,u]).style("overflow","visible"),S=function(t){return t.selectAll(".tick line").attr("y1",h+g-u)};if(n.interpolate){var C=Math.min(n.domain().length,n.range().length);t=n.copy().rangeRound(d3.quantize(d3.interpolate(y,s-d),C)),x.append("image").attr("x",y).attr("y",h).attr("width",s-y-d).attr("height",u-h-g).attr("preserveAspectRatio","none").attr("xlink:href",xt.call(this,n.copy().domain(d3.quantize(d3.interpolate(0,1),C))).toDataURL())}else if(n.interpolator){if(t=Object.assign(n.copy().interpolator(d3.interpolateRound(y,s-d)),{range:function(){return[y,s-d]}}),x.append("image").attr("x",y).attr("y",h).attr("width",s-y-d).attr("height",u-h-g).attr("preserveAspectRatio","none").attr("xlink:href",xt.call(this,n.interpolator()).toDataURL()),!t.ticks){if(void 0===w){var k=Math.round(_+1);w=d3.range(k).map((function(t){return d3.quantile(n.domain(),t/(k-1))}))}"function"!=typeof b&&(b=d3.format(void 0===b?",f":b))}}else if(n.invertExtent){var O=n.thresholds?n.thresholds():n.quantiles?n.quantiles():n.domain(),A=void 0===b?function(t){return t}:"string"==typeof b?d3.format(b):b;t=d3.scaleLinear().domain([-1,n.range().length-1]).rangeRound([y,s-d]),x.append("g").selectAll("rect").data(n.range()).join("rect").attr("x",(function(e,n){return t(n-1)})).attr("y",h).attr("width",(function(e,n){return t(n)-t(n-1)})).attr("height",u-h-g).attr("fill",(function(t){return t})),w=d3.range(O.length),b=function(t){return A(O[t],t)}}else t=d3.scaleBand().domain(n.domain()).rangeRound([y,s-d]),x.append("g").selectAll("rect").data(n.domain()).join("rect").attr("x",t).attr("y",h).attr("width",Math.max(0,t.bandwidth()-1)).attr("height",u-h-g).attr("fill",n),S=function(){};return x.append("g").attr("transform","translate(0,".concat(u-g,")")).call(d3.axisBottom(t).ticks(_,"string"==typeof b?b:void 0).tickFormat("function"==typeof b?b:void 0).tickSize(a).tickValues(w)).call(S).call((function(t){return t.select(".domain").remove()})).call((function(t){return t.append("text").classed("fdg-sidebar__label fdg-legend__label",!0).attr("x",y).attr("y",h+g-u-6).attr("fill","currentColor").attr("text-anchor","middle").attr("transform","translate(".concat(s/2,",0)")).attr("font-weight","bold").attr("font-size","1.25rem").text(i)})),x.node()}({color:this.colorScale,title:this.settings.colorBy.label,width:200,height:50,tickValues:[this.colorScale.domain()[0],(this.colorScale.domain()[1]-this.colorScale.domain()[0])/2,this.colorScale.domain()[1]]}));else if("categorical"===this.settings.colorBy.type){var e=this.legends.container.append("div").classed("fdg-legend fdg-legend--categorical",!0);e.append("div").classed("fdg-sidebar__label fdg-legend__label",!0).text(this.settings.colorBy.label);var n=e.append("svg").attr("width",200).attr("height",20*this.colorScale.domain().length).selectAll("g").data(this.colorScale.domain()).join("g");n.append("circle").attr("cx",20).attr("cy",(function(t,e){return 20*e+10})).attr("r",7).attr("fill",(function(e){return t.colorScale(e)})),n.append("text").attr("font-size","1rem").attr("x",35).attr("y",(function(t,e){return 20*e+12})).attr("alignment-baseline","middle").text((function(t){return t}))}else"frequency"===this.settings.colorBy.type&&(this.legends.color=Ct.call(this,"color"),this.legends.size=Ct.call(this,"size"),this.legends.both=Ct.call(this,"both"))}function Ot(){var t={container:this.containers.freqTable};return t.table=t.container.append("table"),t.thead=t.table.append("thead"),t.th=t.thead.append("th").classed("fdg-sidebar__label",!0).attr("colspan",2).text("Cumulative Number of Events"),t.tbody=t.table.append("tbody"),t.tr=t.tbody.selectAll("tr").data(this.metadata.event.slice(1)).join("tr"),t.td=t.tr.selectAll("td").data((function(t){return[t.value,t.cumulative]})).join("td").text((function(t){return"number"==typeof t?d3.format(",d")(t):t})),t}function At(){var t=this.containers.svgBackground.append("g").classed("fdg-g fdg-g--orbits",!0);return t.append("defs").selectAll("filter").data(this.metadata.orbit).join("filter").attr("id",(function(t,e){return"orbit--".concat(e)})).append("feDropShadow").attr("dx",0).attr("dy",0).attr("stdDeviation",5).attr("flood-color","black"),t.selectAll("circle.orbit").data(this.metadata.orbit).enter().append("circle").classed("orbit",!0).attr("cx",(function(t){return t.cx})).attr("cy",(function(t){return t.cy})).attr("r",(function(t){return t.r})).attr("fill","none").attr("stroke","#aaa").attr("stroke-width",".5").style("filter",(function(t,e){return"url(#orbit--".concat(e,")")}))}function Pt(){var t=this,e=this.containers.svgForeground.append("g").classed("fdg-g fdg-g--focus-annotations",!0).selectAll("g.fdg-focus-annotation").data(this.metadata.event).join("g").classed("fdg-focus-annotation",!0).attr("transform",(function(t){return"translate(".concat(t.x,",").concat(t.y,")")})),n=function(e){return Math.round(e.x)===Math.round(t.settings.orbitRadius/2)},i=function(e){return 1===e.order||Math.round(e.x)<Math.round(t.settings.width/2)},r=function(t){return n(t)?"middle":i(t)?"start":"end"},a=function(e){return function(e){return Math.round(e.y)===Math.round(t.settings.height/2)}(e)?0:function(e){return Math.round(e.y)<Math.round(t.settings.height/2)}(e)?"-2em":"2em"};return["background","foreground"].forEach((function(o){var s=e.append("text").classed("fdg-focus-annotation__text fdg-focus-annotation__".concat(o),!0);"categorical"!==t.settings.colorBy.type&&s.style("transform",(function(t){return"translate(".concat(function(t){return n(t)?0:i(t)?"2em":"-2em"}(t),",").concat(a(t),")")}));s.append("tspan").classed("fdg-focus-annotation__label",!0).attr("x",0).attr("text-anchor",(function(t){return r(t)})).text((function(t){return t.value})),s.append("tspan").classed("fdg-focus-annotation__event-count",!0).classed("fdg-hidden",!1===t.settings.eventCount).attr("x",0).attr("dy","1.3em").attr("text-anchor",(function(t){return r(t)}))})),e}function jt(){wt.call(this),kt.call(this),this.containers.timer.text("".concat(this.settings.timepoint," ").concat(this.settings.timeUnit)),this.freqTable=Ot.call(this),this.orbits=At.call(this),this.focusAnnotations=Pt.call(this)}function Mt(){var t,e={},n=l(Object.keys(this.settings).filter((function(t){return/_var$/.test(t)})));try{for(n.s();!(t=n.n()).done;){var i=t.value;e[i.replace(/_var$/,"")]=this.data[0].hasOwnProperty(this.settings[i])}}catch(t){n.e(t)}finally{n.f()}return e}function Et(){var t=this;this.data.forEach((function(e){var n,i=l(Object.keys(t.settings).filter((function(t){return/_var$/.test(t)})));try{for(i.s();!(n=i.n()).done;){var r=n.value,a=r.replace(/_var$/,"");e[a]=["event_order","start_timepoint","end_timepoint","duration","sequence"].includes(a)?+e[t.settings[r]]:e[t.settings[r]]}}catch(t){i.e(t)}finally{i.f()}}))}function Tt(t){d3.nest().key((function(t){return t.id})).rollup((function(e){e.forEach((function(n,i){t.duration&&!t.start_timepoint&&(0===i?(n.start_timepoint=1,n.end_timepoint=n.duration):(n.start_timepoint=e[i-1].end_timepoint+1,n.end_timepoint=n.start_timepoint+n.duration-1)),t.start_timepoint&&!t.end_timepoint&&(n.end_timepoint=i<e.length-1?e[i+1].start_timepoint-1:n.duration?n.start_timepoint+n.duration-1:n.start_timepoint),!t.duration&&t.start_timepoint&&t.end_timepoint&&(n.duration=n.start_timepoint-n.end_timepoint+1)})),t.sequence?e.sort((function(t,e){return t.seq-e.seq})):e.sort((function(t,e){return t.start_timepoint-e.start_timepoint})).forEach((function(t,e){t.seq=e}))})).entries(this.data)}function Rt(){var t=this.data.every((function(t){return/^-?\d+\.?\d*$/.test(t.id)||/^-?\d*\.?\d+$/.test(t.id)}));this.data.sort((function(e,n){var i=t?+e.id-+n.id:e.id<n.id?-1:n.id<e.id?1:0,r=e.seq-n.seq;return i||r}))}function It(){var t=Mt.call(this);Et.call(this),Tt.call(this,t),Rt.call(this)}function Ft(){var t=this;return d3.nest().key((function(t){return t.id})).rollup((function(e){var n=d3.sum(e,(function(t){return t.duration})),i="categorical"===t.settings.colorBy.type?e[0][t.settings.colorBy.variable]:null,r=Y.call(t,e,0);return o({group:e,duration:n,category:i,statePrevious:null,state:r,noStateChange:1===e.length&&r.event===t.settings.eventCentral},J.call(t,e,r,null))})).entries(this.data)}function qt(){var t=this;It.call(this),this.data.nested=Ft.call(this),this.metadata.event.forEach((function(e){e.data=t.data.nested.filter((function(t){return t.value.state.event===e.value}))}))}function Nt(t){return function(){return t}}function Wt(t,e,n,i){if(isNaN(e)||isNaN(n))return t;var r,a,o,s,c,u,l,h,f,d=t._root,p={data:i},g=t._x0,v=t._y0,y=t._x1,m=t._y1;if(!d)return t._root=p,t;for(;d.length;)if((u=e>=(a=(g+y)/2))?g=a:y=a,(l=n>=(o=(v+m)/2))?v=o:m=o,r=d,!(d=d[h=l<<1|u]))return r[h]=p,t;if(s=+t._x.call(null,d.data),c=+t._y.call(null,d.data),e===s&&n===c)return p.next=d,r?r[h]=p:t._root=p,t;do{r=r?r[h]=new Array(4):t._root=new Array(4),(u=e>=(a=(g+y)/2))?g=a:y=a,(l=n>=(o=(v+m)/2))?v=o:m=o}while((h=l<<1|u)==(f=(c>=o)<<1|s>=a));return r[f]=d,r[h]=p,t}function Bt(t,e,n,i,r){this.node=t,this.x0=e,this.y0=n,this.x1=i,this.y1=r}function Dt(t){return t[0]}function zt(t){return t[1]}function Lt(t,e,n){var i=new Vt(null==e?Dt:e,null==n?zt:n,NaN,NaN,NaN,NaN);return null==t?i:i.addAll(t)}function Vt(t,e,n,i,r,a){this._x=t,this._y=e,this._x0=n,this._y0=i,this._x1=r,this._y1=a,this._root=void 0}function Ut(t){for(var e={data:t.data},n=e;t=t.next;)n=n.next={data:t.data};return e}var Qt=Lt.prototype=Vt.prototype;function $t(){var t,e,n,i,r,a,o,s=0,c=Nt(-30),u=1,l=1/0,h=.81;function f(){return 1e-6*(Math.random()-.5)}function d(t){return t.x}function p(t){return t.y}function g(r){var o,c=t.length;for(i&&!a(s,t)||(i=Lt(t,d,p).visitAfter(y),t.update.push(s)),n=r,o=0;o<c;++o)e=t[o],i.visit(m);++s}function v(){if(t){s=0,t.update=[],a=r(),i=null;var e,n,u=t.length;for(o=new Array(u),e=0;e<u;++e)n=t[e],o[n.index]=+c(n,e,t)}}function y(t){var e,n,i,r,a,s=0,c=0;if(t.length){for(i=r=a=0;a<4;++a)(e=t[a])&&(n=Math.abs(e.value))&&(s+=e.value,c+=n,i+=n*e.x,r+=n*e.y);t.x=i/c,t.y=r/c}else{(e=t).x=e.data.x,e.y=e.data.y;do{s+=o[e.data.index]}while(e=e.next)}t.value=s}function m(t,i,r,a){if(!t.value)return!0;var s=t.x-e.x,c=t.y-e.y,d=a-i,p=s*s+c*c;if(d*d/h<p)return p<l&&(0===s&&(p+=(s=f())*s),0===c&&(p+=(c=f())*c),p<u&&(p=Math.sqrt(u*p)),e.vx+=s*t.value*n/p,e.vy+=c*t.value*n/p),!0;if(!(t.length||p>=l)){(t.data!==e||t.next)&&(0===s&&(p+=(s=f())*s),0===c&&(p+=(c=f())*c),p<u&&(p=Math.sqrt(u*p)));do{t.data!==e&&(p=(s=t.data.x-e.x)*s+(c=t.data.y-e.y)*c,0===s&&(p+=(s=f())*s),0===c&&(p+=(c=f())*c),p<u&&(p=Math.sqrt(u*p)),d=o[t.data.index]*n/p,e.vx+=s*d,e.vy+=c*d)}while(t=t.next)}}return r=function(){return function(t){return t%13==0}},g.initialize=function(e){t=e,v()},g.strength=function(t){return arguments.length?(c="function"==typeof t?t:Nt(+t),v(),g):c},g.distanceMin=function(t){return arguments.length?(u=t*t,g):Math.sqrt(u)},g.distanceMax=function(t){return arguments.length?(l=t*t,g):Math.sqrt(l)},g.theta=function(t){return arguments.length?(h=t*t,g):Math.sqrt(h)},g.update=function(t){return arguments.length?(a=(r=t)(),g):r},g}function Yt(){var t=this;this.containers.canvas.context.clearRect(0,0,this.settings.width,this.settings.height),this.containers.canvas.context.save(),this.data.nested.sort((function(t,e){return t.value.stateChanges-e.value.stateChanges})).forEach((function(e,n){t.containers.canvas.context.beginPath(),t.containers.canvas.context.moveTo(e.x+e.r,e.y),t.containers.canvas.context.arc(e.x,e.y,e.value.r,0,2*Math.PI),t.settings.fill&&(t.containers.canvas.context.fillStyle=e.value.fill,t.containers.canvas.context.fill()),t.containers.canvas.context.strokeStyle=e.value.stroke,t.containers.canvas.context.stroke()})),this.containers.canvas.context.restore()}function Xt(t,e,n){var i=d3.forceSimulation().nodes(t).alphaDecay(.01).velocityDecay(.9).force("center",d3.forceCenter(this.settings.orbitRadius/2,this.settings.height/2)).force("x",d3.forceX(e).strength(.3)).force("y",d3.forceY(n).strength(.3)).force("charge",$t().strength(this.settings.chargeStrength)).on("tick",Yt.bind(this));return i.force("collide",d3.forceCollide().radius(this.settings.minRadius+1)),i}function Ht(t){for(var e=d3.forceSimulation(t).force("charge",d3.forceCollide().radius(this.settings.minRadius+.5)).force("r",d3.forceRadial(this.settings.orbitRadius/2)).stop(),n=0;n<30;n++)e.tick();var i=this.containers.svgBackground.insert("g",":first-child").attr("transform","translate(".concat(this.settings.orbitRadius/2,",").concat(this.settings.height/2,")")),r=i.selectAll("circle").data(t).enter().append("circle").attr("cx",(function(t){return t.x})).attr("cy",(function(t){return t.y})).attr("r",this.settings.minRadius).attr("fill",this.settings.color(0)).attr("fill-opacity",.25);return{simulation:e,g:i,nodes:r}}function Gt(t){for(var e=d3.forceSimulation().nodes(t).force("center",d3.forceCenter(this.settings.orbitRadius/2,this.settings.height/2)).force("x",d3.forceX(this.settings.orbitRadius/2).strength(.3)).force("y",d3.forceY(this.settings.height/2).strength(.3)).force("charge",$t().strength(this.settings.chargeStrength)).force("collide",d3.forceCollide().radius(this.settings.minRadius+.5)).stop(),n=0;n<300;n++)e.tick();var i=this.containers.svgBackground.insert("g",":first-child"),r=i.selectAll("circle").data(t).enter().append("circle").attr("cx",(function(t){return t.x})).attr("cy",(function(t){return t.y})).attr("r",this.settings.minRadius).attr("fill",this.settings.color(0)).attr("fill-opacity",.25);return{simulation:e,g:i,nodes:r}}function Jt(){if(this.settings.drawStaticSeparately){var t=this.data.nested.filter((function(t){return t.value.noStateChange})).map((function(t){return{key:t.key}}));return"radial"===this.settings.staticLayout?Ht.call(this,t):Gt.call(this,t)}}function Kt(){var t=this;at.call(this),this.staticForceSimulation=Jt.call(this),this.metadata.event.forEach((function(e){if(void 0===e.foci){var n=Xt.call(t,e.data.filter((function(t){return!t.value.noStateChange})),e.x,e.y);n.category=null,e.forceSimulation=[n]}else e.forceSimulation=e.foci.map((function(n){var i=Xt.call(t,e.data.filter((function(t){return!t.value.noStateChange&&t.value.category===n.key})),n.x,n.y);return i.category=n.key,i.focus=n,i}))})),"play"===this.settings.playPause&&(this.interval=ht.call(this))}return Qt.copy=function(){var t,e,n=new Vt(this._x,this._y,this._x0,this._y0,this._x1,this._y1),i=this._root;if(!i)return n;if(!i.length)return n._root=Ut(i),n;for(t=[{source:i,target:n._root=new Array(4)}];i=t.pop();)for(var r=0;r<4;++r)(e=i.source[r])&&(e.length?t.push({source:e,target:i.target[r]=new Array(4)}):i.target[r]=Ut(e));return n},Qt.add=function(t){var e=+this._x.call(null,t),n=+this._y.call(null,t);return Wt(this.cover(e,n),e,n,t)},Qt.addAll=function(t){var e,n,i,r,a=t.length,o=new Array(a),s=new Array(a),c=1/0,u=1/0,l=-1/0,h=-1/0;for(n=0;n<a;++n)isNaN(i=+this._x.call(null,e=t[n]))||isNaN(r=+this._y.call(null,e))||(o[n]=i,s[n]=r,i<c&&(c=i),i>l&&(l=i),r<u&&(u=r),r>h&&(h=r));if(c>l||u>h)return this;for(this.cover(c,u).cover(l,h),n=0;n<a;++n)Wt(this,o[n],s[n],t[n]);return this},Qt.cover=function(t,e){if(isNaN(t=+t)||isNaN(e=+e))return this;var n=this._x0,i=this._y0,r=this._x1,a=this._y1;if(isNaN(n))r=(n=Math.floor(t))+1,a=(i=Math.floor(e))+1;else{for(var o,s,c=r-n,u=this._root;n>t||t>=r||i>e||e>=a;)switch(s=(e<i)<<1|t<n,(o=new Array(4))[s]=u,u=o,c*=2,s){case 0:r=n+c,a=i+c;break;case 1:n=r-c,a=i+c;break;case 2:r=n+c,i=a-c;break;case 3:n=r-c,i=a-c}this._root&&this._root.length&&(this._root=u)}return this._x0=n,this._y0=i,this._x1=r,this._y1=a,this},Qt.data=function(){var t=[];return this.visit((function(e){if(!e.length)do{t.push(e.data)}while(e=e.next)})),t},Qt.extent=function(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},Qt.find=function(t,e,n){var i,r,a,o,s,c,u,l=this._x0,h=this._y0,f=this._x1,d=this._y1,p=[],g=this._root;for(g&&p.push(new Bt(g,l,h,f,d)),null==n?n=1/0:(l=t-n,h=e-n,f=t+n,d=e+n,n*=n);c=p.pop();)if(!(!(g=c.node)||(r=c.x0)>f||(a=c.y0)>d||(o=c.x1)<l||(s=c.y1)<h))if(g.length){var v=(r+o)/2,y=(a+s)/2;p.push(new Bt(g[3],v,y,o,s),new Bt(g[2],r,y,v,s),new Bt(g[1],v,a,o,y),new Bt(g[0],r,a,v,y)),(u=(e>=y)<<1|t>=v)&&(c=p[p.length-1],p[p.length-1]=p[p.length-1-u],p[p.length-1-u]=c)}else{var m=t-+this._x.call(null,g.data),_=e-+this._y.call(null,g.data),b=m*m+_*_;if(b<n){var w=Math.sqrt(n=b);l=t-w,h=e-w,f=t+w,d=e+w,i=g.data}}return i},Qt.remove=function(t){if(isNaN(a=+this._x.call(null,t))||isNaN(o=+this._y.call(null,t)))return this;var e,n,i,r,a,o,s,c,u,l,h,f,d=this._root,p=this._x0,g=this._y0,v=this._x1,y=this._y1;if(!d)return this;if(d.length)for(;;){if((u=a>=(s=(p+v)/2))?p=s:v=s,(l=o>=(c=(g+y)/2))?g=c:y=c,e=d,!(d=d[h=l<<1|u]))return this;if(!d.length)break;(e[h+1&3]||e[h+2&3]||e[h+3&3])&&(n=e,f=h)}for(;d.data!==t;)if(i=d,!(d=d.next))return this;return(r=d.next)&&delete d.next,i?(r?i.next=r:delete i.next,this):e?(r?e[h]=r:delete e[h],(d=e[0]||e[1]||e[2]||e[3])&&d===(e[3]||e[2]||e[1]||e[0])&&!d.length&&(n?n[f]=d:this._root=d),this):(this._root=r,this)},Qt.removeAll=function(t){for(var e=0,n=t.length;e<n;++e)this.remove(t[e]);return this},Qt.root=function(){return this._root},Qt.size=function(){var t=0;return this.visit((function(e){if(!e.length)do{++t}while(e=e.next)})),t},Qt.visit=function(t){var e,n,i,r,a,o,s=[],c=this._root;for(c&&s.push(new Bt(c,this._x0,this._y0,this._x1,this._y1));e=s.pop();)if(!t(c=e.node,i=e.x0,r=e.y0,a=e.x1,o=e.y1)&&c.length){var u=(i+a)/2,l=(r+o)/2;(n=c[3])&&s.push(new Bt(n,u,l,a,o)),(n=c[2])&&s.push(new Bt(n,i,l,u,o)),(n=c[1])&&s.push(new Bt(n,u,r,a,l)),(n=c[0])&&s.push(new Bt(n,i,r,u,l))}return this},Qt.visitAfter=function(t){var e,n=[],i=[];for(this._root&&n.push(new Bt(this._root,this._x0,this._y0,this._x1,this._y1));e=n.pop();){var r=e.node;if(r.length){var a,o=e.x0,s=e.y0,c=e.x1,u=e.y1,l=(o+c)/2,h=(s+u)/2;(a=r[0])&&n.push(new Bt(a,o,s,l,h)),(a=r[1])&&n.push(new Bt(a,l,s,c,h)),(a=r[2])&&n.push(new Bt(a,o,h,l,u)),(a=r[3])&&n.push(new Bt(a,l,h,c,u))}i.push(e)}for(;e=i.pop();)t(e.node,e.x0,e.y0,e.x1,e.y1);return this},Qt.x=function(t){return arguments.length?(this._x=t,this):this._x},Qt.y=function(t){return arguments.length?(this._y=t,this):this._y},function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"body",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a={data:e,element:n,settings:Object.assign(i,r),util:t};return i.update.call(a),a.containers=L.call(a),a.metadata=$.call(a),jt.call(a),qt.call(a),Kt.call(a),a}}));
