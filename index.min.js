!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).forceDirectedGraph=e()}(this,(function(){"use strict";var t={csv:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=t.join(", ");return e&&(n=n.replace(/, ([^,]*)$/," and $1")),n}};function e(){return["#a50026","#f46d43","#fdae61","#a6d96a","#66bd63","#006837"].reverse()}function n(){var t=e();return d3.scaleLinear().domain(d3.range(t.length)).range(t).clamp(!0)}var i={timepoint:0,timeUnit:"days since randomization",reset:null,timeFrame:null,events:null,eventCentral:null,eventCount:!0,eventChangeCount:null,eventChangeCountAesthetic:"color",excludeFirst:!0,excludeLast:!0,speed:"slow",speeds:{slow:1e3,medium:200,fast:50},playPause:"play",width:null,height:null,padding:1,nOrbits:null,orbitRadius:150,nFoci:null,translate:!1,colors:e,colorScale:n,color:function(t){return n()(Math.min(t,n().domain().length))},minRadius:null,maxRadius:null,notes:[{startTimepoint:1,stopTimepoint:75,text:"Heart disease is the leading cause of death for men, women, and people of most racial and ethnic groups in the United States."},{startTimepoint:90,stopTimepoint:165,text:"One person dies every 37 seconds in the United States from cardiovascular disease."},{startTimepoint:180,stopTimepoint:255,text:"About 647,000 Americans die from heart disease each year—that’s 1 in every 4 deaths."},{startTimepoint:270,stopTimepoint:345,text:"Heart disease costs the United States about $219 billion each year from 2014 to 2015."},{startTimepoint:360,stopTimepoint:435,text:"This includes the cost of health care services, medicines, and lost productivity due to death."},{startTimepoint:450,stopTimepoint:525,text:"Coronary heart disease is the most common type of heart disease, killing 365,914 people in 2017."},{startTimepoint:540,stopTimepoint:615,text:"About 18.2 million adults age 20 and older have CAD (about 6.7%)."},{startTimepoint:630,stopTimepoint:705,text:"About 2 in 10 deaths from CAD happen in adults less than 65 years old."},{startTimepoint:720,stopTimepoint:795,text:"In the United States, someone has a heart attack every 40 seconds."},{startTimepoint:810,stopTimepoint:885,text:"Every year, about 805,000 Americans have a heart attack."},{startTimepoint:900,stopTimepoint:975,text:"75% experience their first heart attack"},{startTimepoint:990,stopTimepoint:1065,text:"25% have already had a heart attack."},{startTimepoint:1080,stopTimepoint:1155,text:"About 1 in 5 heart attacks is silent—the damage is done, but the person is not aware of it."}]};function s(){var t=d3.nest().key((function(t){return t.id})).rollup((function(t){return d3.sum(t,(function(t){return+t.duration}))})).entries(this.data);return t.forEach((function(t){t.duration=t.value,t.value=t.key,delete t.key})),t}function a(){var t=d3.nest().key((function(t){return t.event})).rollup((function(t){var e=t[0];return{order:parseInt(e.event_order),count:0,prevCount:0,cumulative:0}})).entries(this.data);return t.forEach((function(t){Object.assign(t,t.value),t.value=t.key,delete t.key})),t.sort((function(t,e){return t.order-e.order})),t}function o(t){var e=this;return d3.nest().key((function(t){return t.order})).entries(t.filter((function(t){return t.value!==e.settings.eventCentral})))}function r(t){var e=this;this.settings.width=t.orbit.length*this.settings.orbitRadius*2+this.settings.orbitRadius,this.settings.height=this.settings.width;var n=this.settings.width/2,i=this.settings.height/2,s=2*Math.PI/(this.settings.nFoci||t.event.length-!!this.settings.eventCentral-1),a=function(t){return t-1};t.event.forEach((function(t,o){t.x=0===t.order?n:t.order*e.settings.orbitRadius*Math.cos(a(o)*s)+n,t.y=0===t.order?i:t.order*e.settings.orbitRadius*Math.sin(a(o)*s)+i})),t.orbit.forEach((function(t,s){t.cx=n,t.cy=i,t.r=(s+1)*e.settings.orbitRadius}))}function c(){var t=this,e={};return e.id=s.call(this),this.settings.minRadius=this.settings.minRadius||3e3/e.id.length,this.settings.maxRadius=this.settings.maxRadius||this.settings.minRadius+this.settings.colors().length,this.settings.reset=this.settings.reset||d3.max(e.id,(function(t){return t.duration})),e.event=a.call(this),this.settings.width=this.settings.width||e.event.length,this.settings.eventCentral=this.settings.eventCentral||e.event[0].value,this.settings.eventFinal=this.settings.eventFinal||e.event[e.event.length-1].value,this.settings.nFoci=this.settings.nFoci||e.event.length-!!this.settings.eventCentral,this.settings.eventChangeCount=this.settings.eventChangeCount||e.event.slice(1).map((function(t){return t.value})),this.settings.eventSequence=e.event.filter((function(n,i){return!!t.settings.excludeLast&&i!==e.event.length-1})).filter((function(e,n){return!!t.settings.excludeFirst&&0!==n})).map((function(t){return t.value})),this.settings.R=this.settings.width/e.event.length/2,e.orbit=o.call(this,e.event),r.call(this,e),e}function l(){this.explanation=this.container.append("div").classed("fdg-explanation",!0).style("text-align","left").style("font-size","20px").style("font-weight","lighter").style("width","calc(98% - 2px)").style("border","1px solid #333").style("background","#eee").style("border-radius","4px").style("padding","4px 1% 8px 1%"),this.explanation.append("p").text(["Each bubble in the animation below represents an individual.","As individuals experience events and change states, their bubble gravitates toward the focus representing that event.","The number of state changes dictates the color and/or size of the bubbles.","Use the controls below to interact with and alter the animation."].join(" "))}function u(t,e){return t[e]}function d(t,e,n){var i=t.find((function(t){return t.value===e}));return i.count+=e===this.settings.eventFinal||n===this.settings.eventCentral,i}function h(t,e){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=t.find((function(t){return t.value===e}));return i.count=n?i.count+1:i.count-1,i}function g(t,e,n){var i=t.find((function(t){return t.value===e}));return i.cumulative+=e===this.settings.eventFinal||n===this.settings.eventCentral,i}function f(t){return"color"!==this.settings.eventChangeCountAesthetic?Math.min(this.settings.minRadius+t,this.settings.maxRadius):this.settings.minRadius}function v(t){var e="size"!==this.settings.eventChangeCountAesthetic?this.settings.color(t):"rgb(170,170,170)",n=e.replace("rgb","rgba").replace(")",", 0.5)"),i=e.replace("rgb","rgba").replace(")",", 1)");return{color:e,fill:n,stroke:i}}function p(){var t=this;this.metadata.event.forEach((function(t){t.prevCount=t.count})),this.data.nested.forEach((function(e){var n=e.value.state.event;e.value.currEvent=n,e.movesSinceChange++,e.value.nextStateChange===t.settings.timepoint&&t.settings.timepoint<e.value.duration&&(e.value.prevEvent=n,e.movesSinceChange=0,e.value.moves+=1,e.value.state=u.call(t,e.value.group,e.value.moves),d.call(t,e.value.events,e.value.state.event,e.value.prevEvent),h.call(t,t.metadata.event,e.value.state.event),g.call(t,t.metadata.event,e.value.state.event,e.value.prevEvent),h.call(t,t.metadata.event,n,!1),e.value.nextStateChange+=e.value.group[e.value.moves].duration),e.value.stateChanges=d3.sum(e.value.events.filter((function(e){return t.settings.eventChangeCount.includes(e.value)})),(function(t){return t.count})),e.value.r=f.call(t,e.value.stateChanges),Object.assign(e.value,v.call(t,e.value.stateChanges))})),this.metadata.event.forEach((function(e){e.change=e.count-e.prevCount,e.data=t.data.nested.filter((function(t){return t.value.state.event===e.value}))}))}function m(){var t=this;this.orbits.each((function(e){e.change=d3.sum(e.values,(function(t){return t.change})),e.change>0&&d3.select(this).transition().duration(t.settings.speeds[t.settings.speed]/2).attr("stroke-width",.5*e.change).transition().duration(t.settings.speeds[t.settings.speed]/2).attr("stroke-width",.5)}))}function b(){var t=this;this.timer.text("".concat(this.settings.timepoint," ").concat(this.settings.timeUnit)),this.settings.eventCount&&this.focusAnnotations.selectAll("tspan.fdg-focus-annotation__event-count").text((function(e){return"".concat(e.count," (").concat(d3.format(".1%")(e.count/t.data.nested.length),")")})),this.settings.timepoint===this.settings.notes[this.settings.notesIndex].startTimepoint?this.notes.style("top","0px").transition().duration(600).style("top","20px").style("color","#000000").text(this.settings.notes[this.settings.notesIndex].text):this.settings.timepoint===this.settings.notes[this.settings.notesIndex].stopTimepoint&&(this.notes.transition().duration(1e3).style("top","300px").style("color","#ffffff"),this.settings.notesIndex+=1,this.settings.notesIndex===this.settings.notes.length&&(this.settings.notesIndex=0))}function x(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],s=t.find((function(t){return t.value===e}));return s.count=i?s.count+(null===n||e===this.settings.eventFinal||n===this.settings.eventCentral):s.count-1,i&&(s.cumulative+=!1===this.settings.eventSequence.includes(n)),s}function y(t){var e=Math.sqrt(~~(Math.random()*this.settings.R*this.settings.R)),n=2*Math.random()*Math.PI;return{sx:t.x+e*Math.cos(n),sy:t.y+e*Math.sin(n),tx:t.x,ty:t.y}}function C(){var t=this;this.settings.timepoint=0,this.metadata.event.forEach((function(t){t.count=0,t.cumulative=0})),this.data.nested.forEach((function(e){e.value.state=u.call(t,e.value.group,0),e.value.events.forEach((function(t){t.count=0,t.duration=0})),x.call(t,e.value.events,e.value.state.event),e.value.moves=0,e.value.nextStateChange=e.value.state.duration;var n=x.call(t,t.metadata.event,e.value.state.event),i=d3.sum(e.value.events.filter((function(e){return t.settings.eventChangeCount.includes(e.value)})),(function(t){return t.count}));Object.assign(e.value,y.call(t,n)),e.value.r=f.call(t,i),Object.assign(e.value,v.call(t,i))}))}i.notesIndex=i.notes.some((function(t){return t.startTimepoint===i.timepoint}))?i.notes.findIndex((function(t){return t.startTimepoint<=i.timepoint&&i.timepoint<=annotations.stopTimepoint})):0;var k=function(){var t=this;this.settings.timepoint++,this.settings.timepoint<=this.settings.reset?(p.call(this),m.call(this),b.call(this)):C.call(this),this.freqTable.tr.selectAll("td").data((function(t){return[t.value,t.cumulative]})).join("td").text((function(t){return t})),this.metadata.event.forEach((function(e){1===t.settings.timepoint&&e.forceSimulation.force("center",null),e.forceSimulation.nodes(e.data),e.forceSimulation.alpha(1).restart()}))};function w(){return d3.interval(k.bind(this),this.settings.speeds[this.settings.speed])}var A=[{action:"play",label:"Play",html:"&#9658;"},{action:"pause",label:"Pause",html:"&#10074;&#10074;"}];function T(){var t=this;this.settings.playPause=A.find((function(e){return e.action!==t.settings.playPause})).action,this.controls.playPause.inputs.attr("title","".concat(A.find((function(e){return e.action!==t.settings.playPause})).label," animation")).html(A.find((function(e){return e.action!==t.settings.playPause})).html),"play"===this.settings.playPause?this.interval=w.call(this):this.interval.stop()}function P(){var t=this,e=this,n=this.controls.container.append("div").classed("fdg-control fdg-control--speed",!0),i=n.selectAll("div").data(Object.keys(this.settings.speeds).map((function(e){return{label:e,value:t.settings.speeds[e]}}))).enter().append("div").attr("class",(function(e){return"togglebutton ".concat(e.label," ").concat(e.label===t.settings.speed?"current":"")})).attr("title",(function(e){return"Advance the animation every ".concat(t.settings.speeds[e.label]/1e3," second(s).")})).text((function(t){return t.label}));return i.on("click",(function(t){e.settings.speed=t.label,i.classed("current",(function(e){return e.label===t.label})),"play"===e.settings.playPause&&(e.interval.stop(),e.interval=w.call(e))})),{container:n,inputs:i}}function O(){var t=this,e=this.controls.container.append("div").classed("fdg-control fdg-control--play-pause",!0),n=e.append("div").classed("togglebutton fdg-input",!0).attr("title","".concat(A.find((function(e){return e.action!==t.settings.playPause})).label," animation.")).html(A.find((function(e){return e.action!==t.settings.playPause})).html);return n.on("click",(function(){T.call(t)})),{container:e,inputs:n}}function R(){var t=this,e=this.controls.container.append("div").classed("fdg-control fdg-control--step",!0),n=e.append("div").classed("togglebutton fdg-input",!0).attr("title","Advance animation by one time unit.").text("Step");return n.on("click",(function(){"pause"!==t.settings.playPause&&T.call(t),k.call(t)})),{container:e,inputs:n}}function j(){var t=this,e=this.controls.container.append("div").classed("fdg-control fdg-control--reset",!0),n=e.append("div").classed("togglebutton fdg-input",!0).attr("title","Reset animation.").html("&#x21ba;");return n.on("click",(function(){C.call(t),"play"!==t.settings.playPause&&T.call(t)})),{container:e,inputs:n}}function E(){var t=this,e=this,n=this.controls.container.append("div").classed("fdg-control fdg-control--event-list",!0),i=n.selectAll("div").data(this.metadata.event).enter().append("div").attr("class",(function(e){return"togglebutton ".concat(t.settings.eventChangeCount.includes(e.value)?"current":"")})).attr("title",(function(e){return"".concat(t.settings.eventChangeCount.includes(e.value)?"Remove":"Add"," ").concat(e.value," ").concat(t.settings.eventChangeCount.includes(e.value)?"from":"to"," the list of events that control bubble ").concat("both"===t.settings.eventChangeCountAesthetic?"color and size":t.settings.eventChangeCountAesthetic,".")})).text((function(t){return t.value}));return i.on("click",(function(t){var n=this;this.classList.toggle("current"),e.settings.eventChangeCount.includes(this.textContent)?e.settings.eventChangeCount.splice(e.settings.eventChangeCount.findIndex((function(t){return t===n.textContent})),1):e.settings.eventChangeCount.push(this.textContent),this.title="".concat(e.settings.eventChangeCount.includes(t.value)?"Remove":"Add"," ").concat(t.value," ").concat(e.settings.eventChangeCount.includes(t.value)?"from":"to"," the list of events that control bubble ").concat("both"===e.settings.eventChangeCountAesthetic?"color and size":e.settings.eventChangeCountAesthetic,"."),e.controls.colorSizeToggle.inputs.attr("title",(function(t){return"Quantify the number of ".concat(e.util.csv(e.settings.eventChangeCount)," events by ").concat("both"!==t?t:"color and size",".")})),e.legends.container.classed("fdg-hidden",0===e.settings.eventChangeCount.length).selectAll("span.fdg-measure").text(e.util.csv(e.settings.eventChangeCount)),e.data.nested.forEach((function(t){var n=d3.sum(t.value.events.filter((function(t){return e.settings.eventChangeCount.includes(t.value)})),(function(t){return t.count}));t.r=f.call(e,n),Object.assign(t.value,v.call(e,n))}))})),{container:n,inputs:i}}function S(){var t=this,e=this,n=this.controls.container.append("div").classed("fdg-control fdg-control--color-size",!0),i=n.selectAll("div").data(["color","size","both"]).enter().append("div").attr("class",(function(e){return"togglebutton ".concat(e," ").concat(e===t.settings.eventChangeCountAesthetic?"current":"")})).attr("title",(function(n){return"Quantify the number of ".concat(e.util.csv(t.settings.eventChangeCount)," events by ").concat("both"!==n?n:"color and size")})).text((function(t){return t}));return i.on("click",(function(t){i.classed("current",(function(e){return e===t})),e.settings.eventChangeCountAesthetic=t,e.controls.eventList.inputs.attr("title",(function(t){return"".concat(e.settings.eventChangeCount.includes(t.value)?"Remove":"Add"," ").concat(t.value," ").concat(e.settings.eventChangeCount.includes(t.value)?"from":"to"," the list of events that control bubble ").concat("both"===e.settings.eventChangeCountAesthetic?"color and size":e.settings.eventChangeCountAesthetic,".")})),e.legends.container.selectAll(".fdg-legend").classed("fdg-hidden",(function(){return!Array.from(this.classList).some((function(e){return e.includes(t)}))})),e.data.nested.forEach((function(t){var n=d3.sum(t.value.events.filter((function(t){return e.settings.eventChangeCount.includes(t.value)})),(function(t){return t.count}));t.r=f.call(e,n),Object.assign(t.value,v.call(e,n))}))})),{container:n,inputs:i}}function M(){this.controls={container:this.container.append("div").classed("fdg-controls",!0)},this.controls.speed=P.call(this),this.controls.playPause=O.call(this),this.controls.step=R.call(this),this.controls.reset=j.call(this),this.controls.eventList=E.call(this),this.controls.colorSizeToggle=S.call(this),this.controls.container.selectAll(".togglebutton").on("mousedown",(function(){this.classList.toggle("clicked")})).on("mouseup",(function(){this.classList.toggle("clicked")}))}var _={color:function(t,e){var n=this;return t.selectAll("rect.legend-mark").data(this.settings.colors()).enter().append("rect").classed("legend-mark",!0).attr("x",(function(t,i){return i*(e[0]/n.settings.colors().length)})).attr("y",0).attr("width",e[0]/this.settings.colors().length).attr("height",e[1]/2).attr("fill",(function(t){return t})).attr("fill-opacity",.5).attr("stroke",(function(t){return t})).attr("stroke-opacity",1)},size:function(t,e){var n=this;return t.selectAll("circle.legend-mark").data(this.settings.colors()).enter().append("circle").classed("legend-mark",!0).attr("cx",(function(t,i){return i*(e[0]/n.settings.colors().length)+e[0]/n.settings.colors().length/2})).attr("cy",e[1]/4).attr("r",(function(t,e){return e+n.settings.minRadius})).attr("fill","#aaa").attr("fill-opacity",.5).attr("stroke","#aaa").attr("stroke-opacity",1)},both:function(t,e){var n=this;return t.selectAll("circle.legend-mark").data(this.settings.colors()).enter().append("circle").classed("legend-mark",!0).attr("cx",(function(t,i){return i*(e[0]/n.settings.colors().length)+e[0]/n.settings.colors().length/2})).attr("cy",e[1]/4).attr("r",(function(t,e){return e+n.settings.minRadius})).attr("fill",(function(t){return t})).attr("fill-opacity",.5).attr("stroke",(function(t){return t})).attr("stroke-opacity",1)}};function z(t){var e=[200,50],n=this.legends.container.append("div").classed("fdg-legend fdg-legend--".concat(t),!0).classed("fdg-hidden",this.settings.eventChangeCountAesthetic!==t||0===this.settings.eventChangeCount.length),i=n.append("div").classed("fdg-legend__label",!0).style("width",e[0]+"px").html('Number of <span class = "fdg-measure">'.concat(this.util.csv(this.settings.eventChangeCount),"</span> events")),s=n.append("svg").attr("width",e[0]).attr("height",e[1]).append("g"),a=_[t].call(this,s,e),o=s.append("text").attr("x",e[0]/this.settings.colors().length/2).attr("y",e[1]/2+16).attr("text-anchor","middle").text("0"),r=s.append("text").attr("x",e[0]-e[0]/this.settings.colors().length/2).attr("y",e[1]/2+16).attr("text-anchor","middle").text("".concat(this.settings.colors().length-1,"+"));return{container:n,label:i,svg:s,marks:a,lower:o,upper:r}}function I(){this.legends={container:this.container.append("div").classed("fdg-legends",!0)},this.legends.color=z.call(this,"color"),this.legends.size=z.call(this,"size"),this.legends.both=z.call(this,"both")}function F(){var t={container:this.container.append("div").classed("fdg-freq-table",!0)};return t.table=t.container.append("table"),t.thead=t.table.append("thead"),t.th=t.thead.append("th").attr("colspan",2).text("Cumulative Number of Events"),t.tbody=t.table.append("tbody"),t.tr=t.tbody.selectAll("tr").data(this.metadata.event.slice(1)).join("tr"),t.td=t.tr.selectAll("td").data((function(t){return[t.value,t.cumulative]})).join("td").text((function(t){return t})),t}function q(){var t=this.svg.selectAll("circle.orbit").data(this.metadata.orbit).enter().append("circle").classed("orbit",!0).attr("cx",(function(t){return t.cx})).attr("cy",(function(t){return t.cy})).attr("r",(function(t){return t.r})).attr("fill","none").attr("stroke","#aaa").attr("stroke-width",".5");return this.settings.translate&&t.attr("transform","translate(-".concat(this.settings.width/2-100,",-").concat(this.settings.height/2-100,")")),t}function D(){var t=this,e=this.svg.selectAll("g.fdg-focus-annotation").data(this.metadata.event).join("g").classed("fdg-focus-annotation",!0);console.log(this.metadata.event),this.settings.translate&&e.attr("transform","translate(-".concat(this.settings.width/2-100,",-").concat(this.settings.height/2-100,")"));var n=function(e){return Math.round(e.x)===Math.round(t.settings.width/2)},i=function(e){return 1===e.order||Math.round(e.x)<Math.round(t.settings.width/2)},s=function(t){return n(t)?t.x:t.x-10*Math.pow(-1,i(t))},a=function(t){return n(t)?"middle":i(t)?"start":"end"},o=function(e){return function(e){return Math.round(e.y)===Math.round(t.settings.height/2)}(e)?e.y:e.y+35*Math.pow(-1,function(e){return Math.round(e.y)<Math.round(t.settings.height/2)}(e))},r=e.append("text").classed("fdg-focus-annotation__text",!0).attr("x",(function(t){return s(t)})).attr("y",(function(t){return o(t)}));r.append("tspan").classed("fdg-focus-annotation__label",!0).attr("x",(function(t){return s(t)})).attr("text-anchor",(function(t){return a(t)})).style("font-weight","bold").style("font-size","20px").attr("stroke","white").attr("stroke-width","4px").text((function(t){return t.value})),r.append("tspan").classed("fdg-focus-annotation__event-count",!0).classed("fdg-hidden",!1===this.settings.eventCount).attr("x",(function(t){return s(t)})).attr("text-anchor",(function(t){return a(t)})).attr("dy","1.3em").style("font-weight","bold").attr("stroke","white").attr("stroke-width","4px");var c=e.append("text").classed("fdg-focus-annotation__text",!0).attr("x",(function(t){return s(t)})).attr("y",(function(t){return o(t)}));return c.append("tspan").classed("fdg-focus-annotation__label",!0).attr("x",(function(t){return s(t)})).attr("text-anchor",(function(t){return a(t)})).style("font-weight","bold").style("font-size","20px").attr("fill","black").text((function(t){return t.value})),c.append("tspan").classed("fdg-focus-annotation__event-count",!0).classed("fdg-hidden",!1===this.settings.eventCount).attr("x",(function(t){return s(t)})).attr("text-anchor",(function(t){return a(t)})).attr("dy","1.3em").style("font-weight","bold").attr("fill","black"),e}function L(){this.container=d3.select(this.element).append("div").classed("force-directed-graph",!0).datum(this),l.call(this),M.call(this),this.timer=this.container.append("div").classed("fdg-timer",!0).text("".concat(this.settings.timepoint," ").concat(this.settings.timeUnit)),I.call(this),this.freqTable=F.call(this),this.notes=this.container.append("div").classed("fdg-notes",!0),this.container=this.container.append("div").classed("fdg-container",!0),this.canvas=this.container.append("canvas").classed("fdg-canvas",!0).attr("width",this.settings.width).attr("height",this.settings.height),this.context=this.canvas.node().getContext("2d"),this.svg=this.container.append("svg").classed("fdg-svg",!0).attr("width",this.settings.width+200).attr("height",this.settings.height+200),this.orbits=q.call(this),this.focusAnnotations=D.call(this)}function U(){var t=this.data.every((function(t){return/^-?\d+\.?\d*$/.test(t.id)||/^-?\d*\.?\d+$/.test(t.id)}));this.data.sort((function(e,n){var i=t?+e.id-+n.id:e.id<n.id?-1:n.id<e.id?1:0,s=e.seq-n.seq;return i||s})).forEach((function(t){t.seq=parseInt(t.seq),t.duration=parseFloat(t.duration)}))}function $(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function H(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function N(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?H(Object(n),!0).forEach((function(e){$(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):H(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function Q(t){return this.metadata.event.map((function(e){return{value:e.value,order:e.order,count:0,duration:0,totalDuration:d3.sum(t.filter((function(t){return t.event===e.value})),(function(t){return t.duration}))}}))}function B(t){var e=this;return d3.sum(t.filter((function(t){return e.settings.eventChangeCount.includes(t.label)})),(function(t){return t.count}))}function G(){var t=this;return d3.nest().key((function(t){return t.id})).rollup((function(e){!function(t){t.forEach((function(e,n){e.timepoint=0===n?e.duration:e.duration+t[n-1].timepoint,0===n?(e.start_timepoint=1,e.end_timepoint=e.duration):(e.start_timepoint=t[n-1].end_timepoint+1,e.end_timepoint=e.start_timepoint+e.duration)}))}(e);var n=u.call(t,e,0),i=Q.call(t,e),s=(x.call(t,i,n.event),x.call(t,t.metadata.event,n.event)),a=y.call(t,s),o=B.call(t,i),r=f.call(t,o),c=v.call(t,o);return N(N({state:n,x:s.x,y:s.y,events:i,duration:d3.sum(e,(function(t){return t.duration})),moves:0,nextStateChange:n.duration,movesSinceChange:0,group:e,stateChanges:o},a),{},{r:r},c)})).entries(this.data)}function X(){var t=this;U.call(this),this.data.nested=G.call(this),this.metadata.event.forEach((function(e){e.data=t.data.nested.filter((function(t){return t.value.state.event===e.value}))}))}function Y(){var t=this;this.context.clearRect(0,0,this.settings.width,this.settings.height),this.context.save(),this.settings.translate&&this.context.translate(-(this.settings.width/2-100),-(this.settings.height/2-100)),this.data.nested.sort((function(t,e){return t.value.stateChanges-e.value.stateChanges})).forEach((function(e,n){t.context.beginPath(),t.context.arc(e.x,e.y,e.value.r,0,2*Math.PI),t.context.strokeStyle=e.value.stroke,t.context.stroke()})),this.context.restore()}function J(t){var e=d3.forceSimulation().nodes(t.data).alphaDecay(.005).velocityDecay(.9).force("center",d3.forceCenter(this.settings.width/2,this.settings.height/2)).force("x",d3.forceX(t.x).strength(.3)).force("y",d3.forceY(t.y).strength(.3)).force("charge",d3.forceManyBodyReuse().strength(-2e3/this.metadata.id.length)).on("tick",Y.bind(this));return e.force("collide",d3.forceCollide().radius(this.settings.minRadius+.5)),e}function K(){var t=this;this.metadata.event.forEach((function(e){e.forceSimulation=J.call(t,e)})),"play"===this.settings.playPause&&(this.interval=w.call(this))}return function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"body",s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a={data:e,element:n,settings:Object.assign(i,s),util:t};return a.metadata=c.call(a),L.call(a),X.call(a),K.call(a),a}}));
