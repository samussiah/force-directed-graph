!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).forceDirectedGraph=e()}(this,(function(){"use strict";var t={csv:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=t.join(", ");return e&&(n=n.replace(/, ([^,]*)$/," and $1")),n}};function e(){return["#a50026","#f46d43","#fdae61","#a6d96a","#66bd63","#006837"].reverse()}function n(){var t=e();return d3.scaleLinear().domain(d3.range(t.length)).range(t).clamp(!0)}var i={id_var:"id",event_var:"event",event_order_var:"event_order",start_timepoint_var:"stdy",end_timepoint_var:"endy",duration_var:"duration",sequence_var:"seq",timepoint:0,timeUnit:"days since randomization",duration:null,resetDelay:15e3,events:null,eventCentral:null,eventCount:!0,eventChangeCount:null,eventChangeCountAesthetic:"color",individualCounts:null,individualCountEvents:null,excludeFirst:!0,excludeLast:!0,speed:"slow",speeds:{slow:1e3,medium:500,fast:50},playPause:"play",width:null,height:null,padding:1,nOrbits:null,orbitRadius:150,nFoci:null,translate:!1,hideControls:!1,colorBy:{type:"frequency",variable:null,label:null},colors:e,colorScale:n,color:function(t){return n()(Math.min(t,n().domain().length))},fill:null,minRadius:null,maxRadius:null,shape:"circle",modal:!0,modalSpeed:15e3,modalIndex:0,explanation:["Each bubble in this animation represents an individual.","As individuals experience events and change states, their bubble gravitates toward the focus representing that event.","The number of state changes dictates the color and/or size of the bubbles.","Use the controls on the right to interact with and alter the animation."],information:null};function r(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function o(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function a(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?o(Object(n),!0).forEach((function(e){r(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function s(t){return function(t){if(Array.isArray(t))return c(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||u(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(t,e){if(t){if("string"==typeof t)return c(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?c(t,e):void 0}}function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function l(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=u(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function h(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"div",i=e.append(n).classed("fdg-".concat(t),!0);return i}function f(t){var e=h("controls",t).classed("fdg-hidden",this.settings.hideControls);h("hide",e,"span");return{controls:e}}var d="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var p=function(t,e,n){return t(n={path:e,exports:{},require:function(t,e){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==e&&n.path)}},n.exports),n.exports}((function(t,e){
/*! Shifty 2.12.0 - https://github.com/jeremyckahn/shifty */
var n;n=function(){return function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){n.r(e),n.d(e,"processTweens",(function(){return it})),n.d(e,"Tweenable",(function(){return at})),n.d(e,"tween",(function(){return st})),n.d(e,"interpolate",(function(){return Rt})),n.d(e,"Scene",(function(){return Bt})),n.d(e,"setBezierFunction",(function(){return Vt})),n.d(e,"unsetBezierFunction",(function(){return $t}));var i={};n.r(i),n.d(i,"linear",(function(){return o})),n.d(i,"easeInQuad",(function(){return a})),n.d(i,"easeOutQuad",(function(){return s})),n.d(i,"easeInOutQuad",(function(){return u})),n.d(i,"easeInCubic",(function(){return c})),n.d(i,"easeOutCubic",(function(){return l})),n.d(i,"easeInOutCubic",(function(){return h})),n.d(i,"easeInQuart",(function(){return f})),n.d(i,"easeOutQuart",(function(){return p})),n.d(i,"easeInOutQuart",(function(){return g})),n.d(i,"easeInQuint",(function(){return v})),n.d(i,"easeOutQuint",(function(){return y})),n.d(i,"easeInOutQuint",(function(){return m})),n.d(i,"easeInSine",(function(){return _})),n.d(i,"easeOutSine",(function(){return b})),n.d(i,"easeInOutSine",(function(){return w})),n.d(i,"easeInExpo",(function(){return x})),n.d(i,"easeOutExpo",(function(){return C})),n.d(i,"easeInOutExpo",(function(){return S})),n.d(i,"easeInCirc",(function(){return k})),n.d(i,"easeOutCirc",(function(){return O})),n.d(i,"easeInOutCirc",(function(){return A})),n.d(i,"easeOutBounce",(function(){return P})),n.d(i,"easeInBack",(function(){return j})),n.d(i,"easeOutBack",(function(){return M})),n.d(i,"easeInOutBack",(function(){return T})),n.d(i,"elastic",(function(){return E})),n.d(i,"swingFromTo",(function(){return I})),n.d(i,"swingFrom",(function(){return F})),n.d(i,"swingTo",(function(){return R})),n.d(i,"bounce",(function(){return N})),n.d(i,"bouncePast",(function(){return W})),n.d(i,"easeFromTo",(function(){return q})),n.d(i,"easeFrom",(function(){return D})),n.d(i,"easeTo",(function(){return z}));var r={};n.r(r),n.d(r,"doesApply",(function(){return Ot})),n.d(r,"tweenCreated",(function(){return At})),n.d(r,"beforeTween",(function(){return Pt})),n.d(r,"afterTween",(function(){return jt}));
/*!
                         * All equations are adapted from Thomas Fuchs'
                         * [Scripty2](https://github.com/madrobby/scripty2/blob/master/src/effects/transitions/penner.js).
                         *
                         * Based on Easing Equations (c) 2003 [Robert
                         * Penner](http://www.robertpenner.com/), all rights reserved. This work is
                         * [subject to terms](http://www.robertpenner.com/easing_terms_of_use.html).
                         */
/*!
                         *  TERMS OF USE - EASING EQUATIONS
                         *  Open source under the BSD License.
                         *  Easing Equations (c) 2003 Robert Penner, all rights reserved.
                         */
var o=function(t){return t},a=function(t){return Math.pow(t,2)},s=function(t){return-(Math.pow(t-1,2)-1)},u=function(t){return(t/=.5)<1?.5*Math.pow(t,2):-.5*((t-=2)*t-2)},c=function(t){return Math.pow(t,3)},l=function(t){return Math.pow(t-1,3)+1},h=function(t){return(t/=.5)<1?.5*Math.pow(t,3):.5*(Math.pow(t-2,3)+2)},f=function(t){return Math.pow(t,4)},p=function(t){return-(Math.pow(t-1,4)-1)},g=function(t){return(t/=.5)<1?.5*Math.pow(t,4):-.5*((t-=2)*Math.pow(t,3)-2)},v=function(t){return Math.pow(t,5)},y=function(t){return Math.pow(t-1,5)+1},m=function(t){return(t/=.5)<1?.5*Math.pow(t,5):.5*(Math.pow(t-2,5)+2)},_=function(t){return 1-Math.cos(t*(Math.PI/2))},b=function(t){return Math.sin(t*(Math.PI/2))},w=function(t){return-.5*(Math.cos(Math.PI*t)-1)},x=function(t){return 0===t?0:Math.pow(2,10*(t-1))},C=function(t){return 1===t?1:1-Math.pow(2,-10*t)},S=function(t){return 0===t?0:1===t?1:(t/=.5)<1?.5*Math.pow(2,10*(t-1)):.5*(2-Math.pow(2,-10*--t))},k=function(t){return-(Math.sqrt(1-t*t)-1)},O=function(t){return Math.sqrt(1-Math.pow(t-1,2))},A=function(t){return(t/=.5)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},P=function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},j=function(t){var e=1.70158;return t*t*((e+1)*t-e)},M=function(t){var e=1.70158;return(t-=1)*t*((e+1)*t+e)+1},T=function(t){var e=1.70158;return(t/=.5)<1?t*t*((1+(e*=1.525))*t-e)*.5:.5*((t-=2)*t*((1+(e*=1.525))*t+e)+2)},E=function(t){return-1*Math.pow(4,-8*t)*Math.sin((6*t-1)*(2*Math.PI)/2)+1},I=function(t){var e=1.70158;return(t/=.5)<1?t*t*((1+(e*=1.525))*t-e)*.5:.5*((t-=2)*t*((1+(e*=1.525))*t+e)+2)},F=function(t){var e=1.70158;return t*t*((e+1)*t-e)},R=function(t){var e=1.70158;return(t-=1)*t*((e+1)*t+e)+1},N=function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},W=function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?2-(7.5625*(t-=1.5/2.75)*t+.75):t<2.5/2.75?2-(7.5625*(t-=2.25/2.75)*t+.9375):2-(7.5625*(t-=2.625/2.75)*t+.984375)},q=function(t){return(t/=.5)<1?.5*Math.pow(t,4):-.5*((t-=2)*Math.pow(t,3)-2)},D=function(t){return Math.pow(t,4)},z=function(t){return Math.pow(t,.25)};function L(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return B(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?B(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function B(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function Q(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function V(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function $(t){return($="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function U(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function Y(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?U(Object(n),!0).forEach((function(e){G(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):U(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function G(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var H="undefined"!=typeof window?window:d,X=H.requestAnimationFrame||H.webkitRequestAnimationFrame||H.oRequestAnimationFrame||H.msRequestAnimationFrame||H.mozCancelRequestAnimationFrame&&H.mozRequestAnimationFrame||setTimeout,J=function(){},K=null,Z=null,tt=Y({},i),et=function(t,e,n,i,r,o,a){var s=t<o?0:(t-o)/r;for(var u in e){var c=a[u],l=c.call?c:tt[c],h=n[u];e[u]=h+(i[u]-h)*l(s)}return e},nt=function(t,e){var n=t._data,i=t._currentState,r=t._delay,o=t._easing,a=t._originalState,s=t._duration,u=t._render,c=t._targetState,l=t._timestamp,h=l+r+s,f=e>h?h:e,d=s-(h-f);f>=h?(u(c,n,d),t.stop(!0)):(t._applyFilter("beforeTween"),f<l+r?(f=1,s=1,l=1):l+=r,et(f,i,a,c,s,l,o),t._applyFilter("afterTween"),u(i,n,d))},it=function(){for(var t=at.now(),e=K;e;){var n=e._next;nt(e,t),e=n}},rt=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"linear",n={},i=$(e);if("string"===i||"function"===i)for(var r in t)n[r]=e;else for(var o in t)n[o]=e[o]||"linear";return n},ot=function(t){if(t===K)(K=t._next)?K._previous=null:Z=null;else if(t===Z)(Z=t._previous)?Z._next=null:K=null;else{var e=t._previous,n=t._next;e._next=n,n._previous=e}t._previous=t._next=null},at=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;Q(this,t),G(this,"_config",null),G(this,"_data",{}),G(this,"_filters",[]),G(this,"_next",null),G(this,"_previous",null),G(this,"_timestamp",null),G(this,"_resolve",null),G(this,"_reject",null),this._currentState=e,n&&this.setConfig(n)}var e,n,i;return e=t,(n=[{key:"_applyFilter",value:function(t){var e,n=L(this._filters);try{for(n.s();!(e=n.n()).done;){var i=e.value[t];i&&i(this)}}catch(t){n.e(t)}finally{n.f()}}},{key:"tween",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,n=this._data,i=this._config;return this._isPlaying&&this.stop(),!e&&i||this.setConfig(e),this._pausedAtTime=null,this._timestamp=t.now(),this._start(this.get(),n),this.resume()}},{key:"setConfig",value:function(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=Y(Y({},this._config),n),r=this._config=i,o=r.attachment,a=r.data,s=r.duration,u=void 0===s?500:s,c=r.easing,l=r.promise,h=void 0===l?Promise:l,f=r.start,d=void 0===f?J:f,p=r.render,g=void 0===p?i.step||J:p,v=r.step,y=void 0===v?J:v,m=n.delay,_=void 0===m?0:m,b=n.from,w=n.to;this._data=a||o||this._data,this._isPlaying=!1,this._pausedAtTime=null,this._scheduleId=null,this._delay=_,this._start=d,this._render=g||y,this._duration=u,this._currentState=Y({},b||this.get()),this._originalState=this.get(),this._targetState=Y({},w||this.get());var x=this._currentState;this._targetState=Y(Y({},x),this._targetState),this._easing=rt(x,c);var C=t.filters;for(var S in this._filters.length=0,C)C[S].doesApply(this)&&this._filters.push(C[S]);return this._applyFilter("tweenCreated"),this._promise=new h((function(t,n){e._resolve=t,e._reject=n})),this._promise.catch(J),this}},{key:"get",value:function(){return Y({},this._currentState)}},{key:"set",value:function(t){this._currentState=t}},{key:"pause",value:function(){if(this._isPlaying)return this._pausedAtTime=t.now(),this._isPlaying=!1,ot(this),this}},{key:"resume",value:function(){if(null===this._timestamp)return this.tween();if(this._isPlaying)return this._promise;var e=t.now();return this._pausedAtTime&&(this._timestamp+=e-this._pausedAtTime,this._pausedAtTime=null),this._isPlaying=!0,null===K?(K=this,Z=this,function t(){K&&(X.call(H,t,1e3/60),it())}()):(this._previous=Z,Z._next=this,Z=this),this._promise}},{key:"seek",value:function(e){e=Math.max(e,0);var n=t.now();return this._timestamp+e===0||(this._timestamp=n-e,this._isPlaying||nt(this,n)),this}},{key:"stop",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=this._currentState,n=this._data,i=this._easing,r=this._originalState,o=this._resolve,a=this._targetState;return this._isPlaying?(this._isPlaying=!1,ot(this),t&&(this._applyFilter("beforeTween"),et(1,e,r,a,1,0,i),this._applyFilter("afterTween"),this._applyFilter("afterTweenEnd")),o&&o({data:n,state:e,tweenable:this}),this._resolve=null,this._reject=null,this):this}},{key:"cancel",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=this._currentState,n=this._data,i=this._isPlaying;return i?(this._reject({data:n,state:e,tweenable:this}),this._resolve=null,this._reject=null,this.stop(t)):this}},{key:"isPlaying",value:function(){return this._isPlaying}},{key:"setScheduleFunction",value:function(e){t.setScheduleFunction(e)}},{key:"data",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return t&&(this._data=Y({},t)),this._data}},{key:"dispose",value:function(){for(var t in this)delete this[t]}}])&&V(e.prototype,n),i&&V(e,i),t}();function st(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=new at,n=e.tween(t);return n.tweenable=e,n}at.setScheduleFunction=function(t){return X=t},at.formulas=tt,at.filters={},at.now=Date.now||function(){return+new Date};var ut,ct,lt=/(\d|-|\.)/,ht=/([^\-0-9.]+)/g,ft=/[0-9.-]+/g,dt=(ut=ft.source,ct=/,\s*/.source,new RegExp("rgb\\(".concat(ut).concat(ct).concat(ut).concat(ct).concat(ut,"\\)"),"g")),pt=/^.*\(/,gt=/#([0-9]|[a-f]){3,6}/gi,vt=function(t,e){return t.map((function(t,n){return"_".concat(e,"_").concat(n)}))};function yt(t){return parseInt(t,16)}var mt=function(t){return"rgb(".concat((e=t,3===(e=e.replace(/#/,"")).length&&(e=(e=e.split(""))[0]+e[0]+e[1]+e[1]+e[2]+e[2]),[yt(e.substr(0,2)),yt(e.substr(2,2)),yt(e.substr(4,2))]).join(","),")");var e},_t=function(t,e,n){var i=e.match(t),r=e.replace(t,"VAL");return i&&i.forEach((function(t){return r=r.replace("VAL",n(t))})),r},bt=function(t){for(var e in t){var n=t[e];"string"==typeof n&&n.match(gt)&&(t[e]=_t(gt,n,mt))}},wt=function(t){var e=t.match(ft).map(Math.floor),n=t.match(pt)[0];return"".concat(n).concat(e.join(","),")")},xt=function(t){return t.match(ft)},Ct=function(t,e){var n={};return e.forEach((function(e){n[e]=t[e],delete t[e]})),n},St=function(t,e){return e.map((function(e){return t[e]}))},kt=function(t,e){return e.forEach((function(e){return t=t.replace("VAL",+e.toFixed(4))})),t},Ot=function(t){var e=t._currentState;return Object.keys(e).some((function(t){return"string"==typeof e[t]}))};function At(t){var e=t._currentState;[e,t._originalState,t._targetState].forEach(bt),t._tokenData=function(t){var e,n,i={};for(var r in t){var o=t[r];"string"==typeof o&&(i[r]={formatString:(e=o,n=void 0,n=e.match(ht),n?(1===n.length||e.charAt(0).match(lt))&&n.unshift(""):n=["",""],n.join("VAL")),chunkNames:vt(xt(o),r)})}return i}(e)}function Pt(t){var e=t._currentState,n=t._originalState,i=t._targetState,r=t._easing,o=t._tokenData;!function(t,e){var n=function(n){var i=e[n].chunkNames,r=t[n];if("string"==typeof r){var o=r.split(" "),a=o[o.length-1];i.forEach((function(e,n){return t[e]=o[n]||a}))}else i.forEach((function(e){return t[e]=r}));delete t[n]};for(var i in e)n(i)}(r,o),[e,n,i].forEach((function(t){return function(t,e){var n=function(n){xt(t[n]).forEach((function(i,r){return t[e[n].chunkNames[r]]=+i})),delete t[n]};for(var i in e)n(i)}(t,o)}))}function jt(t){var e=t._currentState,n=t._originalState,i=t._targetState,r=t._easing,o=t._tokenData;[e,n,i].forEach((function(t){return function(t,e){for(var n in e){var i=e[n],r=i.chunkNames,o=i.formatString,a=kt(o,St(Ct(t,r),r));t[n]=_t(dt,a,wt)}}(t,o)})),function(t,e){for(var n in e){var i=e[n].chunkNames,r=t[i[0]];t[n]="string"==typeof r?i.map((function(e){var n=t[e];return delete t[e],n})).join(" "):r}}(r,o)}function Mt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function Tt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Mt(Object(n),!0).forEach((function(e){Et(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Mt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function Et(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var It=new at,Ft=at.filters,Rt=function(t,e,n,i){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=Tt({},t),a=rt(t,i);for(var s in It._filters.length=0,It.set({}),It._currentState=o,It._originalState=t,It._targetState=e,It._easing=a,Ft)Ft[s].doesApply(It)&&It._filters.push(Ft[s]);It._applyFilter("tweenCreated"),It._applyFilter("beforeTween");var u=et(n,o,t,e,1,r,a);return It._applyFilter("afterTween"),u};function Nt(t){return function(t){if(Array.isArray(t))return Wt(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return Wt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Wt(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Wt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function qt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Dt(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function zt(t,e){var n=e.get(t);if(!n)throw new TypeError("attempted to get private field on non-instance");return n.get?n.get.call(t):n.value}var Lt=new WeakMap,Bt=function(){function t(){qt(this,t),Lt.set(this,{writable:!0,value:[]});for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];n.forEach(this.add.bind(this))}var e,n,i;return e=t,(n=[{key:"add",value:function(t){return zt(this,Lt).push(t),t}},{key:"remove",value:function(t){var e=zt(this,Lt).indexOf(t);return~e&&zt(this,Lt).splice(e,1),t}},{key:"empty",value:function(){return this.tweenables.map(this.remove.bind(this))}},{key:"isPlaying",value:function(){return zt(this,Lt).some((function(t){return t.isPlaying()}))}},{key:"play",value:function(){return zt(this,Lt).forEach((function(t){return t.tween()})),this}},{key:"pause",value:function(){return zt(this,Lt).forEach((function(t){return t.pause()})),this}},{key:"resume",value:function(){return zt(this,Lt).forEach((function(t){return t.resume()})),this}},{key:"stop",value:function(t){return zt(this,Lt).forEach((function(e){return e.stop(t)})),this}},{key:"tweenables",get:function(){return Nt(zt(this,Lt))}},{key:"promises",get:function(){return zt(this,Lt).map((function(t){return t._promise}))}}])&&Dt(e.prototype,n),i&&Dt(e,i),t}();function Qt(t,e,n,i,r,o){var a,s,u=0,c=0,l=0,h=0,f=0,d=0,p=function(t){return((u*t+c)*t+l)*t},g=function(t){return(3*u*t+2*c)*t+l},v=function(t){return t>=0?t:0-t};return u=1-(l=3*e)-(c=3*(i-e)-l),h=1-(d=3*n)-(f=3*(r-n)-d),a=t,s=function(t){return 1/(200*t)}(o),function(t){return((h*t+f)*t+d)*t}(function(t,e){var n,i,r,o,a,s;for(r=t,s=0;s<8;s++){if(o=p(r)-t,v(o)<e)return r;if(a=g(r),v(a)<1e-6)break;r-=o/a}if((r=t)<(n=0))return n;if(r>(i=1))return i;for(;n<i;){if(o=p(r),v(o-t)<e)return r;t>o?n=r:i=r,r=.5*(i-n)+n}return r}(a,s))}var Vt=function(t,e,n,i,r){var o=function(t,e,n,i){return function(r){return Qt(r,t,e,n,i,1)}}(e,n,i,r);return o.displayName=t,o.x1=e,o.y1=n,o.x2=i,o.y2=r,at.formulas[t]=o},$t=function(t){return delete at.formulas[t]};at.filters.token=r}])},t.exports=n()})),g="Webkit Moz O ms".split(" ");function v(t,e,n){for(var i=t.style,r=0;r<g.length;++r){i[g[r]+y(e)]=n}i[e]=n}function y(t){return t.charAt(0).toUpperCase()+t.slice(1)}function m(t){return!function(t){return"[object Array]"===Object.prototype.toString.call(t)}(t)&&("object"===typeof t&&!!t)}function _(t,e){for(var n in t){if(t.hasOwnProperty(n))e(t[n],n)}}var b={extend:function t(e,n,i){for(var r in e=e||{},i=i||!1,n=n||{})if(n.hasOwnProperty(r)){var o=e[r],a=n[r];i&&m(o)&&m(a)?e[r]=t(o,a,i):e[r]=a}return e},render:function(t,e){var n=t;for(var i in e)if(e.hasOwnProperty(i)){var r=e[i],o=new RegExp("\\{"+i+"\\}","g");n=n.replace(o,r)}return n},setStyle:v,setStyles:function(t,e){_(e,(function(e,n){null!=e&&(m(e)&&!0===e.prefix?v(t,n,e.value):t.style[n]=e)}))},capitalize:y,isString:function(t){return"string"==typeof t||t instanceof String},isFunction:function(t){return"function"==typeof t},isObject:m,forEachObject:_,floatEquals:function(t,e){return Math.abs(t-e)<.001},removeChildren:function(t){for(;t.firstChild;)t.removeChild(t.firstChild)}},w=p.Tweenable,x={easeIn:"easeInCubic",easeOut:"easeOutCubic",easeInOut:"easeInOutCubic"},C=function t(e,n){if(!(this instanceof t))throw new Error("Constructor was called without new keyword");var i;n=b.extend({delay:0,duration:800,easing:"linear",from:{},to:{},step:function(){}},n),i=b.isString(e)?document.querySelector(e):e,this.path=i,this._opts=n,this._tweenable=null;var r=this.path.getTotalLength();this.path.style.strokeDasharray=r+" "+r,this.set(0)};C.prototype.value=function(){var t=this._getComputedDashOffset(),e=this.path.getTotalLength();return parseFloat((1-t/e).toFixed(6),10)},C.prototype.set=function(t){this.stop(),this.path.style.strokeDashoffset=this._progressToOffset(t);var e=this._opts.step;if(b.isFunction(e)){var n=this._easing(this._opts.easing);e(this._calculateTo(t,n),this._opts.shape||this,this._opts.attachment)}},C.prototype.stop=function(){this._stopTween(),this.path.style.strokeDashoffset=this._getComputedDashOffset()},C.prototype.animate=function(t,e,n){e=e||{},b.isFunction(e)&&(n=e,e={});var i=b.extend({},e),r=b.extend({},this._opts);e=b.extend(r,e);var o=this._easing(e.easing),a=this._resolveFromAndTo(t,o,i);this.stop(),this.path.getBoundingClientRect();var s=this._getComputedDashOffset(),u=this._progressToOffset(t),c=this;this._tweenable=new w,this._tweenable.tween({from:b.extend({offset:s},a.from),to:b.extend({offset:u},a.to),duration:e.duration,delay:e.delay,easing:o,step:function(t){c.path.style.strokeDashoffset=t.offset;var n=e.shape||c;e.step(t,n,e.attachment)}}).then((function(t){b.isFunction(n)&&n()}))},C.prototype._getComputedDashOffset=function(){var t=window.getComputedStyle(this.path,null);return parseFloat(t.getPropertyValue("stroke-dashoffset"),10)},C.prototype._progressToOffset=function(t){var e=this.path.getTotalLength();return e-t*e},C.prototype._resolveFromAndTo=function(t,e,n){return n.from&&n.to?{from:n.from,to:n.to}:{from:this._calculateFrom(e),to:this._calculateTo(t,e)}},C.prototype._calculateFrom=function(t){return p.interpolate(this._opts.from,this._opts.to,this.value(),t)},C.prototype._calculateTo=function(t,e){return p.interpolate(this._opts.from,this._opts.to,t,e)},C.prototype._stopTween=function(){null!==this._tweenable&&(this._tweenable.stop(),this._tweenable=null)},C.prototype._easing=function(t){return x.hasOwnProperty(t)?x[t]:t};var S=C,k="Object is destroyed",O=function t(e,n){if(!(this instanceof t))throw new Error("Constructor was called without new keyword");if(0!==arguments.length){this._opts=b.extend({color:"#555",strokeWidth:1,trailColor:null,trailWidth:null,fill:null,text:{style:{color:null,position:"absolute",left:"50%",top:"50%",padding:0,margin:0,transform:{prefix:!0,value:"translate(-50%, -50%)"}},autoStyleContainer:!0,alignToBottom:!0,value:null,className:"progressbar-text"},svgStyle:{display:"block",width:"100%"},warnings:!1},n,!0),b.isObject(n)&&void 0!==n.svgStyle&&(this._opts.svgStyle=n.svgStyle),b.isObject(n)&&b.isObject(n.text)&&void 0!==n.text.style&&(this._opts.text.style=n.text.style);var i,r=this._createSvgView(this._opts);if(!(i=b.isString(e)?document.querySelector(e):e))throw new Error("Container does not exist: "+e);this._container=i,this._container.appendChild(r.svg),this._opts.warnings&&this._warnContainerAspectRatio(this._container),this._opts.svgStyle&&b.setStyles(r.svg,this._opts.svgStyle),this.svg=r.svg,this.path=r.path,this.trail=r.trail,this.text=null;var o=b.extend({attachment:void 0,shape:this},this._opts);this._progressPath=new S(r.path,o),b.isObject(this._opts.text)&&null!==this._opts.text.value&&this.setText(this._opts.text.value)}};O.prototype.animate=function(t,e,n){if(null===this._progressPath)throw new Error(k);this._progressPath.animate(t,e,n)},O.prototype.stop=function(){if(null===this._progressPath)throw new Error(k);void 0!==this._progressPath&&this._progressPath.stop()},O.prototype.pause=function(){if(null===this._progressPath)throw new Error(k);void 0!==this._progressPath&&this._progressPath._tweenable&&this._progressPath._tweenable.pause()},O.prototype.resume=function(){if(null===this._progressPath)throw new Error(k);void 0!==this._progressPath&&this._progressPath._tweenable&&this._progressPath._tweenable.resume()},O.prototype.destroy=function(){if(null===this._progressPath)throw new Error(k);this.stop(),this.svg.parentNode.removeChild(this.svg),this.svg=null,this.path=null,this.trail=null,this._progressPath=null,null!==this.text&&(this.text.parentNode.removeChild(this.text),this.text=null)},O.prototype.set=function(t){if(null===this._progressPath)throw new Error(k);this._progressPath.set(t)},O.prototype.value=function(){if(null===this._progressPath)throw new Error(k);return void 0===this._progressPath?0:this._progressPath.value()},O.prototype.setText=function(t){if(null===this._progressPath)throw new Error(k);null===this.text&&(this.text=this._createTextContainer(this._opts,this._container),this._container.appendChild(this.text)),b.isObject(t)?(b.removeChildren(this.text),this.text.appendChild(t)):this.text.innerHTML=t},O.prototype._createSvgView=function(t){var e=document.createElementNS("http://www.w3.org/2000/svg","svg");this._initializeSvg(e,t);var n=null;(t.trailColor||t.trailWidth)&&(n=this._createTrail(t),e.appendChild(n));var i=this._createPath(t);return e.appendChild(i),{svg:e,path:i,trail:n}},O.prototype._initializeSvg=function(t,e){t.setAttribute("viewBox","0 0 100 100")},O.prototype._createPath=function(t){var e=this._pathString(t);return this._createPathElement(e,t)},O.prototype._createTrail=function(t){var e=this._trailString(t),n=b.extend({},t);return n.trailColor||(n.trailColor="#eee"),n.trailWidth||(n.trailWidth=n.strokeWidth),n.color=n.trailColor,n.strokeWidth=n.trailWidth,n.fill=null,this._createPathElement(e,n)},O.prototype._createPathElement=function(t,e){var n=document.createElementNS("http://www.w3.org/2000/svg","path");return n.setAttribute("d",t),n.setAttribute("stroke",e.color),n.setAttribute("stroke-width",e.strokeWidth),e.fill?n.setAttribute("fill",e.fill):n.setAttribute("fill-opacity","0"),n},O.prototype._createTextContainer=function(t,e){var n=document.createElement("div");n.className=t.text.className;var i=t.text.style;return i&&(t.text.autoStyleContainer&&(e.style.position="relative"),b.setStyles(n,i),i.color||(n.style.color=t.color)),this._initializeTextContainer(t,e,n),n},O.prototype._initializeTextContainer=function(t,e,n){},O.prototype._pathString=function(t){throw new Error("Override this function for each progress bar")},O.prototype._trailString=function(t){throw new Error("Override this function for each progress bar")},O.prototype._warnContainerAspectRatio=function(t){if(this.containerAspectRatio){var e=window.getComputedStyle(t,null),n=parseFloat(e.getPropertyValue("width"),10),i=parseFloat(e.getPropertyValue("height"),10);b.floatEquals(this.containerAspectRatio,n/i)||(console.warn("Incorrect aspect ratio of container","#"+t.id,"detected:",e.getPropertyValue("width")+"(width)","/",e.getPropertyValue("height")+"(height)","=",n/i),console.warn("Aspect ratio of should be",this.containerAspectRatio))}};var A=O,P=function(t,e){this._pathTemplate="M 0,{center} L 100,{center}",A.apply(this,arguments)};(P.prototype=new A).constructor=P,P.prototype._initializeSvg=function(t,e){t.setAttribute("viewBox","0 0 100 "+e.strokeWidth),t.setAttribute("preserveAspectRatio","none")},P.prototype._pathString=function(t){return b.render(this._pathTemplate,{center:t.strokeWidth/2})},P.prototype._trailString=function(t){return this._pathString(t)};var j=P,M=function(t,e){this._pathTemplate="M 50,50 m 0,-{radius} a {radius},{radius} 0 1 1 0,{2radius} a {radius},{radius} 0 1 1 0,-{2radius}",this.containerAspectRatio=1,A.apply(this,arguments)};(M.prototype=new A).constructor=M,M.prototype._pathString=function(t){var e=t.strokeWidth;t.trailWidth&&t.trailWidth>t.strokeWidth&&(e=t.trailWidth);var n=50-e/2;return b.render(this._pathTemplate,{radius:n,"2radius":2*n})},M.prototype._trailString=function(t){return this._pathString(t)};var T=M,E=function(t,e){this._pathTemplate="M 50,50 m -{radius},0 a {radius},{radius} 0 1 1 {2radius},0",this.containerAspectRatio=2,A.apply(this,arguments)};(E.prototype=new A).constructor=E,E.prototype._initializeSvg=function(t,e){t.setAttribute("viewBox","0 0 100 50")},E.prototype._initializeTextContainer=function(t,e,n){t.text.style&&(n.style.top="auto",n.style.bottom="0",t.text.alignToBottom?b.setStyle(n,"transform","translate(-50%, 0)"):b.setStyle(n,"transform","translate(-50%, 50%)"))},E.prototype._pathString=T.prototype._pathString,E.prototype._trailString=T.prototype._trailString;var I=E,F=function(t,e){this._pathTemplate="M 0,{halfOfStrokeWidth} L {width},{halfOfStrokeWidth} L {width},{width} L {halfOfStrokeWidth},{width} L {halfOfStrokeWidth},{strokeWidth}",this._trailTemplate="M {startMargin},{halfOfStrokeWidth} L {width},{halfOfStrokeWidth} L {width},{width} L {halfOfStrokeWidth},{width} L {halfOfStrokeWidth},{halfOfStrokeWidth}",A.apply(this,arguments)};(F.prototype=new A).constructor=F,F.prototype._pathString=function(t){var e=100-t.strokeWidth/2;return b.render(this._pathTemplate,{width:e,strokeWidth:t.strokeWidth,halfOfStrokeWidth:t.strokeWidth/2})},F.prototype._trailString=function(t){var e=100-t.strokeWidth/2;return b.render(this._trailTemplate,{width:e,strokeWidth:t.strokeWidth,halfOfStrokeWidth:t.strokeWidth/2,startMargin:t.strokeWidth/2-t.trailWidth/2})};var R={Line:j,Circle:T,SemiCircle:I,Square:F,Path:S,Shape:A,utils:b};function N(t){var e=h("sidebar",t),n=h("legends",e),i=h("progress",e),r=h("timer",i);return i.circle=new R.Circle(i.node(),{color:"#555",trailColor:"#ccc",strokeWidth:4,trailWidth:1,easing:"easeInOut",duration:1,text:{autoStyleContainer:!1},from:{color:"#aaa",width:1},to:{color:"#333",width:4},step:function(t,e){e.path.setAttribute("stroke",t.color),e.path.setAttribute("stroke-width",t.width),e.setText("".concat(e.value()<.0095?d3.format(".1%")(e.value()):d3.format(".0%")(e.value())," complete"))}}),{sidebar:e,legends:n,progress:i,timer:r,countdown:h("countdown",i).selectAll("div").data(d3.range(-1,this.settings.resetDelay/1e3)).join("div").text((function(t){return"Looping in ".concat(t+1," second").concat(0===t?"":"s")})).classed("fdg-hidden",!0),freqTable:h("freq-table",e)}}function W(t){var e=h("animation",t);this.settings.width=e.node().clientWidth,this.settings.height=e.node().clientHeight;var n=h("svg--background",e,"svg").attr("width",this.settings.width).attr("height",this.settings.height),i=h("canvas",e,"canvas").attr("width",this.settings.width).attr("height",this.settings.height);return i.context=i.node().getContext("2d"),{animation:e,svgBackground:n,canvas:i,svgForeground:h("svg--foreground",e,"svg").attr("width",this.settings.width).attr("height",this.settings.height),modal:h("modal",e)}}function q(){var t=h("main",d3.select(this.element)),e=f.call(this,t),n=N.call(this,t),i=W.call(this,t);return a(a(a({main:t},e),n),i)}function D(){var t=d3.nest().key((function(t){return t.id})).rollup((function(t){return d3.sum(t,(function(t){return+t.duration}))})).entries(this.data);return t.forEach((function(t){t.duration=t.value,t.value=t.key,delete t.key})),t}function z(){var t=d3.nest().key((function(t){return t.event})).rollup((function(t){var e=t[0];return{order:parseInt(e.event_order),position:e.hasOwnProperty("event_position")?parseInt(e.event_position):0,count:0,prevCount:0,cumulative:0,nEvents:t.length}})).entries(this.data);return t.forEach((function(t){Object.assign(t,t.value),t.value=t.key,delete t.key})),t.sort((function(t,e){return t.order-e.order||e.nEvents-t.nEvents})),t}function L(t){var e=this;return d3.nest().key((function(t){return t.order})).entries(t.filter((function(t){return t.value!==e.settings.eventCentral})))}function B(t){var e=this;this.settings.orbitRadius=this.settings.width/(t.orbit.length+1);var n=this.settings.orbitRadius/2,i=this.settings.height/2,r=2*Math.PI/(this.settings.nFoci||t.event.length-!!this.settings.eventCentral-1);t.event.forEach((function(t,o){t.radius=t.order*e.settings.orbitRadius,t.theta=0!==t.position?2*Math.PI*t.position/360:function(t){return 0===t?0:1===t?-1.75:2===t?.75:3===t?-.25:4===t?.25:0}(o)*r,t.x=0===t.order?n:n+t.radius*Math.cos(t.theta),t.y=0===t.order?i:i+t.radius*Math.sin(t.theta)})),t.orbit.forEach((function(t,r){t.cx=n,t.cy=i,t.r=(r+1)*e.settings.orbitRadius}))}function Q(){var t=this,e={};e.id=D.call(this),this.settings.duration=this.settings.duration||d3.max(e.id,(function(t){return t.duration})),this.settings.minRadius=this.settings.minRadius||3e3/e.id.length,this.settings.maxRadius=this.settings.maxRadius||this.settings.minRadius+this.settings.colors().length,this.settings.fill=this.settings.fill||e.id.length<=2500,e.event=z.call(this),this.settings.width=this.settings.width||e.event.length,this.settings.eventCentral=this.settings.eventCentral||e.event[0].value,this.settings.eventFinal=Array.isArray(this.settings.eventFinal)&&this.settings.eventFinal.length?this.settings.eventFinal:[this.settings.eventFinal||e.event[e.event.length-1].value],this.settings.nFoci=this.settings.nFoci||e.event.length-!!this.settings.eventCentral,this.settings.eventChangeCount=this.settings.eventChangeCount||e.event.slice(1).map((function(t){return t.value})),this.settings.eventSequence=e.event.filter((function(n,i){return!!t.settings.excludeLast&&i!==e.event.length-1})).filter((function(e,n){return!!t.settings.excludeFirst&&0!==n})).map((function(t){return t.value})),this.settings.R=this.settings.width/e.event.length/2,e.orbit=L.call(this,e.event),B.call(this,e);var n=this.settings.colors();return"frequency"===this.settings.colorBy.type?this.colorScale=d3.scaleLinear().domain(d3.range(n.length)).range(n).clamp(!0):"continuous"===this.settings.colorBy.type?this.colorScale=d3.scaleSequential().domain(d3.extent(this.data,(function(e){return e[t.settings.colorBy.variable]})).reverse()).interpolator(d3.interpolateRdYlGn).clamp(!0):"categorical"===this.settings.colorBy.type&&(this.colorScale=d3.scaleOrdinal().domain(s(new Set(this.data.map((function(e){return e[t.settings.colorBy.variable]}))).values())).range(d3.schemeTableau10)),e}function V(t,e){var n=this;return void 0!==e?t[e]:t.find((function(e,i){return e.start_timepoint<=n.settings.timepoint&&n.settings.timepoint<=e.end_timepoint||i===t.length-1}))}function $(t){var e=this;return t.filter((function(t){return t.start_timepoint<=e.settings.timepoint})).sort((function(t,e){return t.start_timepoint-e.start_timepoint})).filter((function(t,n,i){var r=i[n-1]?i[n-1].event:null;return!e.settings.eventChangeCount.includes(r)&&e.settings.eventChangeCount.includes(t.event)})).length}function U(t){return"color"!==this.settings.eventChangeCountAesthetic?Math.min(this.settings.minRadius+t,this.settings.maxRadius):this.settings.minRadius}function Y(t){var e="size"!==this.settings.eventChangeCountAesthetic?this.settings.color(t):"rgb(170,170,170)",n=e.replace("rgb","rgba").replace(")",", 0.5)"),i=e.replace("rgb","rgba").replace(")",", 1)");return{color:e,fill:n,stroke:i}}function G(){var t=this;this.metadata.event.forEach((function(t){t.prevCount=t.count})),this.data.nested.forEach((function(e){e.value.statePrevious=e.value.state,e.value.state=V.call(t,e.value.group),e.value.nStateChanges=$.call(t,e.value.group),e.value.r=U.call(t,e.value.nStateChanges),Object.assign(e.value,Y.call(t,e.value.nStateChanges))})),this.metadata.event.forEach((function(e){e.data=t.data.nested.filter((function(t){return t.value.state.event===e.value})),e.count=e.data.length,e.cumulative=t.data.filter((function(n){return n.event===e.value&&n.start_timepoint<=t.settings.timepoint})).length,e.change=e.count-e.prevCount}))}function H(){var t=this;this.orbits.each((function(e){e.change=d3.sum(e.values,(function(t){return t.change})),e.change>0&&d3.select(this).transition().duration(t.settings.speeds[t.settings.speed]/2).attr("stroke-width",.5*e.change).transition().duration(t.settings.speeds[t.settings.speed]/2).attr("stroke-width",.5)}))}function X(){var t=this;this.controls.timepoint.inputs.property("value",this.settings.timepoint),this.containers.timer.text("".concat(this.settings.timepoint," ").concat(this.settings.timeUnit)),this.containers.progress.attr("title","The animation is ".concat(d3.format(".1%")(this.settings.timepoint/this.settings.duration)," complete with ").concat(this.settings.duration-this.settings.timepoint," ").concat(this.settings.timeUnit.split(" ")[0]," to go.")),this.containers.progress.circle.animate(this.settings.timepoint/this.settings.duration),this.settings.eventCount&&this.focusAnnotations.selectAll("tspan.fdg-focus-annotation__event-count").text((function(e){return"".concat(e.count," (").concat(d3.format(".1%")(e.count/t.data.nested.length),")")})),this.freqTable.tr.selectAll("td").data((function(t){return[t.value,t.cumulative]})).join("td").text((function(t){return t}))}function J(){G.call(this),H.call(this),X.call(this)}function K(){var t=this,e=this.settings.resetDelay/1e3-1;return this.containers.countdown.classed("fdg-hidden",(function(t){return t!==e})),window.setInterval((function(){e--,t.containers.countdown.classed("fdg-hidden",(function(t){return t!==e}))}),1e3)}function Z(t){d3.select(this).transition().duration(t/15).delay(t-t/15*2).style("opacity",0)}function tt(t,e){t.style("opacity",0).transition().duration(e/15).style("opacity",1).on("end",(function(){Z.call(this,e)}))}function et(){var t=this;this.containers.modal.text(this.settings.text[this.settings.modalIndex]).call(tt,this.settings.modalSpeed),this.modal=d3.interval((function(){t.settings.modalIndex++,t.settings.modalIndex===t.settings.text.length-1&&(t.settings.modalIndex=0),t.containers.modal.text(t.settings.text[t.settings.modalIndex]).call(tt,t.settings.modalSpeed)}),this.settings.modalSpeed)}function nt(){var t=this;this.settings.timepoint=0,this.settings.notesIndex=0,this.controls.timepoint.inputs.attr("value",0),this.metadata.event.forEach((function(t){t.prevCount=0,t.count=0,t.cumulative=0})),this.data.nested.forEach((function(e){e.value.statePrevious=null,e.value.state=V.call(t,e.value.group,0),e.value.nStateChanges=$.call(t,e.value.group),e.value.r=U.call(t,e.value.nStateChanges),Object.assign(e.value,Y.call(t,e.value.nStateChanges))})),this.modal&&this.modal.stop(),et.call(this)}function it(t){var e=this,n=window.setTimeout((function(){nt.call(e),e.containers.timer.text("".concat(e.settings.timepoint," ").concat(e.settings.timeUnit)),e.containers.progress.circle.animate(e.settings.timepoint/e.settings.duration),window.clearInterval(t),window.clearTimeout(n),e.containers.countdown.classed("fdg-hidden",!0),e.interval=st.call(e)}),this.settings.resetDelay);return n}function rt(){this.interval.stop();var t=K.call(this);it.call(this,t)}function ot(){var t=this;this.metadata.event.forEach((function(e){1===t.settings.timepoint&&e.forceSimulation.force("center",null),e.forceSimulation.nodes(e.data),e.forceSimulation.alpha(1).restart()}))}var at=function(t){this.settings.timepoint+=!!t,this.settings.timepoint<=this.settings.duration?J.call(this):rt.call(this),ot.call(this)};function st(){return d3.interval(at.bind(this),this.settings.speeds[this.settings.speed])}var ut=[{action:"play",label:"Play",html:"&#9658;"},{action:"pause",label:"Pause",html:"&#10074;&#10074;"}];function ct(){var t=this;this.settings.playPause=ut.find((function(e){return e.action!==t.settings.playPause})).action,this.controls.playPause.inputs.attr("title","".concat(ut.find((function(e){return e.action!==t.settings.playPause})).label," animation")).html(ut.find((function(e){return e.action!==t.settings.playPause})).html),"play"===this.settings.playPause?this.interval=st.call(this):this.interval.stop()}function lt(){var t=this,e=this,n=this.controls.container.append("div").classed("fdg-control fdg-control--speed",!0),i=n.selectAll("div").data(Object.keys(this.settings.speeds).map((function(e){return{label:e,value:t.settings.speeds[e]}}))).enter().append("div").attr("class",(function(e){return"fdg-button ".concat(e.label," ").concat(e.label===t.settings.speed?"current":"")})).attr("title",(function(e){return"Advance the animation every ".concat(t.settings.speeds[e.label]/1e3," second(s).")})).text((function(t){return t.label}));return i.on("click",(function(t){e.settings.speed=t.label,i.classed("current",(function(e){return e.label===t.label})),"play"===e.settings.playPause&&(e.interval.stop(),e.interval=st.call(e))})),{container:n,inputs:i}}function ht(){var t=this,e=this.controls.container.append("div").classed("fdg-control fdg-control--play-pause",!0),n=e.append("div").classed("fdg-button fdg-input",!0).attr("title","".concat(ut.find((function(e){return e.action!==t.settings.playPause})).label," animation.")).html(ut.find((function(e){return e.action!==t.settings.playPause})).html);return n.on("click",(function(){ct.call(t)})),{container:e,inputs:n}}function ft(){var t=this,e=this.controls.container.append("div").classed("fdg-control fdg-control--step",!0),n=e.append("div").classed("fdg-button fdg-input",!0).attr("title","Advance animation by one time unit.").text("Step");return n.on("click",(function(){"pause"!==t.settings.playPause&&ct.call(t),at.call(t,!0)})),{container:e,inputs:n}}function dt(){var t=this,e=this,n=this.controls.container.append("div").classed("fdg-control fdg-control--timepoint",!0),i=n.append("div").classed("fdg-button fdg-input",!0).append("input").attr("type","number").attr("title","Choose a timepoint.").attr("value",+this.settings.timepoint).attr("min",1).attr("max",this.settings.duration);return i.on("click",(function(){"pause"!==t.settings.playPause&&ct.call(t)})),i.on("change",(function(){"pause"!==e.settings.playPause&&ct.call(e),e.settings.timepoint=+this.value-1,at.call(e,!0)})),{container:n,inputs:i}}function pt(){var t=this,e=this.controls.container.append("div").classed("fdg-control fdg-control--reset",!0),n=e.append("div").classed("fdg-button fdg-input",!0).attr("title","Reset animation.").html("&#x21ba;");return n.on("click",(function(){nt.call(t),"play"!==t.settings.playPause&&ct.call(t)})),{container:e,inputs:n}}function gt(){var t=this,e=this,n=this.controls.container.append("div").classed("fdg-control fdg-control--event-list",!0),i=n.selectAll("div").data(this.metadata.event).enter().append("div").attr("class",(function(e){return"fdg-button ".concat(t.settings.eventChangeCount.includes(e.value)?"current":"")})).attr("title",(function(e){return"".concat(t.settings.eventChangeCount.includes(e.value)?"Remove":"Add"," ").concat(e.value," ").concat(t.settings.eventChangeCount.includes(e.value)?"from":"to"," the list of events that control bubble ").concat("both"===t.settings.eventChangeCountAesthetic?"color and size":t.settings.eventChangeCountAesthetic,".")})).text((function(t){return t.value}));return i.on("click",(function(t){var n=this;this.classList.toggle("current"),e.settings.eventChangeCount.includes(this.textContent)?e.settings.eventChangeCount.splice(e.settings.eventChangeCount.findIndex((function(t){return t===n.textContent})),1):e.settings.eventChangeCount.push(this.textContent),this.title="".concat(e.settings.eventChangeCount.includes(t.value)?"Remove":"Add"," ").concat(t.value," ").concat(e.settings.eventChangeCount.includes(t.value)?"from":"to"," the list of events that control bubble ").concat("both"===e.settings.eventChangeCountAesthetic?"color and size":e.settings.eventChangeCountAesthetic,"."),e.controls.colorSizeToggle.inputs.attr("title",(function(t){return"Quantify the number of ".concat(e.util.csv(e.settings.eventChangeCount)," events by ").concat("both"!==t?t:"color and size",".")})),e.legends.container.classed("fdg-invisible",0===e.settings.eventChangeCount.length).selectAll("span.fdg-measure").text(e.util.csv(e.settings.eventChangeCount)),at.call(e,!1)})),{container:n,inputs:i}}function vt(){var t=this,e=this,n=this.controls.container.append("div").classed("fdg-control fdg-control--color-size",!0),i=n.selectAll("div").data(["color","size","both"]).enter().append("div").attr("class",(function(e){return"fdg-button ".concat(e," ").concat(e===t.settings.eventChangeCountAesthetic?"current":"")})).attr("title",(function(n){return"Quantify the number of ".concat(e.util.csv(t.settings.eventChangeCount)," events by ").concat("both"!==n?n:"color and size")})).text((function(t){return t}));return i.on("click",(function(t){i.classed("current",(function(e){return e===t})),e.settings.eventChangeCountAesthetic=t,e.controls.eventList.inputs.attr("title",(function(t){return"".concat(e.settings.eventChangeCount.includes(t.value)?"Remove":"Add"," ").concat(t.value," ").concat(e.settings.eventChangeCount.includes(t.value)?"from":"to"," the list of events that control bubble ").concat("both"===e.settings.eventChangeCountAesthetic?"color and size":e.settings.eventChangeCountAesthetic,".")})),e.legends.container.selectAll(".fdg-legend").classed("fdg-hidden",(function(){return!Array.from(this.classList).some((function(e){return e.includes(t)}))})),at.call(e,!1)})),{container:n,inputs:i}}function yt(){this.controls={container:this.containers.controls},this.controls.speed=lt.call(this),this.controls.playPause=ht.call(this),this.controls.step=ft.call(this),this.controls.timepoint=dt.call(this),this.controls.reset=pt.call(this),this.controls.eventList=gt.call(this),this.controls.colorSizeToggle=vt.call(this),this.controls.container.selectAll(".fdg-button").on("mousedown",(function(){this.classList.toggle("clicked")})).on("mouseup",(function(){this.classList.toggle("clicked")}))}var mt={color:function(t,e){var n=this;return t.selectAll("rect.legend-mark").data(this.settings.colors()).enter().append("rect").classed("legend-mark",!0).attr("x",(function(t,i){return i*(e[0]/n.settings.colors().length)})).attr("y",0).attr("width",e[0]/this.settings.colors().length).attr("height",e[1]/2).attr("fill",(function(t){return t})).attr("fill-opacity",.5).attr("stroke",(function(t){return t})).attr("stroke-opacity",1)},size:function(t,e){var n=this;return t.selectAll("circle.legend-mark").data(this.settings.colors()).enter().append("circle").classed("legend-mark",!0).attr("cx",(function(t,i){return i*(e[0]/n.settings.colors().length)+e[0]/n.settings.colors().length/2})).attr("cy",e[1]/4).attr("r",(function(t,e){return e+n.settings.minRadius})).attr("fill","#aaa").attr("fill-opacity",.5).attr("stroke","#aaa").attr("stroke-opacity",1)},both:function(t,e){var n=this;return t.selectAll("circle.legend-mark").data(this.settings.colors()).enter().append("circle").classed("legend-mark",!0).attr("cx",(function(t,i){return i*(e[0]/n.settings.colors().length)+e[0]/n.settings.colors().length/2})).attr("cy",e[1]/4).attr("r",(function(t,e){return e+n.settings.minRadius})).attr("fill",(function(t){return t})).attr("fill-opacity",.5).attr("stroke",(function(t){return t})).attr("stroke-opacity",1)}};function _t(t){var e=[200,50],n=this.legends.container.append("div").classed("fdg-legend fdg-legend--".concat(t),!0).classed("fdg-hidden",this.settings.eventChangeCountAesthetic!==t||0===this.settings.eventChangeCount.length),i=n.append("div").classed("fdg-legend__label",!0).html('Number of <span class = "fdg-measure">'.concat(this.util.csv(this.settings.eventChangeCount),"</span> events")),r=n.append("svg").attr("width",e[0]).attr("height",e[1]).append("g"),o=mt[t].call(this,r,e),a=r.append("text").attr("x",e[0]/this.settings.colors().length/2).attr("y",e[1]/2+16).attr("text-anchor","middle").text("0"),s=r.append("text").attr("x",e[0]-e[0]/this.settings.colors().length/2).attr("y",e[1]/2+16).attr("text-anchor","middle").text("".concat(this.settings.colors().length-1,"+"));return{container:n,label:i,svg:r,marks:o,lower:a,upper:s}}function bt(){this.legends={container:this.containers.legends},this.legends.color=_t.call(this,"color"),this.legends.size=_t.call(this,"size"),this.legends.both=_t.call(this,"both")}function wt(){var t={container:this.containers.freqTable};return t.table=t.container.append("table"),t.thead=t.table.append("thead"),t.th=t.thead.append("th").attr("colspan",2).text("Cumulative Number of Events"),t.tbody=t.table.append("tbody"),t.tr=t.tbody.selectAll("tr").data(this.metadata.event.slice(1)).join("tr"),t.td=t.tr.selectAll("td").data((function(t){return[t.value,t.cumulative]})).join("td").text((function(t){return t})),t}function xt(){var t=this.containers.svgBackground.append("g").classed("fdg-g fdg-g--orbits",!0);t.append("defs").selectAll("filter").data(this.metadata.orbit).join("filter").attr("id",(function(t,e){return"orbit--".concat(e)})).append("feDropShadow").attr("dx",0).attr("dy",0).attr("stdDeviation",5).attr("flood-color","black");var e=t.selectAll("circle.orbit").data(this.metadata.orbit).enter().append("circle").classed("orbit",!0).attr("cx",(function(t){return t.cx})).attr("cy",(function(t){return t.cy})).attr("r",(function(t){return t.r})).attr("fill","none").attr("stroke","#aaa").attr("stroke-width",".5").style("filter",(function(t,e){return"url(#orbit--".concat(e,")")}));return this.settings.translate&&e.attr("transform","translate(-".concat(this.settings.width/2-100,",-").concat(this.settings.height/2-100,")")),e}function Ct(){var t=this,e=this.containers.svgForeground.append("g").classed("fdg-g fdg-g--focus-annotations",!0).selectAll("g.fdg-focus-annotation").data(this.metadata.event).join("g").classed("fdg-focus-annotation",!0);this.settings.translate&&e.attr("transform","translate(-".concat(this.settings.width/2-100,",-").concat(this.settings.height/2-100,")"));var n=function(e){return Math.round(e.x)===Math.round(t.settings.orbitRadius/2)},i=function(e){return 1===e.order||Math.round(e.x)<Math.round(t.settings.width/2)},r=function(t){return n(t)?t.x:t.x-10*Math.pow(-1,i(t))},o=function(t){return n(t)?"middle":i(t)?"start":"end"},a=function(e){return function(e){return Math.round(e.y)===Math.round(t.settings.height/2)}(e)?e.y:e.y+35*Math.pow(-1,function(e){return Math.round(e.y)<Math.round(t.settings.height/2)}(e))},s=e.append("text").classed("fdg-focus-annotation__text",!0).attr("x",(function(t){return r(t)})).attr("y",(function(t){return a(t)}));s.append("tspan").classed("fdg-focus-annotation__label",!0).attr("x",(function(t){return r(t)})).attr("text-anchor",(function(t){return o(t)})).style("font-weight","bold").style("font-size","20px").attr("stroke","white").attr("stroke-width","4px").text((function(t){return t.value})),s.append("tspan").classed("fdg-focus-annotation__event-count",!0).classed("fdg-hidden",!1===this.settings.eventCount).attr("x",(function(t){return r(t)})).attr("text-anchor",(function(t){return o(t)})).attr("dy","1.3em").style("font-weight","bold").attr("stroke","white").attr("stroke-width","4px");var u=e.append("text").classed("fdg-focus-annotation__text",!0).attr("x",(function(t){return r(t)})).attr("y",(function(t){return a(t)}));return u.append("tspan").classed("fdg-focus-annotation__label",!0).attr("x",(function(t){return r(t)})).attr("text-anchor",(function(t){return o(t)})).style("font-weight","bold").style("font-size","20px").attr("fill","black").text((function(t){return t.value})),u.append("tspan").classed("fdg-focus-annotation__event-count",!0).classed("fdg-hidden",!1===this.settings.eventCount).attr("x",(function(t){return r(t)})).attr("text-anchor",(function(t){return o(t)})).attr("dy","1.3em").style("font-weight","bold").attr("fill","black"),e}function St(){yt.call(this),this.containers.timer.text("".concat(this.settings.timepoint," ").concat(this.settings.timeUnit)),bt.call(this),this.freqTable=wt.call(this),this.orbits=xt.call(this),this.focusAnnotations=Ct.call(this)}function kt(){var t,e={},n=l(Object.keys(this.settings).filter((function(t){return/_var$/.test(t)})));try{for(n.s();!(t=n.n()).done;){var i=t.value;e[i.replace(/_var$/,"")]=this.data[0].hasOwnProperty(this.settings[i])}}catch(t){n.e(t)}finally{n.f()}return e}function Ot(){var t=this;this.data.forEach((function(e){var n,i=l(Object.keys(t.settings).filter((function(t){return/_var$/.test(t)})));try{for(i.s();!(n=i.n()).done;){var r=n.value,o=r.replace(/_var$/,"");e[o]=["event_order","start_timepoint","end_timepoint","duration","sequence"].includes(o)?+e[t.settings[r]]:e[t.settings[r]]}}catch(t){i.e(t)}finally{i.f()}}))}function At(t){d3.nest().key((function(t){return t.id})).rollup((function(e){e.forEach((function(n,i){t.duration&&!t.start_timepoint&&(0===i?(n.start_timepoint=1,n.end_timepoint=n.duration):(n.start_timepoint=e[i-1].end_timepoint+1,n.end_timepoint=n.start_timepoint+n.duration-1)),t.start_timepoint&&!t.end_timepoint&&(n.end_timepoint=i<e.length-1?e[i+1].start_timepoint-1:n.duration?n.start_timepoint+n.duration-1:n.start_timepoint),!t.duration&&t.start_timepoint&&t.end_timepoint&&(n.duration=n.start_timepoint-n.end_timepoint+1)})),t.sequence?e.sort((function(t,e){return t.seq-e.seq})):e.sort((function(t,e){return t.start_timepoint-e.start_timepoint})).forEach((function(t,e){t.seq=e}))})).entries(this.data)}function Pt(){var t=this.data.every((function(t){return/^-?\d+\.?\d*$/.test(t.id)||/^-?\d*\.?\d+$/.test(t.id)}));this.data.sort((function(e,n){var i=t?+e.id-+n.id:e.id<n.id?-1:n.id<e.id?1:0,r=e.seq-n.seq;return i||r}))}function jt(){var t=kt.call(this);Ot.call(this),At.call(this,t),Pt.call(this)}function Mt(){var t=this;return d3.nest().key((function(t){return t.id})).rollup((function(e){d3.sum(e,(function(t){return t.duration}));var n=V.call(t,e,0),i=1===e.length&&n.event===t.settings.eventCentral,r=$.call(t,e,null),o=U.call(t,r),s=Y.call(t,r);return a({group:e,duration:d3.sum(e,(function(t){return t.duration})),statePrevious:null,state:n,noStateChange:i,nStateChanges:r,r:o},s)})).entries(this.data)}function Tt(){var t=this;jt.call(this),this.data.nested=Mt.call(this),this.metadata.event.forEach((function(e){e.data=t.data.nested.filter((function(t){return t.value.state.event===e.value}))}))}function Et(t){return function(){return t}}function It(t,e,n,i){if(isNaN(e)||isNaN(n))return t;var r,o,a,s,u,c,l,h,f,d=t._root,p={data:i},g=t._x0,v=t._y0,y=t._x1,m=t._y1;if(!d)return t._root=p,t;for(;d.length;)if((c=e>=(o=(g+y)/2))?g=o:y=o,(l=n>=(a=(v+m)/2))?v=a:m=a,r=d,!(d=d[h=l<<1|c]))return r[h]=p,t;if(s=+t._x.call(null,d.data),u=+t._y.call(null,d.data),e===s&&n===u)return p.next=d,r?r[h]=p:t._root=p,t;do{r=r?r[h]=new Array(4):t._root=new Array(4),(c=e>=(o=(g+y)/2))?g=o:y=o,(l=n>=(a=(v+m)/2))?v=a:m=a}while((h=l<<1|c)==(f=(u>=a)<<1|s>=o));return r[f]=d,r[h]=p,t}function Ft(t,e,n,i,r){this.node=t,this.x0=e,this.y0=n,this.x1=i,this.y1=r}function Rt(t){return t[0]}function Nt(t){return t[1]}function Wt(t,e,n){var i=new qt(null==e?Rt:e,null==n?Nt:n,NaN,NaN,NaN,NaN);return null==t?i:i.addAll(t)}function qt(t,e,n,i,r,o){this._x=t,this._y=e,this._x0=n,this._y0=i,this._x1=r,this._y1=o,this._root=void 0}function Dt(t){for(var e={data:t.data},n=e;t=t.next;)n=n.next={data:t.data};return e}var zt=Wt.prototype=qt.prototype;function Lt(t){var e=this;this.containers.canvas.context.clearRect(0,0,this.settings.width,this.settings.height),this.containers.canvas.context.save(),this.data.nested.sort((function(t,e){return t.value.stateChanges-e.value.stateChanges})).forEach((function(t,n){e.containers.canvas.context.beginPath(),"circle"===e.settings.shape?(e.containers.canvas.context.moveTo(t.x+t.r,t.y),e.containers.canvas.context.arc(t.x,t.y,t.value.r,0,2*Math.PI),e.settings.fill&&(e.containers.canvas.context.fillStyle=t.value.fill,e.containers.canvas.context.fill()),e.containers.canvas.context.strokeStyle=t.value.stroke,e.containers.canvas.context.stroke()):(e.containers.canvas.context.rect(t.x-t.value.r,t.y-t.value.r,2*t.value.r,2*t.value.r),e.settings.fill&&(e.containers.canvas.context.fillStyle=t.value.fill,e.containers.canvas.context.fill()),e.containers.canvas.context.strokeStyle=t.value.stroke,e.containers.canvas.context.stroke())})),this.containers.canvas.context.restore()}function Bt(t){var e=d3.forceSimulation().nodes(t.data).alphaDecay(.01).velocityDecay(.9).force("center",d3.forceCenter(this.settings.orbitRadius/2,this.settings.height/2)).force("x",d3.forceX(t.x).strength(.3)).force("y",d3.forceY(t.y).strength(.3)).force("charge",function(){var t,e,n,i,r,o,a,s=0,u=Et(-30),c=1,l=1/0,h=.81;function f(){return 1e-6*(Math.random()-.5)}function d(t){return t.x}function p(t){return t.y}function g(r){var a,u=t.length;for(i&&!o(s,t)||(i=Wt(t,d,p).visitAfter(y),t.update.push(s)),n=r,a=0;a<u;++a)e=t[a],i.visit(m);++s}function v(){if(t){s=0,t.update=[],o=r(),i=null;var e,n,c=t.length;for(a=new Array(c),e=0;e<c;++e)n=t[e],a[n.index]=+u(n,e,t)}}function y(t){var e,n,i,r,o,s=0,u=0;if(t.length){for(i=r=o=0;o<4;++o)(e=t[o])&&(n=Math.abs(e.value))&&(s+=e.value,u+=n,i+=n*e.x,r+=n*e.y);t.x=i/u,t.y=r/u}else{(e=t).x=e.data.x,e.y=e.data.y;do{s+=a[e.data.index]}while(e=e.next)}t.value=s}function m(t,i,r,o){if(!t.value)return!0;var s=t.x-e.x,u=t.y-e.y,d=o-i,p=s*s+u*u;if(d*d/h<p)return p<l&&(0===s&&(p+=(s=f())*s),0===u&&(p+=(u=f())*u),p<c&&(p=Math.sqrt(c*p)),e.vx+=s*t.value*n/p,e.vy+=u*t.value*n/p),!0;if(!(t.length||p>=l)){(t.data!==e||t.next)&&(0===s&&(p+=(s=f())*s),0===u&&(p+=(u=f())*u),p<c&&(p=Math.sqrt(c*p)));do{t.data!==e&&(p=(s=t.data.x-e.x)*s+(u=t.data.y-e.y)*u,0===s&&(p+=(s=f())*s),0===u&&(p+=(u=f())*u),p<c&&(p=Math.sqrt(c*p)),d=a[t.data.index]*n/p,e.vx+=s*d,e.vy+=u*d)}while(t=t.next)}}return r=function(){return function(t){return t%13==0}},g.initialize=function(e){t=e,v()},g.strength=function(t){return arguments.length?(u="function"==typeof t?t:Et(+t),v(),g):u},g.distanceMin=function(t){return arguments.length?(c=t*t,g):Math.sqrt(c)},g.distanceMax=function(t){return arguments.length?(l=t*t,g):Math.sqrt(l)},g.theta=function(t){return arguments.length?(h=t*t,g):Math.sqrt(h)},g.update=function(t){return arguments.length?(o=(r=t)(),g):r},g}().strength(-2e3/this.metadata.id.length)).on("tick",Lt.bind(this,t));return e.force("collide",d3.forceCollide().radius(this.settings.minRadius+.5)),e}function Qt(t){for(var e=d3.forceSimulation().nodes(t).force("center",d3.forceCenter(this.settings.orbitRadius/2,this.settings.height/2)).force("x",d3.forceX(this.settings.orbitRadius/2).strength(.3)).force("y",d3.forceY(this.settings.height/2).strength(.3)).force("charge",d3.forceManyBodyReuse().strength(-2e3/t.length)).force("collide",d3.forceCollide().radius(this.settings.minRadius+.5)).stop(),n=0;n<300;n++)e.tick();var i=this.containers.svgBackground.insert("g",":first-child");i.append("text").attr("x",0).attr("y",-this.settings.orbitRadius/2).attr("dy",-36).attr("text-anchor","middle").text("No state changes"),i.append("text").attr("x",0).attr("y",-this.settings.orbitRadius/2).attr("dy",-16).attr("text-anchor","middle").text("".concat(t.length," (").concat(d3.format(".1%")(t.length/this.data.nested.length),")"));i.selectAll("circle").data(t).enter().append("circle").attr("cx",(function(t){return t.x})).attr("cy",(function(t){return t.y})).attr("r",this.settings.minRadius).attr("fill",this.settings.color(0))}function Vt(){var t=this.data.nested.filter((function(t){return t.value.noStateChange})).map((function(t){return{key:t.key}}));t.length&&Qt.call(this,t)}function $t(){var t=this;et.call(this),Vt.call(this),this.metadata.event.forEach((function(e){e.forceSimulation=Bt.call(t,e)})),"play"===this.settings.playPause&&(this.interval=st.call(this))}return zt.copy=function(){var t,e,n=new qt(this._x,this._y,this._x0,this._y0,this._x1,this._y1),i=this._root;if(!i)return n;if(!i.length)return n._root=Dt(i),n;for(t=[{source:i,target:n._root=new Array(4)}];i=t.pop();)for(var r=0;r<4;++r)(e=i.source[r])&&(e.length?t.push({source:e,target:i.target[r]=new Array(4)}):i.target[r]=Dt(e));return n},zt.add=function(t){var e=+this._x.call(null,t),n=+this._y.call(null,t);return It(this.cover(e,n),e,n,t)},zt.addAll=function(t){var e,n,i,r,o=t.length,a=new Array(o),s=new Array(o),u=1/0,c=1/0,l=-1/0,h=-1/0;for(n=0;n<o;++n)isNaN(i=+this._x.call(null,e=t[n]))||isNaN(r=+this._y.call(null,e))||(a[n]=i,s[n]=r,i<u&&(u=i),i>l&&(l=i),r<c&&(c=r),r>h&&(h=r));if(u>l||c>h)return this;for(this.cover(u,c).cover(l,h),n=0;n<o;++n)It(this,a[n],s[n],t[n]);return this},zt.cover=function(t,e){if(isNaN(t=+t)||isNaN(e=+e))return this;var n=this._x0,i=this._y0,r=this._x1,o=this._y1;if(isNaN(n))r=(n=Math.floor(t))+1,o=(i=Math.floor(e))+1;else{for(var a,s,u=r-n,c=this._root;n>t||t>=r||i>e||e>=o;)switch(s=(e<i)<<1|t<n,(a=new Array(4))[s]=c,c=a,u*=2,s){case 0:r=n+u,o=i+u;break;case 1:n=r-u,o=i+u;break;case 2:r=n+u,i=o-u;break;case 3:n=r-u,i=o-u}this._root&&this._root.length&&(this._root=c)}return this._x0=n,this._y0=i,this._x1=r,this._y1=o,this},zt.data=function(){var t=[];return this.visit((function(e){if(!e.length)do{t.push(e.data)}while(e=e.next)})),t},zt.extent=function(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},zt.find=function(t,e,n){var i,r,o,a,s,u,c,l=this._x0,h=this._y0,f=this._x1,d=this._y1,p=[],g=this._root;for(g&&p.push(new Ft(g,l,h,f,d)),null==n?n=1/0:(l=t-n,h=e-n,f=t+n,d=e+n,n*=n);u=p.pop();)if(!(!(g=u.node)||(r=u.x0)>f||(o=u.y0)>d||(a=u.x1)<l||(s=u.y1)<h))if(g.length){var v=(r+a)/2,y=(o+s)/2;p.push(new Ft(g[3],v,y,a,s),new Ft(g[2],r,y,v,s),new Ft(g[1],v,o,a,y),new Ft(g[0],r,o,v,y)),(c=(e>=y)<<1|t>=v)&&(u=p[p.length-1],p[p.length-1]=p[p.length-1-c],p[p.length-1-c]=u)}else{var m=t-+this._x.call(null,g.data),_=e-+this._y.call(null,g.data),b=m*m+_*_;if(b<n){var w=Math.sqrt(n=b);l=t-w,h=e-w,f=t+w,d=e+w,i=g.data}}return i},zt.remove=function(t){if(isNaN(o=+this._x.call(null,t))||isNaN(a=+this._y.call(null,t)))return this;var e,n,i,r,o,a,s,u,c,l,h,f,d=this._root,p=this._x0,g=this._y0,v=this._x1,y=this._y1;if(!d)return this;if(d.length)for(;;){if((c=o>=(s=(p+v)/2))?p=s:v=s,(l=a>=(u=(g+y)/2))?g=u:y=u,e=d,!(d=d[h=l<<1|c]))return this;if(!d.length)break;(e[h+1&3]||e[h+2&3]||e[h+3&3])&&(n=e,f=h)}for(;d.data!==t;)if(i=d,!(d=d.next))return this;return(r=d.next)&&delete d.next,i?(r?i.next=r:delete i.next,this):e?(r?e[h]=r:delete e[h],(d=e[0]||e[1]||e[2]||e[3])&&d===(e[3]||e[2]||e[1]||e[0])&&!d.length&&(n?n[f]=d:this._root=d),this):(this._root=r,this)},zt.removeAll=function(t){for(var e=0,n=t.length;e<n;++e)this.remove(t[e]);return this},zt.root=function(){return this._root},zt.size=function(){var t=0;return this.visit((function(e){if(!e.length)do{++t}while(e=e.next)})),t},zt.visit=function(t){var e,n,i,r,o,a,s=[],u=this._root;for(u&&s.push(new Ft(u,this._x0,this._y0,this._x1,this._y1));e=s.pop();)if(!t(u=e.node,i=e.x0,r=e.y0,o=e.x1,a=e.y1)&&u.length){var c=(i+o)/2,l=(r+a)/2;(n=u[3])&&s.push(new Ft(n,c,l,o,a)),(n=u[2])&&s.push(new Ft(n,i,l,c,a)),(n=u[1])&&s.push(new Ft(n,c,r,o,l)),(n=u[0])&&s.push(new Ft(n,i,r,c,l))}return this},zt.visitAfter=function(t){var e,n=[],i=[];for(this._root&&n.push(new Ft(this._root,this._x0,this._y0,this._x1,this._y1));e=n.pop();){var r=e.node;if(r.length){var o,a=e.x0,s=e.y0,u=e.x1,c=e.y1,l=(a+u)/2,h=(s+c)/2;(o=r[0])&&n.push(new Ft(o,a,s,l,h)),(o=r[1])&&n.push(new Ft(o,l,s,u,h)),(o=r[2])&&n.push(new Ft(o,a,h,l,c)),(o=r[3])&&n.push(new Ft(o,l,h,u,c))}i.push(e)}for(;e=i.pop();)t(e.node,e.x0,e.y0,e.x1,e.y1);return this},zt.x=function(t){return arguments.length?(this._x=t,this):this._x},zt.y=function(t){return arguments.length?(this._y=t,this):this._y},function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"body",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o={data:e,element:n,settings:Object.assign(i,r),util:t};return o.settings.text=[].concat(o.settings.explanation).concat(o.settings.information).filter((function(t){return"string"==typeof t})),o.containers=q.call(o),o.metadata=Q.call(o),St.call(o),Tt.call(o),$t.call(o),o}}));
