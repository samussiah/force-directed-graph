!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(t="undefined"!=typeof globalThis?globalThis:t||self).forceDirectedGraph=n()}(this,(function(){"use strict";function t(n){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(n)}function n(t,n,e){return n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}function e(t,n){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable}))),e.push.apply(e,i)}return e}function i(t){for(var i=1;i<arguments.length;i++){var a=null!=arguments[i]?arguments[i]:{};i%2?e(Object(a),!0).forEach((function(e){n(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):e(Object(a)).forEach((function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(a,n))}))}return t}function a(t){return function(t){if(Array.isArray(t))return r(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||s(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(t,n){if(t){if("string"==typeof t)return r(t,n);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?r(t,n):void 0}}function r(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,i=new Array(n);e<n;e++)i[e]=t[e];return i}function o(t,n){var e;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(e=s(t))||n&&t&&"number"==typeof t.length){e&&(t=e);var i=0,a=function(){};return{s:a,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o=!0,c=!1;return{s:function(){e=t[Symbol.iterator]()},n:function(){var t=e.next();return o=t.done,t},e:function(t){c=!0,r=t},f:function(){try{o||null==e.return||e.return()}finally{if(c)throw r}}}}var c={arcTween:function(t,n){return function(e){var i=d3.interpolate(e.endAngle,t);return function(t){return e.endAngle=i(t),n(e)}}},csv:function(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],e=t.join(", ");return n&&(e=e.replace(/, ([^,]*)$/," and $1")),e},mergeDeep:function n(){for(var e=function(n){return n&&"object"===t(n)},i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return a.reduce((function(t,i){return Object.keys(i).forEach((function(a){var s=t[a],r=i[a];Array.isArray(s)&&Array.isArray(r)?t[a]=r:e(s)&&e(r)?t[a]=n(s,r):t[a]=r})),t}),{})}};var l={update:function(){var t=this;["frequency","continuous","categorical"].includes(this.settings.colorBy.type)||(alert("[ ".concat(colorBy," ] is not a valid option.  Please choose one of [ frequency ], [ continuous ], or [ categorical ].  Defaulting to  [ frequency ].")),this.settings.colorBy.type="frequency"),this.settings.stratify="categorical"===this.settings.colorBy.type,this.settings.sizify="frequency"===this.settings.sizeBy.type||"continuous"===this.settings.sizeBy.type&&null!==this.settings.sizeBy.variable,this.settings.shapify=null!==this.settings.shapeBy.variable;var n=[];Array.isArray(this.settings.explanation)&&(this.settings.explanation=this.settings.explanation.map((function(n){return n.replace(/bubble/g,t.settings.shape)})),n=n.concat(this.settings.explanation.filter((function(n){return!(t.settings.hideControls&&n.includes("controls"))})))),Array.isArray(this.settings.information)&&(n=n.concat(this.settings.information)),this.settings.text=n.filter((function(t){return"string"==typeof t}))},id_var:"id",event_var:"event",event_order_var:"event_order",start_timepoint_var:"stdy",end_timepoint_var:"endy",duration_var:"duration",sequence_var:"seq",colorBy:{type:"frequency",variable:null,label:null,mirror:!0,stratify:!0,colorScheme:"RdYlGn",colorSchemes:["blue","orange","red","purple","green","grey"],nColors:6},color:"rgb(170,170,170)",fill:null,sizeBy:{type:"frequency",variable:null,label:null},minRadius:null,maxRadius:10,staticRadius:null,shapeBy:{type:"categorical",variable:null,label:null,shapes:["circle","square","triangle","diamond","star","triangleDown"]},shape:"circle",speed:"medium",speeds:{slow:1e3,medium:500,fast:100},playPause:"play",pulseOrbits:!1,loop:!0,timepoint:0,timeUnit:"days",duration:null,resetDelay:15e3,width:null,height:null,orbitRadius:null,manyBody:"forceManyBodyReuse",chargeStrength:null,collisionPadding:1,staticChargeStrength:null,drawStaticSeparately:!1,staticLayout:"circular",modal:!0,modalSpeed:15e3,modalIndex:0,explanation:["Each bubble in this animation represents an individual.",'As <span class = "fdg-emphasized">time progresses</span> and individuals experience events, their bubble gravitates toward the focus or "planet" representing that event.','The <span class = "fdg-emphasized">number of events</span> an individual has experienced determines the color and/or size of their bubble.','<span class = "fdg-emphasized">Static bubbles</span> represent individuals who never experience an event.','Use the <span class = "fdg-emphasized">controls</span> on the right to interact with and alter the animation.',"Continue watching to learn how these individuals progress over the course of [duration] days."],information:null,events:null,eventCentral:null,eventCount:!0,eventChangeCount:null,eventChangeCountAesthetic:"color",nOrbits:null,nFoci:null,hideControls:!1,hideFreqTable:!1,eventCentralInFreqTable:!1};function u(t,n){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"div",i=n.append(e).classed("fdg-".concat(t),!0);return i}function h(t){var n=u("controls",t).classed("fdg-hidden",this.settings.hideControls);u("hide",n,"span");return{controls:n}}function d(t){var n=u("stopwatch",t).style("width","100%");return n.width=n.node().clientWidth,n.innerRadius=n.width/8,n.svg=u("stopwatch__svg",n,"svg").attr("width",n.width).attr("height",n.width),n.arc=d3.arc().innerRadius(n.innerRadius).outerRadius(n.width/2-1).cornerRadius(12).startAngle(0),n.g=u("stopwatch__path",n.svg,"g").attr("transform","translate(".concat(n.width/2,",").concat(n.width/2,")")),n.background=u("stopwatch__path",n.g,"path").datum({endAngle:2*Math.PI}).attr("d",n.arc).style("fill","white").style("stroke","black").style("stroke-width",.5),n.foreground=u("stopwatch__path",n.g,"path").datum({endAngle:0}).attr("d",n.arc).style("fill","#a6d96a").style("stroke","black").style("stroke-width",.5),n.percentBackground=u("stopwatch__text",n.g,"text").attr("text-anchor","middle").attr("alignment-baseline","middle").style("font-weight","bold").style("stroke","white").style("stroke-width","4px").text("0%"),n.percentForeground=u("stopwatch__text",n.g,"text").attr("text-anchor","middle").attr("alignment-baseline","middle").style("font-weight","bold").text("0%"),n}function g(t){var n=this.settings.resetDelay/1e3;return u("countdown",t).classed("fdg-sidebar__label",!0).selectAll("div").data(d3.range(-1,n)).join("div").text((function(t){return"Looping in ".concat(t+1," second").concat(0===t?"":"s")})).classed("fdg-hidden",(function(t){return t!==n-1})).classed("fdg-invisible",(function(t){return t===n-1}))}function f(t){var n=u("sidebar",t),e=u("legends",n),i=u("progress",n),a=u("timer",i).classed("fdg-sidebar__label",!0);return{sidebar:n,legends:e,stopwatch:d.call(this,i),progress:i,timer:a,countdown:g.call(this,i),freqTable:u("freq-table",n)}}function p(t){var n=u("animation",t);this.settings.width=n.node().clientWidth,this.settings.height=n.node().clientHeight;var e=u("progress-bar",n),i=u("progress-day",n),a=u("svg--background",n,"svg").attr("width",this.settings.width).attr("height",this.settings.height),s=u("canvas",n,"canvas").attr("width",this.settings.width).attr("height",this.settings.height);s.context=s.node().getContext("2d");var r=u("svg--foreground",n,"svg").attr("width",this.settings.width).attr("height",this.settings.height),o=u("focus-annotations",r,"g"),c=u("modal",n);return{animation:n,progressBar:e,progressDay:i,svgBackground:a,canvas:s,svgForeground:r,focusAnnotations:o,modal:u("modal__text",c)}}function y(t){var n=this;this.settings.orbitRadius=this.settings.width/(t.orbit.length+1);var e=this.settings.orbitRadius/2,i=this.settings.height/2;Math.PI,this.settings.nFoci||(t.event.length,this.settings.eventCentral);t.event.forEach((function(t,a){t.radius=t.order*n.settings.orbitRadius,t.theta=2*Math.PI*t.position/360,t.x=0===t.order?e:e+t.radius*Math.cos(t.theta),t.y=0===t.order?i:i+t.radius*Math.sin(t.theta)})),t.orbit.forEach((function(t,a){t.cx=e,t.cy=i,t.r=(a+1)*n.settings.orbitRadius}))}function v(){this.settings.timepoint>0&&this.forceSimulation&&this.forceSimulation.force("center",null),this.forceSimulation.alpha(1).force("x",d3.forceX().x((function(t){return t.value.coordinates.x})).strength(.3)).force("y",d3.forceY().y((function(t){return t.value.coordinates.y})).strength(.3)).restart()}function m(t,n,e){var i=void 0===n?null:n,a=function(t,n){var e=atob(t);if(n){for(var i=new Uint8Array(e.length),a=0,s=e.length;a<s;++a)i[a]=e.charCodeAt(a);return String.fromCharCode.apply(null,new Uint16Array(i.buffer))}return e}(t,void 0!==e&&e),s=a.indexOf("\n",10)+1,r=a.substring(s)+(i?"//# sourceMappingURL="+i:""),o=new Blob([r],{type:"application/javascript"});return URL.createObjectURL(o)}var b,x,C,B,I=(b="Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKCkgewogICAgJ3VzZSBzdHJpY3QnOwoKICAgIHNlbGYuaW1wb3J0U2NyaXB0cygnaHR0cHM6Ly9kM2pzLm9yZy9kMy1kaXNwYXRjaC52Mi5taW4uanMnKTsKICAgIHNlbGYuaW1wb3J0U2NyaXB0cygnaHR0cHM6Ly9kM2pzLm9yZy9kMy1xdWFkdHJlZS52Mi5taW4uanMnKTsKICAgIHNlbGYuaW1wb3J0U2NyaXB0cygnaHR0cHM6Ly9kM2pzLm9yZy9kMy10aW1lci52Mi5taW4uanMnKTsKICAgIHNlbGYuaW1wb3J0U2NyaXB0cygnaHR0cHM6Ly9kM2pzLm9yZy9kMy1mb3JjZS52Mi5taW4uanMnKTsgLy9zZWxmLmltcG9ydFNjcmlwdHMoJ2h0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9ucG0vZDMtZm9yY2UtcmV1c2VAMS4wLjEvYnVpbGQvZDMtZm9yY2UtcmV1c2UubWluLmpzJyk7CgogICAgc2VsZi5pbXBvcnRTY3JpcHRzKCdodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvbnBtL2QzLWZvcmNlLXNhbXBsZWRAMS4wLjAvYnVpbGQvZDMtZm9yY2Utc2FtcGxlZC5taW4uanMnKTsKCiAgICBvbm1lc3NhZ2UgPSBmdW5jdGlvbiBvbm1lc3NhZ2UoZXZlbnQpIHsKICAgICAgdmFyIF9ldmVudCRkYXRhID0gZXZlbnQuZGF0YSwKICAgICAgICAgIG5vZGVzID0gX2V2ZW50JGRhdGEubm9kZXMsCiAgICAgICAgICBsYXlvdXQgPSBfZXZlbnQkZGF0YS5sYXlvdXQsCiAgICAgICAgICBzdHJlbmd0aCA9IF9ldmVudCRkYXRhLnN0cmVuZ3RoLAogICAgICAgICAgb3JiaXRSYWRpdXMgPSBfZXZlbnQkZGF0YS5vcmJpdFJhZGl1cywKICAgICAgICAgIHggPSBfZXZlbnQkZGF0YS54LAogICAgICAgICAgeSA9IF9ldmVudCRkYXRhLnksCiAgICAgICAgICByYWRpdXMgPSBfZXZlbnQkZGF0YS5yYWRpdXMsCiAgICAgICAgICBpZCA9IF9ldmVudCRkYXRhLmlkOwogICAgICB2YXIgc2ltdWxhdGlvbiA9IGQzLmZvcmNlU2ltdWxhdGlvbigpLm5vZGVzKG5vZGVzKTsKICAgICAgaWYgKGxheW91dCA9PT0gJ2NpcmN1bGFyJykgc2ltdWxhdGlvbi5mb3JjZSgnY29sbGlkZScsIGQzLmZvcmNlQ29sbGlkZSgpLnJhZGl1cyhyYWRpdXMgKyAwLjUpKSAvLyBjb2xsaXNpb24gZGV0ZWN0aW9uCiAgICAgIC8vLmZvcmNlKCdjaGFyZ2UnLCBkMy5mb3JjZU1hbnlCb2R5KCkuc3RyZW5ndGgoc3RyZW5ndGgpKSAvLyBjaGFyZ2UKICAgICAgLy8uZm9yY2UoJ2NoYXJnZScsIGQzLmZvcmNlTWFueUJvZHlSZXVzZSgpLnN0cmVuZ3RoKHN0cmVuZ3RoKSkgLy8gY2hhcmdlCiAgICAgIC5mb3JjZSgnY2hhcmdlJywgZDMuZm9yY2VNYW55Qm9keVNhbXBsZWQoKS5zdHJlbmd0aChzdHJlbmd0aCkpIC8vIGNoYXJnZQogICAgICAuZm9yY2UoJ3gnLCBkMy5mb3JjZVgoeCkuc3RyZW5ndGgoMC4zKSkuZm9yY2UoJ3knLCBkMy5mb3JjZVkoeSkuc3RyZW5ndGgoMC4zKSk7ZWxzZSBpZiAobGF5b3V0ID09PSAncmFkaWFsJykgc2ltdWxhdGlvbi5mb3JjZSgnY29sbGlkZScsIGQzLmZvcmNlQ29sbGlkZSgpLnJhZGl1cyhyYWRpdXMgKyAwLjUpKSAvLyBjb2xsaXNpb24gZGV0ZWN0aW9uCiAgICAgIC5mb3JjZSgncicsIGQzLmZvcmNlUmFkaWFsKG9yYml0UmFkaXVzIC8gMikpOyAvLyBwb3NpdGlvbmluZwogICAgICAvLyBzdG9wIHNpbXVsYXRpb24KCiAgICAgIHNpbXVsYXRpb24uc3RvcCgpOyAvLyBpbmNyZW1lbnQgc2ltdWxhdGlvbiBtYW51YWxseQoKICAgICAgZm9yICh2YXIgaSA9IDAsIG4gPSBNYXRoLmNlaWwoTWF0aC5sb2coc2ltdWxhdGlvbi5hbHBoYU1pbigpKSAvIE1hdGgubG9nKDEgLSBzaW11bGF0aW9uLmFscGhhRGVjYXkoKSkpOyBpIDwgbjsgKytpKSB7CiAgICAgICAgc2ltdWxhdGlvbi50aWNrKCk7CiAgICAgIH0gLy8gcmV0dXJuIHVwZGF0ZWQgbm9kZXMgYXJyYXkgdG8gYmUgZHJhd24gYW5kIHJlbmRlcmVkCgoKICAgICAgcG9zdE1lc3NhZ2UoewogICAgICAgIG5vZGVzOiBub2RlcywKICAgICAgICByYWRpdXM6IHJhZGl1cywKICAgICAgICBpZDogaWQKICAgICAgfSk7CiAgICB9OwoKfSgpKTsKCg==",x="data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZm9yY2VTaW11bGF0aW9uV29ya2VyLmpzIiwic291cmNlcyI6WyJzcmMvaW5pdC9hZGRTdGF0aWNGb3JjZVNpbXVsYXRpb24vZm9yY2VTaW11bGF0aW9uV29ya2VyLmpzIl0sInNvdXJjZXNDb250ZW50IjpbInNlbGYuaW1wb3J0U2NyaXB0cygnaHR0cHM6Ly9kM2pzLm9yZy9kMy1kaXNwYXRjaC52Mi5taW4uanMnKTtcclxuc2VsZi5pbXBvcnRTY3JpcHRzKCdodHRwczovL2QzanMub3JnL2QzLXF1YWR0cmVlLnYyLm1pbi5qcycpO1xyXG5zZWxmLmltcG9ydFNjcmlwdHMoJ2h0dHBzOi8vZDNqcy5vcmcvZDMtdGltZXIudjIubWluLmpzJyk7XHJcbnNlbGYuaW1wb3J0U2NyaXB0cygnaHR0cHM6Ly9kM2pzLm9yZy9kMy1mb3JjZS52Mi5taW4uanMnKTtcclxuLy9zZWxmLmltcG9ydFNjcmlwdHMoJ2h0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9ucG0vZDMtZm9yY2UtcmV1c2VAMS4wLjEvYnVpbGQvZDMtZm9yY2UtcmV1c2UubWluLmpzJyk7XHJcbnNlbGYuaW1wb3J0U2NyaXB0cyhcclxuICAgICdodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvbnBtL2QzLWZvcmNlLXNhbXBsZWRAMS4wLjAvYnVpbGQvZDMtZm9yY2Utc2FtcGxlZC5taW4uanMnXHJcbik7XHJcblxyXG5vbm1lc3NhZ2UgPSBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgIGNvbnN0IHtcclxuICAgICAgICBub2RlcywgLy8gZGF0YVxyXG4gICAgICAgIGxheW91dCxcclxuICAgICAgICBzdHJlbmd0aCxcclxuICAgICAgICBvcmJpdFJhZGl1cywgLy8gZm9yY2Ugc2ltdWxhdGlvbiBzZXR0aW5nc1xyXG4gICAgICAgIHgsXHJcbiAgICAgICAgeSwgLy8gY29vcmRpbmF0ZXNcclxuICAgICAgICByYWRpdXMsXHJcbiAgICAgICAgaWQsXHJcbiAgICB9ID0gZXZlbnQuZGF0YTtcclxuXHJcbiAgICBjb25zdCBzaW11bGF0aW9uID0gZDMuZm9yY2VTaW11bGF0aW9uKCkubm9kZXMobm9kZXMpO1xyXG5cclxuICAgIGlmIChsYXlvdXQgPT09ICdjaXJjdWxhcicpXHJcbiAgICAgICAgc2ltdWxhdGlvblxyXG4gICAgICAgICAgICAuZm9yY2UoJ2NvbGxpZGUnLCBkMy5mb3JjZUNvbGxpZGUoKS5yYWRpdXMocmFkaXVzICsgMC41KSkgLy8gY29sbGlzaW9uIGRldGVjdGlvblxyXG4gICAgICAgICAgICAvLy5mb3JjZSgnY2hhcmdlJywgZDMuZm9yY2VNYW55Qm9keSgpLnN0cmVuZ3RoKHN0cmVuZ3RoKSkgLy8gY2hhcmdlXHJcbiAgICAgICAgICAgIC8vLmZvcmNlKCdjaGFyZ2UnLCBkMy5mb3JjZU1hbnlCb2R5UmV1c2UoKS5zdHJlbmd0aChzdHJlbmd0aCkpIC8vIGNoYXJnZVxyXG4gICAgICAgICAgICAuZm9yY2UoJ2NoYXJnZScsIGQzLmZvcmNlTWFueUJvZHlTYW1wbGVkKCkuc3RyZW5ndGgoc3RyZW5ndGgpKSAvLyBjaGFyZ2VcclxuICAgICAgICAgICAgLmZvcmNlKCd4JywgZDMuZm9yY2VYKHgpLnN0cmVuZ3RoKDAuMykpXHJcbiAgICAgICAgICAgIC5mb3JjZSgneScsIGQzLmZvcmNlWSh5KS5zdHJlbmd0aCgwLjMpKTtcclxuICAgIGVsc2UgaWYgKGxheW91dCA9PT0gJ3JhZGlhbCcpXHJcbiAgICAgICAgc2ltdWxhdGlvblxyXG4gICAgICAgICAgICAuZm9yY2UoJ2NvbGxpZGUnLCBkMy5mb3JjZUNvbGxpZGUoKS5yYWRpdXMocmFkaXVzICsgMC41KSkgLy8gY29sbGlzaW9uIGRldGVjdGlvblxyXG4gICAgICAgICAgICAuZm9yY2UoJ3InLCBkMy5mb3JjZVJhZGlhbChvcmJpdFJhZGl1cyAvIDIpKTsgLy8gcG9zaXRpb25pbmdcclxuXHJcbiAgICAvLyBzdG9wIHNpbXVsYXRpb25cclxuICAgIHNpbXVsYXRpb24uc3RvcCgpO1xyXG5cclxuICAgIC8vIGluY3JlbWVudCBzaW11bGF0aW9uIG1hbnVhbGx5XHJcbiAgICBmb3IgKFxyXG4gICAgICAgIHZhciBpID0gMCxcclxuICAgICAgICAgICAgbiA9IE1hdGguY2VpbChNYXRoLmxvZyhzaW11bGF0aW9uLmFscGhhTWluKCkpIC8gTWF0aC5sb2coMSAtIHNpbXVsYXRpb24uYWxwaGFEZWNheSgpKSk7XHJcbiAgICAgICAgaSA8IG47XHJcbiAgICAgICAgKytpXHJcbiAgICApIHtcclxuICAgICAgICBzaW11bGF0aW9uLnRpY2soKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyByZXR1cm4gdXBkYXRlZCBub2RlcyBhcnJheSB0byBiZSBkcmF3biBhbmQgcmVuZGVyZWRcclxuICAgIHBvc3RNZXNzYWdlKHsgbm9kZXMsIHJhZGl1cywgaWQgfSk7XHJcbn07XHJcbiJdLCJuYW1lcyI6WyJzZWxmIiwiaW1wb3J0U2NyaXB0cyIsIm9ubWVzc2FnZSIsImV2ZW50IiwiZGF0YSIsIm5vZGVzIiwibGF5b3V0Iiwic3RyZW5ndGgiLCJvcmJpdFJhZGl1cyIsIngiLCJ5IiwicmFkaXVzIiwiaWQiLCJzaW11bGF0aW9uIiwiZDMiLCJmb3JjZVNpbXVsYXRpb24iLCJmb3JjZSIsImZvcmNlQ29sbGlkZSIsImZvcmNlTWFueUJvZHlTYW1wbGVkIiwiZm9yY2VYIiwiZm9yY2VZIiwiZm9yY2VSYWRpYWwiLCJzdG9wIiwiaSIsIm4iLCJNYXRoIiwiY2VpbCIsImxvZyIsImFscGhhTWluIiwiYWxwaGFEZWNheSIsInRpY2siLCJwb3N0TWVzc2FnZSJdLCJtYXBwaW5ncyI6Ijs7O0lBQUFBLElBQUksQ0FBQ0MsYUFBTCxDQUFtQix3Q0FBbkI7SUFDQUQsSUFBSSxDQUFDQyxhQUFMLENBQW1CLHdDQUFuQjtJQUNBRCxJQUFJLENBQUNDLGFBQUwsQ0FBbUIscUNBQW5CO0lBQ0FELElBQUksQ0FBQ0MsYUFBTCxDQUFtQixxQ0FBbkI7O0lBRUFELElBQUksQ0FBQ0MsYUFBTCxDQUNJLG1GQURKOztJQUlBQyxTQUFTLEdBQUcsbUJBQVVDLEtBQVYsRUFBaUI7SUFBQSxvQkFVckJBLEtBQUssQ0FBQ0MsSUFWZTtJQUFBLE1BRXJCQyxLQUZxQixlQUVyQkEsS0FGcUI7SUFBQSxNQUdyQkMsTUFIcUIsZUFHckJBLE1BSHFCO0lBQUEsTUFJckJDLFFBSnFCLGVBSXJCQSxRQUpxQjtJQUFBLE1BS3JCQyxXQUxxQixlQUtyQkEsV0FMcUI7SUFBQSxNQU1yQkMsQ0FOcUIsZUFNckJBLENBTnFCO0lBQUEsTUFPckJDLENBUHFCLGVBT3JCQSxDQVBxQjtJQUFBLE1BUXJCQyxNQVJxQixlQVFyQkEsTUFScUI7SUFBQSxNQVNyQkMsRUFUcUIsZUFTckJBLEVBVHFCO0lBWXpCLE1BQU1DLFVBQVUsR0FBR0MsRUFBRSxDQUFDQyxlQUFILEdBQXFCVixLQUFyQixDQUEyQkEsS0FBM0IsQ0FBbkI7SUFFQSxNQUFJQyxNQUFNLEtBQUssVUFBZixFQUNJTyxVQUFVLENBQ0xHLEtBREwsQ0FDVyxTQURYLEVBQ3NCRixFQUFFLENBQUNHLFlBQUgsR0FBa0JOLE1BQWxCLENBQXlCQSxNQUFNLEdBQUcsR0FBbEMsQ0FEdEI7SUFFSTtJQUNBO0lBSEosR0FJS0ssS0FKTCxDQUlXLFFBSlgsRUFJcUJGLEVBQUUsQ0FBQ0ksb0JBQUgsR0FBMEJYLFFBQTFCLENBQW1DQSxRQUFuQyxDQUpyQjtJQUFBLEdBS0tTLEtBTEwsQ0FLVyxHQUxYLEVBS2dCRixFQUFFLENBQUNLLE1BQUgsQ0FBVVYsQ0FBVixFQUFhRixRQUFiLENBQXNCLEdBQXRCLENBTGhCLEVBTUtTLEtBTkwsQ0FNVyxHQU5YLEVBTWdCRixFQUFFLENBQUNNLE1BQUgsQ0FBVVYsQ0FBVixFQUFhSCxRQUFiLENBQXNCLEdBQXRCLENBTmhCLEVBREosS0FRSyxJQUFJRCxNQUFNLEtBQUssUUFBZixFQUNETyxVQUFVLENBQ0xHLEtBREwsQ0FDVyxTQURYLEVBQ3NCRixFQUFFLENBQUNHLFlBQUgsR0FBa0JOLE1BQWxCLENBQXlCQSxNQUFNLEdBQUcsR0FBbEMsQ0FEdEI7SUFBQSxHQUVLSyxLQUZMLENBRVcsR0FGWCxFQUVnQkYsRUFBRSxDQUFDTyxXQUFILENBQWViLFdBQVcsR0FBRyxDQUE3QixDQUZoQixFQXZCcUI7SUEyQnpCOztJQUNBSyxFQUFBQSxVQUFVLENBQUNTLElBQVgsR0E1QnlCOztJQStCekIsT0FDSSxJQUFJQyxDQUFDLEdBQUcsQ0FBUixFQUNJQyxDQUFDLEdBQUdDLElBQUksQ0FBQ0MsSUFBTCxDQUFVRCxJQUFJLENBQUNFLEdBQUwsQ0FBU2QsVUFBVSxDQUFDZSxRQUFYLEVBQVQsSUFBa0NILElBQUksQ0FBQ0UsR0FBTCxDQUFTLElBQUlkLFVBQVUsQ0FBQ2dCLFVBQVgsRUFBYixDQUE1QyxDQUZaLEVBR0lOLENBQUMsR0FBR0MsQ0FIUixFQUlJLEVBQUVELENBSk4sRUFLRTtJQUNFVixJQUFBQSxVQUFVLENBQUNpQixJQUFYO0lBQ0gsR0F0Q3dCOzs7SUF5Q3pCQyxFQUFBQSxXQUFXLENBQUM7SUFBRTFCLElBQUFBLEtBQUssRUFBTEEsS0FBRjtJQUFTTSxJQUFBQSxNQUFNLEVBQU5BLE1BQVQ7SUFBaUJDLElBQUFBLEVBQUUsRUFBRkE7SUFBakIsR0FBRCxDQUFYO0lBQ0gsQ0ExQ0Q7Ozs7OzsifQ==",C=!1,function(t){return B=B||m(b,x,C),new Worker(B,t)});function Q(t,n,e,i){var a=new I;return a.postMessage({nodes:t,layout:this.settings.staticLayout,strength:this.settings.chargeStrength,orbitRadius:this.settings.orbitRadius,x:n,y:e,radius:this.settings.minRadius,id:i}),a}function F(t,n){var e=this;t.onmessage=function(t){var n="fdg-static--".concat(t.data.id.replace(/[^0-9_a-z]/gi,"-"));e.containers.svgBackground.selectAll(".".concat(n)).remove();var i=e.containers.svgBackground.insert("g",":first-child").classed("fdg-static ".concat(n),!0);"radial"==e.settings.staticLayout&&i.attr("transform","translate(".concat(e.settings.orbitRadius/2,",").concat(e.settings.height/2,")"));var a=i.selectAll(".fdg-static__mark").data(t.data.nodes).join("circle"===e.settings.shape?"circle":"rect").classed("fdg-static__mark",!0).attr("fill",(function(t){return t.color})).attr("fill-opacity",.25);"circle"===e.settings.shape?a.attr("cx",(function(t){return t.x})).attr("cy",(function(t){return t.y})).attr("r",t.data.radius):a.attr("x",(function(n){return n.x-t.data.radius})).attr("y",(function(n){return n.y-t.data.radius})).attr("width",2*t.data.radius).attr("height",2*t.data.radius)}}function A(){var t=this;if(this.settings.drawStaticSeparately){this.containers.svgBackground.selectAll(".fdg-static").remove();var n=this.data.nested.filter((function(t){return t.value.noStateChange})).map((function(t){return{key:t.key,colorValue:t.value.colorValue,color:t.value.color}}));if("categorical"===this.settings.colorBy.type&&this.settings.colorBy.stratify)this.metadata.event[0].foci.forEach((function(e){var i=n.filter((function(t){return t.colorValue===e.key})),a=Q.call(t,i,e.x,e.y,e.key);F.call(t,a)}));else{var e=Q.call(this,n,this.settings.orbitRadius/2,this.settings.height/2,"main");F.call(this,e)}}}function w(t,n){var e=this;return void 0!==n?t[n]:t.find((function(n,i){return n.start_timepoint<=e.settings.timepoint&&e.settings.timepoint<=n.end_timepoint||i===t.length-1}))}function k(t){var n=this;return t.filter((function(t){return t.start_timepoint<=n.settings.timepoint})).sort((function(t,n){return t.start_timepoint-n.start_timepoint})).filter((function(t,e,i){var a=i[e-1]?i[e-1].event:null;return!n.settings.eventChangeCount.includes(a)&&n.settings.eventChangeCount.includes(t.event)})).length}function U(t,n){return{colorValue:"frequency"===this.settings.colorBy.type?k.call(this,t):null!==this.settings.colorBy.variable?n[this.settings.colorBy.variable]:null,sizeValue:"frequency"===this.settings.sizeBy.type?k.call(this,t):null!==this.settings.sizeBy.variable?n[this.settings.sizeBy.variable]:null,shapeValue:"frequency"===this.settings.shapeBy.type?k.call(this,t):null!==this.settings.shapeBy.variable?n[this.settings.shapeBy.variable]:null}}function S(t,n){var e=this.settings.stratify&&this.settings.colorBy.stratify?this.metadata.event.find((function(n){return n.value===t.event})).foci.find((function(t){return t.key===n})):this.metadata.event.find((function(n){return n.value===t.event}));return{x:e.x,y:e.y}}function L(t){return this.settings.stratify&&"frequency"===this.settings.sizeBy.type?this.metadata.strata.find((function(n){return n.key===t})).colorScale:this.scales.color}function Z(t,n){var e=void 0!==t?t(n):"rgb(170,170,170)",i=e.replace("rgb","rgba").replace(")",", 0.5)"),a=e.replace("rgb","rgba").replace(")",", 1)");return{color:e,fill:i,stroke:a}}function R(t,n){return void 0!==t?t(n):this.settings.minRadius}function _(t,n){return void 0!==t?t(n):this.settings.shape}function M(t,n){var e=Z.call(this,this.scales.color,t.colorValue),a=R.call(this,this.scales.size,t.sizeValue),s=_.call(this,this.scales.shape,t.shapeValue);return i(i({},e),{},{size:a,shape:s})}function N(){var t=this;this.data.nested.forEach((function(n){var e=w.call(t,n.value.group);n.value.state!==e&&(n.value.statePrevious=n.value.state,n.value.state=e);var i=U.call(t,n.value.group,n.value.state);n.value.coordinates=S.call(t,n.value.state,i.colorValue),n.value.colorScale=L.call(t,i.colorValue);var a=M.call(t,i,n.value.colorScale);Object.assign(n.value,i,a)}))}function G(){var t=this;this.metadata.event.forEach((function(n){n.data=t.data.nested.filter((function(t,e){return t.value.state.event===n.value})),n.count=n.data.length,n.proportion=n.count/n.denominator,n.proportionFmt=d3.format(".1%")(n.proportion),n.cumulative=t.data.filter((function(e){return e.event===n.value&&e.start_timepoint<=t.settings.timepoint})).length,n.countFmt=d3.format(",d")(n.count),n.countProportionFmt="".concat(n.countFmt," (").concat(n.proportionFmt,")"),n.cumulativeFmt=d3.format(",d")(n.cumulative),n.cells=[n.label,n.countProportionFmt,n.cumulativeFmt],n.change=n.count-n.prevCount,n.foci&&n.foci.forEach((function(e){e.data=n.data.filter((function(t,n){return t.value.colorValue===e.key})),e.count=e.data.length,e.proportion=e.count/e.denominator,e.proportionFmt=d3.format(".1%")(e.proportion),e.cumulative=t.data.filter((function(i){return i.event===n.value&&i.colorValue===e.key&&i.start_timepoint<=t.settings.timepoint})).length,e.countFmt=d3.format(",d")(e.count),e.countProportionFmt="".concat(e.countFmt," (").concat(e.proportionFmt,")"),e.cumulativeFmt=d3.format(",d")(e.cumulative),e.cells=[e.label,e.countProportionFmt,e.cumulativeFmt],e.change=e.count-e.prevCount}))}))}function V(){this.metadata.event.forEach((function(t){t.prevCount=t.count,t.foci&&t.foci.forEach((function(t){t.prevCount=t.count}))})),N.call(this),G.call(this)}function J(){var t=this.containers.animation.node();this.settings.width=t.clientWidth,this.settings.height=this.containers.animation.node().clientHeight,this.containers.stopwatch.width=this.containers.stopwatch.node().clientWidth,this.containers.stopwatch.innerRadius=this.containers.stopwatch.width/8,this.containers.stopwatch.svg.attr("width",this.containers.stopwatch.width).attr("height",this.containers.stopwatch.width),this.containers.stopwatch.arc.innerRadius(this.containers.stopwatch.innerRadius).outerRadius(this.containers.stopwatch.width/2-1),this.containers.stopwatch.g.attr("transform","translate(".concat(this.containers.stopwatch.width/2,",").concat(this.containers.stopwatch.width/2,")")),this.containers.stopwatch.background.attr("d",this.containers.stopwatch.arc),this.containers.stopwatch.foreground.attr("d",this.containers.stopwatch.arc),this.containers.svgBackground.attr("width",this.settings.width).attr("height",this.settings.height),this.containers.canvas.attr("width",this.settings.width).attr("height",this.settings.height),this.containers.svgForeground.attr("width",this.settings.width).attr("height",this.settings.height),y.call(this,this.metadata),this.orbits.attr("cx",(function(t){return t.cx})).attr("cy",(function(t){return t.cy})).attr("r",(function(t){return t.r})),"categorical"===this.settings.colorBy.type&&this.settings.colorBy.stratify&&this.metadata.event.forEach((function(t,n){t.foci.forEach((function(e,i){e.x=t.x+50*Math.cos(e.angle),e.dx=t.x+(0===n?75:50)*Math.cos(e.angle),e.y=t.y+50*Math.sin(e.angle),e.dy=t.y+(0===n?75:50)*Math.sin(e.angle)})),t.fociLabels.selectAll("text.fdg-focus-annotation__text").attr("x",(function(t){return t.dx})).attr("y",(function(t){return t.dy}))})),V.call(this),v.call(this),A.call(this),this.focusAnnotations.attr("transform",(function(t){return"translate(".concat(t.x,",").concat(t.y,")")}))}function E(){var t=u("main",d3.select(this.element)),n=h.call(this,t),e=f.call(this,t),a=p.call(this,t);return window.addEventListener("resize",J.bind(this)),i(i(i({main:t},n),e),a)}function W(){var t=this,n=d3.nest().key((function(t){return t.id})).rollup((function(n){return{duration:d3.sum(n,(function(t){return+t.duration})),static:1===n.length,colorStratum:"categorical"===t.settings.colorBy.type?n[0][t.settings.colorBy.variable]:null,shapeStratum:"categorical"===t.settings.shapeBy.type?n[0][t.settings.shapeBy.variable]:null}})).entries(this.data);return n.forEach((function(t,n){Object.assign(t,t.value),t.value=t.key,delete t.key})),n}function X(t){var n=this;this.settings.duration=this.settings.duration||d3.max(t.id,(function(t){return t.duration})),this.settings.text=this.settings.text.filter((function(e){return!(/static/i.test(e)&&(t.id.every((function(t){return!1===t.static}))||!1===n.settings.drawStaticSeparately))})).map((function(t){return t.replace("[duration]",d3.format(",d")(n.settings.duration))})),this.settings.minRadius=this.settings.minRadius||Math.min(3e3/t.id.filter((function(t){return!(n.settings.drawStaticSeparately&&t.static)})).length,this.settings.maxRadius),this.settings.staticRadius=this.settings.staticRadius||3e3/t.id.length,this.settings.maxRadius=this.settings.minRadius+this.settings.colorBy.nColors,this.settings.chargeStrength=-2e3/t.id.filter((function(t){return!(n.settings.drawStaticSeparately&&t.static)})).length,this.settings.staticChargeStrength=-2e3/t.id.length,this.settings.fill=this.settings.fill||t.id.length<=2500}function Y(){var t=d3.nest().key((function(t){return t.event})).rollup((function(t){var n=t[0];return{order:parseInt(n.event_order),position:n.hasOwnProperty("event_position")?parseInt(n.event_position):null,count:0,prevCount:0,cumulative:0,nEvents:t.length}})).entries(this.data);return t.forEach((function(t){Object.assign(t,t.value),t.value=t.key,delete t.key})),d3.nest().key((function(t){return t.order})).rollup((function(t){var n=t.length,e=d3.range(-45,46);t.forEach((function(t,i){t.position=null===t.position?d3.quantile(e,(i+1)/(n+1)):t.position}))})).entries(t),t.sort((function(t,n){return t.order-n.order||n.nEvents-t.nEvents})),t}function z(t){this.settings.eventCentral=this.settings.eventCentral||t.event[0].value,this.settings.nFoci=this.settings.nFoci||t.event.length-!!this.settings.eventCentral,this.settings.eventChangeCount=this.settings.eventChangeCount||t.event.slice(1).map((function(t){return t.value}))}function T(t){var n=this;return d3.nest().key((function(t){return t.order})).entries(t.event.filter((function(t){return t.value!==n.settings.eventCentral})))}function j(t){var n,e=this;return this.settings.stratify&&(n=d3.nest().key((function(t){return t[e.settings.colorBy.variable]})).entries(this.data).sort((function(t,n){return t.key<n.key?-1:1})),this.settings.colorBy.nStrata=n.length,this.settings.colorBy.theta=2*Math.PI/this.settings.colorBy.nStrata,n.forEach((function(n,i){n.value=n.key;var a=e.settings.colorBy.colorSchemes[i];n.colorScheme=d3["scheme".concat(a.substring(0,1).toUpperCase()).concat(a.substring(1),"s")],n.colorScale=d3.scaleLinear().domain(d3.range(e.settings.nColors)).range(n.colorScheme[9].reverse().slice(0,e.settings.nColors).reverse()).clamp(!0),n.nParticipants=t.id.filter((function(t){return t.colorStratum===n.value})).length,n.nEvents=n.values.length,n.angle=e.settings.colorBy.nStrata%2?i*e.settings.colorBy.theta:i*e.settings.colorBy.theta+Math.PI/e.settings.colorBy.nStrata}))),n}function H(t){var n,e=this;return this.settings.shapify&&(n=d3.nest().key((function(t){return t[e.settings.shapeBy.variable]})).entries(this.data).sort((function(t,n){return t.key<n.key?-1:1}))),n}function D(t){var n,e,i=this.settings.colorBy,a="frequency"===i.type?d3.range(i.nColors):"continuous"===i.type?d3.extent(this.data,(function(t){return t[i.variable]})):"categorical"===i.type?t.strata.map((function(t){return t.key})):null;switch(i.type){case"frequency":n=i.mirror?d3["scheme".concat(i.colorScheme)][i.nColors].reverse():d3["scheme".concat(i.colorScheme)][i.nColors],e=d3.scaleLinear().domain(a).range(n).clamp(!0);break;case"continuous":if(e=d3.scaleSequential(d3["interpolate".concat(i.colorScheme)]).domain(a),i.mirror){var s=e.interpolator();e.interpolator((function(t){return s(1-t)}))}break;case"categorical":var r=d3["scheme".concat(i.colorScheme)];n=r.every((function(t){return"string"==typeof t}))?r:r[Math.min(Math.max(3,a.length),9)],e=d3.scaleOrdinal().domain(a).range(n.map((function(t){return d3.rgb(t)+""})));break;default:e=null}return e}function q(t){var n=this.settings.sizeBy,e="frequency"===n.type?[0,this.settings.colorBy.nColors]:"continuous"===n.type?d3.extent(this.data,(function(t){return t[n.variable]})):null,i=[this.settings.minRadius,this.settings.maxRadius];return d3.scaleLinear().domain(e).range(i).clamp(!0)}function K(t){var n;if(this.settings.shapify){var e=this.settings.shapeBy,i="categorical"===e.type?t.shape.map((function(t){return t.key})):null,a=e.shapes;n=d3.scaleOrdinal().domain(i).range(a)}return n}function P(t){return{color:D.call(this,t),size:q.call(this,t),shape:K.call(this,t)}}function O(t){"categorical"===this.settings.colorBy.type&&t.event.forEach((function(n,e){n.foci=t.strata.map((function(t,a){return i(i({},t),{},{x:n.x+50*Math.cos(t.angle),dx:n.x+(0===e?75:50)*Math.cos(t.angle),y:n.y+50*Math.sin(t.angle),dy:n.y+(0===e?75:50)*Math.sin(t.angle),count:0,cumulative:0})}))}))}function $(t){var n=this;return d3.merge(t.event.map((function(e){var i="categorical"===n.settings.colorBy.type?[e].concat(a(e.foci)):[e];return i.forEach((function(n){n.state=e.value,n.label=n.value,n.denominator=n.label!==n.state?n.nParticipants:t.id.length,n.proportion=n.count/n.denominator,n.proportionFmt=d3.format(".1%")(n.proportion),n.countFmt=d3.format(",d")(n.count),n.countProportionFmt="".concat(n.countFmt," (").concat(n.proportionFmt,")"),n.cumulativeFmt=d3.format(",d")(n.cumulative),n.cells=[n.label,n.countProportionFmt,n.cumulativeFmt],n.cells.proportion=n.proportion})),i})))}function tt(){var t={};return t.id=W.call(this),X.call(this,t),t.event=Y.call(this),z.call(this,t),t.orbit=T.call(this,t),y.call(this,t),t.strata=j.call(this,t),t.shape=H.call(this,t),this.scales=P.call(this,t),O.call(this,t),this.data.freqTable=$.call(this,t),t}function nt(){var t=this;this.settings.pulseOrbits&&this.orbits.each((function(n){n.change=d3.sum(n.values,(function(t){return t.change})),n.change>0&&d3.select(this).transition().duration(t.settings.speeds[t.settings.speed]/2).attr("stroke-width",.5*n.change).transition().duration(t.settings.speeds[t.settings.speed]/2).attr("stroke-width",.5)}))}function et(){this.containers.progressBar.style("width","".concat(100*this.settings.progress,"%")),this.containers.progressDay.style("right","".concat(100-100*this.settings.progress,"%")).text("Day ".concat(this.settings.timepoint)),this.containers.timer.text("".concat(this.settings.timepoint," ").concat(this.settings.timeUnit)),this.containers.progress.attr("title","The animation is ".concat(d3.format(".1%")(this.settings.progress)," complete with ").concat(this.settings.duration-this.settings.timepoint," ").concat(this.settings.timeUnit.split(" ")[0]," to go.")),this.containers.stopwatch.foreground.transition().duration(this.settings.speed).attrTween("d",this.util.arcTween(this.settings.progress*Math.PI*2,this.containers.stopwatch.arc)).style("fill",d3.interpolateRdYlGn(1-this.settings.progress)),this.containers.stopwatch.percentBackground.text(this.settings.progress<.0095?d3.format(".1%")(this.settings.progress):d3.format(".0%")(this.settings.progress)),this.containers.stopwatch.percentForeground.text(this.settings.progress<.0095?d3.format(".1%")(this.settings.progress):d3.format(".0%")(this.settings.progress)),this.controls.timepoint.inputs.property("value",this.settings.timepoint)}function it(){var t=d3.nest().key((function(t){return t.value.shapeValue})).rollup((function(t){return t.length})).entries(this.data.nested);this.containers.legends.selectAll(".fdg-legend--shape").selectAll("text").text((function(n){return"".concat(n," (n=").concat(t.find((function(t){return t.key===n})).value,")")}))}function at(){this.settings.eventCount&&this.focusAnnotations.selectAll("tspan.fdg-focus-annotation__event-count").text((function(t){return t.countProportionFmt})),"categorical"===this.settings.colorBy.type&&this.settings.colorBy.stratify&&this.metadata.event.forEach((function(t){t.fociLabels.selectAll("text").text((function(t){return t.countProportionFmt}))}))}function st(){this.freqTable.tr.each((function(t){d3.select(this).selectAll("td").data(t.cells).join("td").style("background",(function(n,e){return 1===e?"linear-gradient(to right, #bbb 0, #bbb ".concat(t.proportionFmt,", transparent ").concat(t.proportionFmt,")"):null})).text((function(t){return t}))}))}function rt(){this.settings.progress=this.settings.timepoint/this.settings.duration,et.call(this),it.call(this),at.call(this),st.call(this)}function ot(){V.call(this),nt.call(this),rt.call(this)}function ct(){var t=this,n=this.settings.resetDelay/1e3-1;return this.containers.countdown.classed("fdg-invisible",!1).classed("fdg-hidden",(function(t){return t!==n})),window.setInterval((function(){n--,t.containers.countdown.classed("fdg-hidden",(function(t){return t!==n}))}),1e3)}function lt(t){d3.select(this).transition().duration(t/15).delay(t-t/15*2).style("opacity",0)}function ut(t,n){t.style("opacity",0).transition().duration(n/15).style("opacity",1).on("end",(function(){lt.call(this,n)}))}function ht(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"outline",e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"thick groove rgba(215,25,28,0)",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"thick groove rgba(215,25,28,.5)",a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];a?t.style(n,e).transition().duration(this.settings.modalSpeed/15).style(n,i).transition().duration(this.settings.modalSpeed/15).delay(this.settings.modalSpeed-this.settings.modalSpeed/15*2).style(n,e).on("end",(function(){return t.style(n,null)})):(t.style(n,i),d3.timeout((function(){t.style(n,null)}),this.settings.modalSpeed))}function dt(){switch(this.modalText=this.settings.text[this.settings.modalIndex],this.settings.modalIndex===this.settings.text.length-1&&this.modal&&this.modal.stop(),this.containers.modal.html(this.modalText).call(ut,this.settings.modalSpeed),!0){case/time/i.test(this.modalText):ht.call(this,this.containers.progress);break;case/color/i.test(this.modalText):ht.call(this,this.containers.legends);break;case/static/i.test(this.modalText):ht.call(this,this.containers.svgBackground.selectAll(".fdg-static__mark"),"stroke","rgba(215,25,28,0)","rgba(215,25,28,.5)",!1);break;case/controls/i.test(this.modalText):ht.call(this,this.containers.controls)}}function gt(){var t=this;dt.call(this),this.modal=d3.interval((function(){t.settings.modalIndex++,dt.call(t)}),this.settings.modalSpeed)}function ft(){var t=this;this.settings.timepoint=0,this.settings.modalIndex=0,this.controls.timepoint.inputs.attr("value",0),this.metadata.event.forEach((function(t){t.prevCount=0,t.count=0,t.cumulative=0})),this.data.nested.forEach((function(n){n.value.statePrevious=null,n.value.state=w.call(t,n.value.group);var e=U.call(t,n.value.group,n.value.state);n.value.coordinates=S.call(t,n.value.state,e.colorValue),n.value.colorScale=L.call(t,e.colorValue);var i=M.call(t,e,n.value.colorScale);Object.assign(n.value,e,i)})),this.modal&&this.modal.stop(),gt.call(this)}function pt(t){var n=this,e=window.setTimeout((function(){ft.call(n),n.containers.timer.text("".concat(n.settings.timepoint," ").concat(n.settings.timeUnit)),n.settings.progress=0,n.containers.stopwatch.foreground.transition().duration(n.settings.speed).attrTween("d",n.util.arcTween(n.settings.progress*Math.PI*2,n.containers.stopwatch.arc)).style("fill",d3.interpolateRdYlGn(1-n.settings.progress)),window.clearInterval(t),window.clearTimeout(e),n.containers.countdown.classed("fdg-invisible",(function(t){return t===n.settings.resetDelay/1e3-1})).classed("fdg-hidden",(function(t){return t!==n.settings.resetDelay/1e3-1})),n.interval=mt.call(n)}),this.settings.resetDelay);return e}function yt(){this.interval.stop(),v.call(this);var t=ct.call(this);pt.call(this,t)}var vt=function(t){this.settings.timepoint+=!!t,this.settings.timepoint<=this.settings.duration?ot.call(this):!0===this.settings.loop&&yt.call(this),v.call(this)};function mt(){return d3.interval(vt.bind(this),this.settings.speeds[this.settings.speed])}var bt=[{action:"play",label:"Play",html:"&#9658;"},{action:"pause",label:"Pause",html:"&#10074;&#10074;"}];function xt(){var t=this;this.settings.playPause=bt.find((function(n){return n.action!==t.settings.playPause})).action,this.controls.playPause.inputs.attr("title","".concat(bt.find((function(n){return n.action!==t.settings.playPause})).label," animation")).html(bt.find((function(n){return n.action!==t.settings.playPause})).html),"play"===this.settings.playPause?this.interval=mt.call(this):this.interval.stop()}function Ct(){var t=this,n=this,e=this.controls.container.append("div").classed("fdg-control fdg-control--speed",!0),i=e.selectAll("div").data(Object.keys(this.settings.speeds).map((function(n){return{label:n,value:t.settings.speeds[n]}}))).enter().append("div").attr("class",(function(n){return"fdg-button ".concat(n.label," ").concat(n.label===t.settings.speed?"current":"")})).attr("title",(function(n){return"Advance the animation every ".concat(t.settings.speeds[n.label]/1e3," second(s).")})).text((function(t){return t.label}));return i.on("click",(function(t){n.settings.speed=t.label,i.classed("current",(function(n){return n.label===t.label})),"play"===n.settings.playPause&&(n.interval.stop(),n.interval=mt.call(n))})),{container:e,inputs:i}}function Bt(){var t=this,n=this.controls.container.append("div").classed("fdg-control fdg-control--play-pause",!0),e=n.append("div").classed("fdg-button fdg-input",!0).attr("title","".concat(bt.find((function(n){return n.action!==t.settings.playPause})).label," animation.")).html(bt.find((function(n){return n.action!==t.settings.playPause})).html);return e.on("click",(function(){xt.call(t)})),{container:n,inputs:e}}function It(){var t=this,n=this.controls.container.append("div").classed("fdg-control fdg-control--step",!0),e=n.append("div").classed("fdg-button fdg-input",!0).attr("title","Advance animation by one time unit.").text("Step");return e.on("click",(function(){"pause"!==t.settings.playPause&&xt.call(t),vt.call(t,!0)})),{container:n,inputs:e}}function Qt(){var t=this,n=this,e=this.controls.container.append("div").classed("fdg-control fdg-control--timepoint",!0),i=e.append("div").classed("fdg-button fdg-input",!0).append("input").attr("type","number").attr("title","Choose a timepoint.").attr("value",+this.settings.timepoint).attr("min",1).attr("max",this.settings.duration);return i.on("click",(function(){"pause"!==t.settings.playPause&&xt.call(t)})),i.on("change",(function(){"pause"!==n.settings.playPause&&xt.call(n),n.settings.timepoint=+this.value-1,vt.call(n,!0)})),{container:e,inputs:i}}function Ft(){var t=this,n=this.controls.container.append("div").classed("fdg-control fdg-control--reset",!0),e=n.append("div").classed("fdg-button fdg-input",!0).attr("title","Reset animation.").html("&#x21ba;");return e.on("click",(function(){ft.call(t),"play"!==t.settings.playPause&&xt.call(t)})),{container:n,inputs:e}}function At(){var t=this,n=this,e=this.controls.container.append("div").classed("fdg-control fdg-control--event-list",!0),i=e.selectAll("div").data(this.metadata.event).enter().append("div").attr("class",(function(n){return"fdg-button ".concat(t.settings.eventChangeCount.includes(n.value)?"current":"")})).attr("title",(function(n){return"".concat(t.settings.eventChangeCount.includes(n.value)?"Remove":"Add"," ").concat(n.value," ").concat(t.settings.eventChangeCount.includes(n.value)?"from":"to"," the list of events that control bubble ").concat("both"===t.settings.eventChangeCountAesthetic?"color and size":t.settings.eventChangeCountAesthetic,".")})).text((function(t){return t.value}));return i.on("click",(function(t){var e=this;this.classList.toggle("current"),n.settings.eventChangeCount.includes(this.textContent)?n.settings.eventChangeCount.splice(n.settings.eventChangeCount.findIndex((function(t){return t===e.textContent})),1):n.settings.eventChangeCount.push(this.textContent),this.title="".concat(n.settings.eventChangeCount.includes(t.value)?"Remove":"Add"," ").concat(t.value," ").concat(n.settings.eventChangeCount.includes(t.value)?"from":"to"," the list of events that control bubble ").concat("both"===n.settings.eventChangeCountAesthetic?"color and size":n.settings.eventChangeCountAesthetic,"."),n.controls.colorSizeToggle.inputs.attr("title",(function(t){return"Quantify the number of ".concat(n.util.csv(n.settings.eventChangeCount)," events by ").concat("both"!==t?t:"color and size",".")})),n.legends.container.classed("fdg-invisible",0===n.settings.eventChangeCount.length).selectAll("span.fdg-measure").text(n.util.csv(n.settings.eventChangeCount)),vt.call(n,!1)})),{container:e,inputs:i}}function wt(){this.controls={container:this.containers.controls},this.controls.speed=Ct.call(this),this.controls.playPause=Bt.call(this),this.controls.step=It.call(this),this.controls.timepoint=Qt.call(this),this.controls.reset=Ft.call(this),"frequency"===this.settings.colorBy.type&&(this.controls.eventList=At.call(this)),this.controls.container.selectAll(".fdg-button").on("mousedown",(function(){this.classList.toggle("clicked")})).on("mouseup",(function(){this.classList.toggle("clicked")})).on("mouseout",(function(){this.classList.contains("clicked")&&this.classList.toggle("clicked")}))}function kt(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:256,e=document.createElement("canvas");e.width=n,e.height=1;for(var i=e.getContext("2d"),a=0;a<n;++a)i.fillStyle=t(a/(n-1)),i.fillRect(a,0,1,1);return e}function Ut(){this.legends.container.append("div").classed("fdg-legend fdg-legend--continuous",!0).node().appendChild(function(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=n.color,i=n.title,a=n.tickSize,s=void 0===a?6:a,r=n.width,o=void 0===r?320:r,c=n.height,l=void 0===c?44+s:c,u=n.marginTop,h=void 0===u?18:u,d=n.marginRight,g=void 0===d?0:d,f=n.marginBottom,p=void 0===f?16+s:f,y=n.marginLeft,v=void 0===y?0:y,m=n.ticks,b=void 0===m?o/64:m,x=n.tickFormat,C=n.tickValues,B=d3.create("svg").attr("width",o).attr("height",l).attr("viewBox",[0,0,o,l]).style("overflow","visible"),I=function(t){return t.selectAll(".tick line").attr("y1",h+p-l)};if(e.interpolate){var Q=Math.min(e.domain().length,e.range().length);t=e.copy().rangeRound(d3.quantize(d3.interpolate(v,o-g),Q)),B.append("image").attr("x",v).attr("y",h).attr("width",o-v-g).attr("height",l-h-p).attr("preserveAspectRatio","none").attr("xlink:href",kt.call(this,e.copy().domain(d3.quantize(d3.interpolate(0,1),Q))).toDataURL())}else if(e.interpolator){if(t=Object.assign(e.copy().interpolator(d3.interpolateRound(v,o-g)),{range:function(){return[v,o-g]}}),B.append("image").attr("x",v).attr("y",h).attr("width",o-v-g).attr("height",l-h-p).attr("preserveAspectRatio","none").attr("xlink:href",kt.call(this,e.interpolator()).toDataURL()),!t.ticks){if(void 0===C){var F=Math.round(b+1);C=d3.range(F).map((function(t){return d3.quantile(e.domain(),t/(F-1))}))}"function"!=typeof x&&(x=d3.format(void 0===x?",f":x))}}else if(e.invertExtent){var A=e.thresholds?e.thresholds():e.quantiles?e.quantiles():e.domain(),w=void 0===x?function(t){return t}:"string"==typeof x?d3.format(x):x;t=d3.scaleLinear().domain([-1,e.range().length-1]).rangeRound([v,o-g]),B.append("g").selectAll("rect").data(e.range()).join("rect").attr("x",(function(n,e){return t(e-1)})).attr("y",h).attr("width",(function(n,e){return t(e)-t(e-1)})).attr("height",l-h-p).attr("fill",(function(t){return t})),C=d3.range(A.length),x=function(t){return w(A[t],t)}}else t=d3.scaleBand().domain(e.domain()).rangeRound([v,o-g]),B.append("g").selectAll("rect").data(e.domain()).join("rect").attr("x",t).attr("y",h).attr("width",Math.max(0,t.bandwidth()-1)).attr("height",l-h-p).attr("fill",e),I=function(){};return B.append("g").attr("transform","translate(0,".concat(l-p,")")).call(d3.axisBottom(t).ticks(b,"string"==typeof x?x:void 0).tickFormat("function"==typeof x?x:void 0).tickSize(s).tickValues(C)).call(I).call((function(t){return t.select(".domain").remove()})).call((function(t){return t.append("text").classed("fdg-sidebar__label fdg-legend__label",!0).attr("x",v).attr("y",h+p-l-6).attr("fill","currentColor").attr("text-anchor","middle").attr("transform","translate(".concat(o/2,",0)")).attr("font-weight","bold").attr("font-size","1.25rem").text(i)})),B.node()}({color:this.scales.color,title:this.settings.colorBy.label,width:200,height:50,tickValues:[this.scales.color.domain()[0],(this.scales.color.domain()[1]-this.scales.color.domain()[0])/2,this.scales.color.domain()[1]]}))}function St(){var t=this,n=this.legends.container.append("div").classed("fdg-legend fdg-legend--categorical",!0);n.append("div").classed("fdg-sidebar__label fdg-legend__label",!0).text(this.settings.colorBy.label);var e=n.append("svg").attr("width",200).attr("height",20*this.scales.color.domain().length).selectAll("g").data(this.scales.color.domain()).join("g");e.append("circle").attr("cx",20).attr("cy",(function(t,n){return 20*n+10})).attr("r",7).attr("fill",(function(n){return t.scales.color(n)})),e.append("text").attr("font-size","1rem").attr("x",35).attr("y",(function(t,n){return 20*n+12})).attr("alignment-baseline","middle").text((function(n){return"".concat(n," (n=").concat(t.metadata.id.filter((function(t){return t.colorStratum===n})).length,")")}))}var Lt={color:function(t,n){var e=this;return t.selectAll("rect.legend-mark").data(this.scales.color.range()).enter().append("rect").classed("legend-mark",!0).attr("x",(function(t,i){return i*(n[0]/e.settings.colorBy.nColors)})).attr("y",0).attr("width",n[0]/this.settings.colorBy.nColors).attr("height",n[1]/3).attr("fill",(function(t){return t})).attr("fill-opacity",.5).attr("stroke",(function(t){return t})).attr("stroke-opacity",1)},size:function(t,n){var e=this,i=t.selectAll("circle.legend-mark").data(d3.range(this.settings.colorBy.nColors)).join("circle"===this.settings.shape?"circle":"rect").classed("legend-mark",!0).attr("fill",(function(t){return"#aaa"})).attr("fill-opacity",.5).attr("stroke",(function(t){return"#aaa"})).attr("stroke-opacity",1);return"circle"===this.settings.shape?i.attr("cx",(function(t,i){return i*(n[0]/e.settings.colorBy.nColors)+n[0]/e.settings.colorBy.nColors/2})).attr("cy",n[1]/4).attr("r",(function(t,n){return n+e.settings.minRadius})):"square"===this.settings.shape&&i.attr("x",(function(t,i){return i*(n[0]/e.settings.colorBy.nColors)+n[0]/e.settings.colorBy.nColors/2-(i+e.settings.minRadius)})).attr("y",(function(t,i){return n[1]/4-(i+e.settings.minRadius)})).attr("width",(function(t,n){return 2*(n+e.settings.minRadius)})).attr("height",(function(t,n){return 2*(n+e.settings.minRadius)})),i},both:function(t,n){var e=this,i=t.selectAll("circle.legend-mark").data(this.scales.color.range()).join("circle"===this.settings.shape?"circle":"rect").classed("legend-mark",!0).attr("fill",(function(t){return t})).attr("fill-opacity",.5).attr("stroke",(function(t){return t})).attr("stroke-opacity",1);return"circle"===this.settings.shape?i.attr("cx",(function(t,i){return i*(n[0]/e.settings.colorBy.nColors)+n[0]/e.settings.colorBy.nColors/2})).attr("cy",n[1]/4).attr("r",(function(t,n){return n+e.settings.minRadius})):"square"===this.settings.shape&&i.attr("x",(function(t,i){return i*(n[0]/e.settings.colorBy.nColors)+n[0]/e.settings.colorBy.nColors/2-(i+e.settings.minRadius)})).attr("y",(function(t,i){return n[1]/4-(i+e.settings.minRadius)})).attr("width",(function(t,n){return 2*(n+e.settings.minRadius)})).attr("height",(function(t,n){return 2*(n+e.settings.minRadius)})),i}};function Zt(t){var n=[200,50],e=this.legends.container.append("div").classed("fdg-legend fdg-legend--".concat(t),!0).classed("fdg-hidden",this.settings.eventChangeCountAesthetic!==t||0===this.settings.eventChangeCount.length),i=e.append("div").classed("fdg-sidebar__label fdg-legend__label",!0).html('Number of <span class = "fdg-measure">'.concat(this.util.csv(this.settings.eventChangeCount),"</span> events")),a=e.append("svg").attr("width",n[0]).attr("height",n[1]).append("g"),s=Lt[t].call(this,a,n),r=a.append("text").attr("x",n[0]/this.settings.colorBy.nColors/2).attr("y",n[1]/2+16).attr("text-anchor","middle").text("0"),o=a.append("text").attr("x",n[0]-n[0]/this.settings.colorBy.nColors/2).attr("y",n[1]/2+16).attr("text-anchor","middle").text("".concat(this.settings.colorBy.nColors-1,"+"));return{container:e,label:i,svg:a,marks:s,lower:r,upper:o}}function Rt(){this.legends.color=Zt.call(this,"color"),this.legends.size=Zt.call(this,"size"),this.legends.both=Zt.call(this,"both")}function _t(t,n,e,i){t.append("circle").attr("cx",e).attr("cy",n*e+10).attr("r",i-1).attr("fill","none").attr("stroke","#444")}function Mt(t,n,e,i){t.append("rect").attr("x",e-i+1.5).attr("y",n*e+i/2+1).attr("width",1.5*i).attr("height",1.5*i).attr("fill","none").attr("stroke","#444")}function Nt(t,n,e,i){var a=1.5*i/Math.sqrt(3),s=n*e+a+3,r=[e,s-a],o=[e-a,s+a],c=[e+a,s+a];t.append("polygon").attr("points",[r,o,c]).attr("fill","none").attr("stroke","#444")}function Gt(t,n,e,i){var a=e,s=n*e;t.append("rect").attr("transform","rotate(45 ".concat(a," ").concat(s,")")).attr("x",a).attr("y",s).attr("width",1.5*i).attr("height",1.5*i).attr("fill","none").attr("stroke","#444")}function Vt(t,n,e,i){for(var a=Math.PI/5,s=.6*i,r=1.2*i,o=2*i/Math.sqrt(3),c=Math.PI/2*3,l=e,u=n*e+o,h=[l,u],d=[],g=0;g<5;g++)l=h[0]+Math.cos(c)*r,u=h[1]+Math.sin(c)*r,d.push([l,u]),c+=a,l=h[0]+Math.cos(c)*s,u=h[1]+Math.sin(c)*s,d.push([l,u]),c+=a;t.append("polygon").attr("points",d).attr("fill","none").attr("stroke","#444")}function Jt(t,n,e,i){var a=1.5*i/Math.sqrt(3),s=n*e+a+3,r=[e,s+a],o=[e-a,s-a],c=[e+a,s-a];t.append("polygon").attr("points",[r,o,c]).attr("fill","none").attr("stroke","#444")}function Et(){var t=this,n=this,e={circle:_t,square:Mt,triangle:Nt,diamond:Gt,star:Vt,triangleDown:Jt},i=this.legends.container.append("div").classed("fdg-legend fdg-legend--shape",!0);i.append("div").classed("fdg-sidebar__label fdg-legend__label",!0).text(this.settings.shapeBy.label);var a=i.append("svg").attr("width",200).attr("height",20*this.scales.shape.domain().length).selectAll("g").data(this.scales.shape.domain()).join("g");a.each((function(t,i){e[n.scales.shape(t)].call(n,d3.select(this),i,20,7)})),a.append("text").attr("font-size","1rem").attr("x",35).attr("y",(function(t,n){return 20*n+12})).attr("alignment-baseline","middle").text((function(n){return"".concat(n," (n=").concat(t.metadata.id.filter((function(t){return t.shapeStratum===n})).length,")")}))}function Wt(){switch(this.legends={container:this.containers.legends},this.settings.colorBy.type){case"frequency":Rt.call(this);break;case"categorical":St.call(this);break;case"continuous":Ut.call(this);break;default:return}this.settings.shapify&&Et.call(this)}function Xt(){var t=this,n={container:this.containers.freqTable.classed("fdg-hidden",this.settings.hideFreqTable)};return n.table=n.container.append("table").classed("fdg-freq-table__table",!0),n.thead=n.table.append("thead").classed("fdg-freq-table__thead",!0),n.th=n.thead.selectAll("th").data(["","Participants","Events"]).join("th").attr("class",(function(t,n){return"fdg-freq-table__th--".concat(0===n?"label":1===n?"participant":2===n?"event":n)})).classed("fdg-freq-table__th",!0).text((function(t){return t})),n.th.filter((function(t){return"Participants"===t})).html((function(n){return"".concat(n," <span ","class = 'fdg-info-icon'"," ").concat("categorical"===t.settings.colorBy.type?"title = 'Gray background represents the percentage of individuals in the given group at the given state'":"title = 'Gray background represents the percentage of individuals at the given state'",">&#9432;</span>")})),n.tbody=n.table.append("tbody").classed("fdg-freq-table__tbody",!0),n.tr=n.tbody.selectAll("tr").data(this.data.freqTable.filter((function(n){return!(!1===t.settings.eventCentralInFreqTable&&n.state===t.settings.eventCentral)}))).join("tr").attr("class",(function(t){return t.state!==t.value?"fdg-freq-table__tr--subgroup":null})).classed("fdg-freq-table__tr",!0).style("font-size",(function(t){return t.group!==t.value?"1rem":"1.25rem"})),n.tr.each((function(t,n){d3.select(this).selectAll("td").data((function(n){return t.cells})).join("td").attr("class",(function(t,n){return"fdg-freq-table__td--".concat(0===n?"label":1===n?"participant":2===n?"event":n)})).classed("fdg-freq-table__td",!0).style("background",(function(n,e){return 1===e?"linear-gradient(to right, #bbb 0, #bbb ".concat(t.proportionFmt,", transparent ").concat(t.proportionFmt,")"):null})).text((function(t){return"number"==typeof t?d3.format(",d")(t):t}))})),n.td=n.tr.selectAll("td"),n}function Yt(){var t=this.containers.svgBackground.append("g").classed("fdg-g fdg-g--orbits",!0);return t.append("defs").selectAll("filter").data(this.metadata.orbit).join("filter").attr("id",(function(t,n){return"orbit--".concat(n)})).append("feDropShadow").attr("dx",0).attr("dy",0).attr("stdDeviation",5).attr("flood-color","black"),t.selectAll("circle.orbit").data(this.metadata.orbit).enter().append("circle").classed("orbit",!0).attr("cx",(function(t){return t.cx})).attr("cy",(function(t){return t.cy})).attr("r",(function(t){return t.r})).attr("fill","none").attr("stroke","#aaa").attr("stroke-width",".5").style("filter",(function(t,n){return"url(#orbit--".concat(n,")")}))}function zt(t){return Math.round(t.x)===Math.round(this.settings.orbitRadius/2)}function Tt(t){return 1===t.order||Math.round(t.x)<Math.round(this.settings.width/2)}function jt(t){return zt.call(this,t)?"middle":Tt.call(this,t)?"start":"end"}function Ht(t){return zt.call(this,t)?0:Tt.call(this,t)?"2em":"-2em"}function Dt(t){return Math.round(t.y)===Math.round(this.settings.height/2)}function qt(t){return Math.round(t.y)<Math.round(this.settings.height/2)}function Kt(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=Dt.call(this,t)?"middle":qt.call(this,t)?"hanging":"baseline";return n&&(e="hanging"===e?"baseline":"baseline"===e?"hanging":e),e}function Pt(t){return Dt.call(this,t)?0:qt.call(this,t)?"-2em":"2em"}function Ot(t){var n=this,e=t.append("tspan").classed("fdg-focus-annotation__label",!0).attr("x",0).attr("text-anchor",(function(t){return jt.call(n,t)})).text((function(t){return t.value}));return"categorical"===this.settings.colorBy.type&&this.settings.colorBy.stratify&&e.attr("alignment-baseline",(function(t){return Kt.call(n,t,!0)})),e}function $t(t){var n=this;return t.append("tspan").classed("fdg-focus-annotation__event-count",!0).classed("fdg-hidden",!1===this.settings.eventCount).attr("x",0).attr("dy","1.3em").attr("text-anchor",(function(t){return jt.call(n,t)}))}function tn(t,n,e){var i=this;"categorical"===this.settings.colorBy.type&&this.settings.colorBy.stratify&&(t.style("transform",(function(t){return"translate(".concat(Dt.call(i,t)?"-5em,0":"0,-5em",")")})),n.attr("text-anchor","middle"),e.attr("text-anchor","middle").classed("fdg-hidden",!0))}function nn(){var t=this,n=this.containers.focusAnnotations.selectAll("g.fdg-focus-annotation").data(this.metadata.event).join("g").classed("fdg-focus-annotation",!0).attr("transform",(function(t){return"translate(".concat(t.x,",").concat(t.y,")")}));return["background","foreground"].forEach((function(e){var i=n.append("text").classed("fdg-focus-annotation__text fdg-focus-annotation__".concat(e),!0).style("transform",(function(n){return"translate(".concat(Ht.call(t,n),",").concat(Pt.call(t,n),")")})),a=Ot.call(t,i),s=$t.call(t,i);tn.call(t,i,a,s)})),"categorical"===this.settings.colorBy.type&&this.settings.colorBy.stratify&&this.metadata.event.forEach((function(n){n.fociLabels=t.containers.focusAnnotations.append("g").classed("fdg-focus-annotation fdg-focus-annotation--categorical",!0),["background","foreground"].forEach((function(e){n.fociLabels.selectAll("text.fdg-focus-annotation__".concat(e)).data(n.foci).join("text").classed("fdg-focus-annotation__text fdg-focus-annotation__".concat(e),!0).attr("x",(function(t){return t.dx})).attr("dx",(function(e){return n.value===t.settings.eventCentral?null:"-1em"})).attr("y",(function(t){return t.dy})).attr("text-anchor",(function(e){return n.value===t.settings.eventCentral?"middle":"end"})).attr("alignment-baseline",(function(n){return Kt.call(t,n,!0)}))}))})),n}function en(){wt.call(this),Wt.call(this),this.containers.timer.text("".concat(this.settings.timepoint," ").concat(this.settings.timeUnit)),this.freqTable=Xt.call(this),this.orbits=Yt.call(this),this.focusAnnotations=nn.call(this)}function an(){var t,n={},e=o(Object.keys(this.settings).filter((function(t){return/_var$/.test(t)})));try{for(e.s();!(t=e.n()).done;){var i=t.value;n[i.replace(/_var$/,"")]=this.data[0].hasOwnProperty(this.settings[i])}}catch(t){e.e(t)}finally{e.f()}return n}function sn(){var t=this;this.data.forEach((function(n){var e,i=o(Object.keys(t.settings).filter((function(t){return/_var$/.test(t)})));try{for(i.s();!(e=i.n()).done;){var a=e.value,s=a.replace(/_var$/,"");n[s]=["event_order","start_timepoint","end_timepoint","duration","sequence"].includes(s)?+n[t.settings[a]]:n[t.settings[a]]}}catch(t){i.e(t)}finally{i.f()}}))}function rn(t){d3.nest().key((function(t){return t.id})).rollup((function(n){n.forEach((function(e,i){t.duration&&!t.start_timepoint&&(0===i?(e.start_timepoint=1,e.end_timepoint=e.duration):(e.start_timepoint=n[i-1].end_timepoint+1,e.end_timepoint=e.start_timepoint+e.duration-1)),t.start_timepoint&&!t.end_timepoint&&(e.end_timepoint=i<n.length-1?n[i+1].start_timepoint-1:e.duration?e.start_timepoint+e.duration-1:e.start_timepoint),!t.duration&&t.start_timepoint&&t.end_timepoint&&(e.duration=e.start_timepoint-e.end_timepoint+1)})),t.sequence?n.sort((function(t,n){return t.seq-n.seq})):n.sort((function(t,n){return t.start_timepoint-n.start_timepoint})).forEach((function(t,n){t.seq=n}))})).entries(this.data)}function on(){var t=this.data.every((function(t){return/^-?\d+\.?\d*$/.test(t.id)||/^-?\d*\.?\d+$/.test(t.id)}));this.data.sort((function(n,e){var i=t?+n.id-+e.id:n.id<e.id?-1:e.id<n.id?1:0,a=n.seq-e.seq;return i||a}))}function cn(){var t=an.call(this);sn.call(this),rn.call(this,t),on.call(this)}function ln(){var t=this;return d3.nest().key((function(t){return t.id})).rollup((function(n){var e=d3.sum(n,(function(t){return t.duration})),a=1===n.length,s=w.call(t,n,0),r=U.call(t,n,s),o=S.call(t,s,r.colorValue),c=L.call(t,r.colorValue),l=M.call(t,r,c);return i(i({group:n,duration:e,noStateChange:a,stateprevious:null,state:s},r),{},{coordinates:o,colorScale:c},l)})).entries(this.data)}function un(){var t=this;cn.call(this),this.data.nested=ln.call(this),this.metadata.event.forEach((function(n){n.data=t.data.nested.filter((function(t){return t.value.state.event===n.value}))}))}function hn(t){return function(){return t}}function dn(t,n,e,i){if(isNaN(n)||isNaN(e))return t;var a,s,r,o,c,l,u,h,d,g=t._root,f={data:i},p=t._x0,y=t._y0,v=t._x1,m=t._y1;if(!g)return t._root=f,t;for(;g.length;)if((l=n>=(s=(p+v)/2))?p=s:v=s,(u=e>=(r=(y+m)/2))?y=r:m=r,a=g,!(g=g[h=u<<1|l]))return a[h]=f,t;if(o=+t._x.call(null,g.data),c=+t._y.call(null,g.data),n===o&&e===c)return f.next=g,a?a[h]=f:t._root=f,t;do{a=a?a[h]=new Array(4):t._root=new Array(4),(l=n>=(s=(p+v)/2))?p=s:v=s,(u=e>=(r=(y+m)/2))?y=r:m=r}while((h=u<<1|l)==(d=(c>=r)<<1|o>=s));return a[d]=g,a[h]=f,t}function gn(t,n,e,i,a){this.node=t,this.x0=n,this.y0=e,this.x1=i,this.y1=a}function fn(t){return t[0]}function pn(t){return t[1]}function yn(t,n,e){var i=new vn(null==n?fn:n,null==e?pn:e,NaN,NaN,NaN,NaN);return null==t?i:i.addAll(t)}function vn(t,n,e,i,a,s){this._x=t,this._y=n,this._x0=e,this._y0=i,this._x1=a,this._y1=s,this._root=void 0}function mn(t){for(var n={data:t.data},e=n;t=t.next;)e=e.next={data:t.data};return n}var bn=yn.prototype=vn.prototype;function xn(t){return function(){return t}}function Cn(){var t,n,e,i,a,s,r,o,c=xn(-30),l=0,u=1,h=1/0,d=function(){return 15},g=function(t){return Math.pow(t.length,.75)},f=function(t){return Math.pow(t.length,.25)},p=function(t){return t.length<100?1:t.length<200?3:Math.sqrt(t.length)},y=Math.random;function v(n){var e,i,s,r,o=Math.floor(y()*t.length),c=t[o],l=(n.x-c.x)*(n.x-c.x)+(n.y-c.y)*(n.y-c.y),u=-1/0,h=-1;if(!(n.nearest.indexOf(o)>=0))if(n.nearest.length<a)n.nearest.push(o);else{for(;++h<n.nearest.length;)e=n.nearest[h],i=t[e],(s=Math.hypot(n.x-i.x,n.y-i.y))>u&&(r=h,u=s);l<u&&(n.nearest[r]=o)}}function m(a){var s,c,l,d,g,f,p;for(c=function(n,e){e=Math.floor(e);var i,a,s,r=t.length,o=r-e;for(i=r-1;i>=o;--i)s=n[a=Math.floor(y()*i)],n[a]=n[i],n[i]=s;return n.slice(o)}(i,r),s=c.length-1;s>=0;--s)(l=t[c[s]])!==a&&((p=(g=l.x-a.x)*g+(f=l.y-a.y)*f)>=h||(0===g&&(p+=(g=1e-6*(y()-.5))*g),0===f&&(p+=(f=1e-6*(y()-.5))*f),p<u&&(p=Math.sqrt(u*p)),d=e[a.index]*n*o/p,a.vx+=g*d,a.vy+=f*d))}function b(i){var s,r,c,l,d,g,f;if(a&&v(i),r=i.nearest,a)for(s=r.length-1;s>=0;--s)(c=t[r[s]])!==i&&((f=(d=c.x-i.x)*d+(g=c.y-i.y)*g)>=h||(0===d&&(f+=(d=1e-6*(y()-.5))*d),0===g&&(f+=(g=1e-6*(y()-.5))*g),f<u&&(f=Math.sqrt(u*f)),l=e[i.index]*n*o/f,i.vx+=d*l,i.vy+=g*l))}function x(e){var i=0,r=l,o=t.length,c=l+s;for(n=e;i<o||r<c;++i,++r)r<c&&m(t[r%o]),a&&i<o&&b(t[i]);l=c%o}function C(){if(t){var l,u,h=t.length;for(i=new Array(h),l=0;l<h;++l)i[l]=l;for(e=new Array(h),a=(a=Math.min(Math.ceil(d(t)),h))<0?0:Math.min(a,t.length),s=(s=Math.ceil(g(t)))<0?0:Math.min(s,h),r=(r=Math.ceil(f(t)))<0?0:Math.min(r,h),o=p(t),n=1,l=0;l<h;++l)for(u=t[l],e[u.index]=+c(u,l,t),u.nearest=[];u.nearest.length<a;)v(u)}}return x.initialize=function(n){t=n,C()},x.strength=function(t){return arguments.length?(c="function"==typeof t?t:xn(+t),C(),x):c},x.distanceMin=function(t){return arguments.length?(u=t*t,x):Math.sqrt(u)},x.distanceMax=function(t){return arguments.length?(h=t*t,x):Math.sqrt(h)},x.neighborSize=function(t){return arguments.length?(d="function"==typeof t?t:xn(+t),C(),x):d},x.updateSize=function(t){return arguments.length?(g="function"==typeof t?t:xn(+t),C(),x):g},x.sampleSize=function(t){return arguments.length?(f="function"==typeof t?t:xn(+t),C(),x):f},x.chargeMultiplier=function(t){return arguments.length?(p="function"==typeof t?t:xn(+t),C(),x):p},x.source=function(t){return arguments.length?(y=t,x):y},x}function Bn(t){this.containers.canvas.context.moveTo(t.x+t.size,t.y),this.containers.canvas.context.arc(t.x,t.y,t.value.size,0,2*Math.PI),this.settings.fill&&(this.containers.canvas.context.fillStyle=t.value.fill,this.containers.canvas.context.fill()),this.containers.canvas.context.strokeStyle=t.value.stroke,this.containers.canvas.context.stroke()}function In(t){this.containers.canvas.context.rect(t.x-t.value.size,t.y-t.value.size,2*t.value.size,2*t.value.size),this.settings.fill&&(this.containers.canvas.context.fillStyle=t.value.fill,this.containers.canvas.context.fill()),this.containers.canvas.context.strokeStyle=t.value.stroke,this.containers.canvas.context.stroke()}function Qn(t){var n=this.containers.canvas.context,e=2*t.value.size/Math.sqrt(3),i=(t.x,t.y,[t.x,t.y-e]),a=[t.x-e,t.y+e],s=[t.x+e,t.y+e];n.moveTo.apply(n,i),n.lineTo.apply(n,a),n.lineTo.apply(n,s),n.lineTo.apply(n,i),this.settings.fill&&(this.containers.canvas.context.fillStyle=t.value.fill,this.containers.canvas.context.fill()),this.containers.canvas.context.strokeStyle=t.value.stroke,this.containers.canvas.context.stroke()}function Fn(t){var n=this.containers.canvas.context,e=t.value.size*Math.sqrt(2);n.moveTo(t.x,t.y-e),n.lineTo(t.x+e,t.y),n.lineTo(t.x,t.y+e),n.lineTo(t.x-e,t.y),n.lineTo(t.x,t.y-e),this.settings.fill&&(this.containers.canvas.context.fillStyle=t.value.fill,this.containers.canvas.context.fill()),this.containers.canvas.context.strokeStyle=t.value.stroke,this.containers.canvas.context.stroke()}function An(t){var n=this.containers.canvas.context,e=Math.PI/5,i=.75*t.value.size,a=1.5*t.value.size,s=Math.PI/2*3,r=t.x,o=t.y;n.beginPath(),n.moveTo(t.x,t.y-a);for(var c=0;c<5;c++)r=t.x+Math.cos(s)*a,o=t.y+Math.sin(s)*a,n.lineTo(r,o),s+=e,r=t.x+Math.cos(s)*i,o=t.y+Math.sin(s)*i,n.lineTo(r,o),s+=e;n.lineTo(t.x,t.y-a),n.closePath(),n.strokeStyle=t.value.stroke,n.stroke(),n.fillStyle=t.value.fill,n.fill()}function wn(t){var n=this.containers.canvas.context,e=2*t.value.size/Math.sqrt(3),i=(t.x,t.y,[t.x,t.y+e]),a=[t.x-e,t.y-e],s=[t.x+e,t.y-e];n.moveTo.apply(n,i),n.lineTo.apply(n,a),n.lineTo.apply(n,s),n.lineTo.apply(n,i),this.settings.fill&&(this.containers.canvas.context.fillStyle=t.value.fill,this.containers.canvas.context.fill()),this.containers.canvas.context.strokeStyle=t.value.stroke,this.containers.canvas.context.stroke()}function kn(){var t=this;this.containers.canvas.context.clearRect(0,0,this.settings.width,this.settings.height),this.containers.canvas.context.save(),this.data.nested.sort((function(t,n){return t.value.stateChanges-n.value.stateChanges})).forEach((function(n,e){switch(t.containers.canvas.context.beginPath(),n.value.shape){case"circle":Bn.call(t,n);break;case"square":In.call(t,n);break;case"triangle":Qn.call(t,n);break;case"diamond":Fn.call(t,n);break;case"star":An.call(t,n);break;case"triangleDown":wn.call(t,n);break;default:Bn.call(t,n)}})),this.containers.canvas.context.restore()}function Un(){var t=this;this.forceSimulation=d3.forceSimulation().nodes(this.data.nested.filter((function(n){return!(t.settings.drawStaticSeparately&&n.value.noStateChange)}))).alphaDecay(.01).velocityDecay(.9).force("center",d3.forceCenter(this.settings.orbitRadius/2,this.settings.height/2)).force("x",d3.forceX().x((function(t){return t.value.coordinates.x})).strength(.3)).force("y",d3.forceY().y((function(t){return t.value.coordinates.y})).strength(.3)).force("charge","forceManyBodyReuse"===this.settings.manyBody?function(){var t,n,e,i,a,s,r,o=0,c=hn(-30),l=1,u=1/0,h=.81;function d(){return 1e-6*(Math.random()-.5)}function g(t){return t.x}function f(t){return t.y}function p(a){var r,c=t.length;for(i&&!s(o,t)||(i=yn(t,g,f).visitAfter(v),t.update.push(o)),e=a,r=0;r<c;++r)n=t[r],i.visit(m);++o}function y(){if(t){o=0,t.update=[],s=a(),i=null;var n,e,l=t.length;for(r=new Array(l),n=0;n<l;++n)e=t[n],r[e.index]=+c(e,n,t)}}function v(t){var n,e,i,a,s,o=0,c=0;if(t.length){for(i=a=s=0;s<4;++s)(n=t[s])&&(e=Math.abs(n.value))&&(o+=n.value,c+=e,i+=e*n.x,a+=e*n.y);t.x=i/c,t.y=a/c}else{(n=t).x=n.data.x,n.y=n.data.y;do{o+=r[n.data.index]}while(n=n.next)}t.value=o}function m(t,i,a,s){if(!t.value)return!0;var o=t.x-n.x,c=t.y-n.y,g=s-i,f=o*o+c*c;if(g*g/h<f)return f<u&&(0===o&&(f+=(o=d())*o),0===c&&(f+=(c=d())*c),f<l&&(f=Math.sqrt(l*f)),n.vx+=o*t.value*e/f,n.vy+=c*t.value*e/f),!0;if(!(t.length||f>=u)){(t.data!==n||t.next)&&(0===o&&(f+=(o=d())*o),0===c&&(f+=(c=d())*c),f<l&&(f=Math.sqrt(l*f)));do{t.data!==n&&(f=(o=t.data.x-n.x)*o+(c=t.data.y-n.y)*c,0===o&&(f+=(o=d())*o),0===c&&(f+=(c=d())*c),f<l&&(f=Math.sqrt(l*f)),g=r[t.data.index]*e/f,n.vx+=o*g,n.vy+=c*g)}while(t=t.next)}}return a=function(){return function(t){return t%13==0}},p.initialize=function(n){t=n,y()},p.strength=function(t){return arguments.length?(c="function"==typeof t?t:hn(+t),y(),p):c},p.distanceMin=function(t){return arguments.length?(l=t*t,p):Math.sqrt(l)},p.distanceMax=function(t){return arguments.length?(u=t*t,p):Math.sqrt(u)},p.theta=function(t){return arguments.length?(h=t*t,p):Math.sqrt(h)},p.update=function(t){return arguments.length?(s=(a=t)(),p):a},p}().strength(this.settings.chargeStrength):"forceManyBodySampled"===this.settings.manyBody?Cn().strength(this.settings.chargeStrength*this.metadata.id.length/1e3):d3.forceManyBody().strength(this.settings.chargeStrength)).force("collide",d3.forceCollide().radius((function(n){return n.value.size+t.settings.collisionPadding}))).on("tick",kn.bind(this))}function Sn(){gt.call(this),A.call(this),Un.call(this),"play"===this.settings.playPause&&(this.interval=mt.call(this))}return bn.copy=function(){var t,n,e=new vn(this._x,this._y,this._x0,this._y0,this._x1,this._y1),i=this._root;if(!i)return e;if(!i.length)return e._root=mn(i),e;for(t=[{source:i,target:e._root=new Array(4)}];i=t.pop();)for(var a=0;a<4;++a)(n=i.source[a])&&(n.length?t.push({source:n,target:i.target[a]=new Array(4)}):i.target[a]=mn(n));return e},bn.add=function(t){var n=+this._x.call(null,t),e=+this._y.call(null,t);return dn(this.cover(n,e),n,e,t)},bn.addAll=function(t){var n,e,i,a,s=t.length,r=new Array(s),o=new Array(s),c=1/0,l=1/0,u=-1/0,h=-1/0;for(e=0;e<s;++e)isNaN(i=+this._x.call(null,n=t[e]))||isNaN(a=+this._y.call(null,n))||(r[e]=i,o[e]=a,i<c&&(c=i),i>u&&(u=i),a<l&&(l=a),a>h&&(h=a));if(c>u||l>h)return this;for(this.cover(c,l).cover(u,h),e=0;e<s;++e)dn(this,r[e],o[e],t[e]);return this},bn.cover=function(t,n){if(isNaN(t=+t)||isNaN(n=+n))return this;var e=this._x0,i=this._y0,a=this._x1,s=this._y1;if(isNaN(e))a=(e=Math.floor(t))+1,s=(i=Math.floor(n))+1;else{for(var r,o,c=a-e,l=this._root;e>t||t>=a||i>n||n>=s;)switch(o=(n<i)<<1|t<e,(r=new Array(4))[o]=l,l=r,c*=2,o){case 0:a=e+c,s=i+c;break;case 1:e=a-c,s=i+c;break;case 2:a=e+c,i=s-c;break;case 3:e=a-c,i=s-c}this._root&&this._root.length&&(this._root=l)}return this._x0=e,this._y0=i,this._x1=a,this._y1=s,this},bn.data=function(){var t=[];return this.visit((function(n){if(!n.length)do{t.push(n.data)}while(n=n.next)})),t},bn.extent=function(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},bn.find=function(t,n,e){var i,a,s,r,o,c,l,u=this._x0,h=this._y0,d=this._x1,g=this._y1,f=[],p=this._root;for(p&&f.push(new gn(p,u,h,d,g)),null==e?e=1/0:(u=t-e,h=n-e,d=t+e,g=n+e,e*=e);c=f.pop();)if(!(!(p=c.node)||(a=c.x0)>d||(s=c.y0)>g||(r=c.x1)<u||(o=c.y1)<h))if(p.length){var y=(a+r)/2,v=(s+o)/2;f.push(new gn(p[3],y,v,r,o),new gn(p[2],a,v,y,o),new gn(p[1],y,s,r,v),new gn(p[0],a,s,y,v)),(l=(n>=v)<<1|t>=y)&&(c=f[f.length-1],f[f.length-1]=f[f.length-1-l],f[f.length-1-l]=c)}else{var m=t-+this._x.call(null,p.data),b=n-+this._y.call(null,p.data),x=m*m+b*b;if(x<e){var C=Math.sqrt(e=x);u=t-C,h=n-C,d=t+C,g=n+C,i=p.data}}return i},bn.remove=function(t){if(isNaN(s=+this._x.call(null,t))||isNaN(r=+this._y.call(null,t)))return this;var n,e,i,a,s,r,o,c,l,u,h,d,g=this._root,f=this._x0,p=this._y0,y=this._x1,v=this._y1;if(!g)return this;if(g.length)for(;;){if((l=s>=(o=(f+y)/2))?f=o:y=o,(u=r>=(c=(p+v)/2))?p=c:v=c,n=g,!(g=g[h=u<<1|l]))return this;if(!g.length)break;(n[h+1&3]||n[h+2&3]||n[h+3&3])&&(e=n,d=h)}for(;g.data!==t;)if(i=g,!(g=g.next))return this;return(a=g.next)&&delete g.next,i?(a?i.next=a:delete i.next,this):n?(a?n[h]=a:delete n[h],(g=n[0]||n[1]||n[2]||n[3])&&g===(n[3]||n[2]||n[1]||n[0])&&!g.length&&(e?e[d]=g:this._root=g),this):(this._root=a,this)},bn.removeAll=function(t){for(var n=0,e=t.length;n<e;++n)this.remove(t[n]);return this},bn.root=function(){return this._root},bn.size=function(){var t=0;return this.visit((function(n){if(!n.length)do{++t}while(n=n.next)})),t},bn.visit=function(t){var n,e,i,a,s,r,o=[],c=this._root;for(c&&o.push(new gn(c,this._x0,this._y0,this._x1,this._y1));n=o.pop();)if(!t(c=n.node,i=n.x0,a=n.y0,s=n.x1,r=n.y1)&&c.length){var l=(i+s)/2,u=(a+r)/2;(e=c[3])&&o.push(new gn(e,l,u,s,r)),(e=c[2])&&o.push(new gn(e,i,u,l,r)),(e=c[1])&&o.push(new gn(e,l,a,s,u)),(e=c[0])&&o.push(new gn(e,i,a,l,u))}return this},bn.visitAfter=function(t){var n,e=[],i=[];for(this._root&&e.push(new gn(this._root,this._x0,this._y0,this._x1,this._y1));n=e.pop();){var a=n.node;if(a.length){var s,r=n.x0,o=n.y0,c=n.x1,l=n.y1,u=(r+c)/2,h=(o+l)/2;(s=a[0])&&e.push(new gn(s,r,o,u,h)),(s=a[1])&&e.push(new gn(s,u,o,c,h)),(s=a[2])&&e.push(new gn(s,r,h,u,l)),(s=a[3])&&e.push(new gn(s,u,h,c,l))}i.push(n)}for(;n=i.pop();)t(n.node,n.x0,n.y0,n.x1,n.y1);return this},bn.x=function(t){return arguments.length?(this._x=t,this):this._x},bn.y=function(t){return arguments.length?(this._y=t,this):this._y},function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"body",e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i={data:t,element:n,settings:c.mergeDeep(l,e),util:c};return l.update.call(i),i.containers=E.call(i),i.metadata=tt.call(i),en.call(i),un.call(i),Sn.call(i),i}}));
