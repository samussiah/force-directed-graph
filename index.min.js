!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(t="undefined"!=typeof globalThis?globalThis:t||self).forceDirectedGraph=n()}(this,(function(){"use strict";var t={arcTween:function(t,n){return function(e){var i=d3.interpolate(e.endAngle,t);return function(t){return e.endAngle=i(t),n(e)}}},csv:function(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],e=t.join(", ");return n&&(e=e.replace(/, ([^,]*)$/," and $1")),e}};function n(){return["#a50026","#f46d43","#fdae61","#a6d96a","#66bd63","#006837"].reverse()}function e(){var t=n();return d3.scaleLinear().domain(d3.range(t.length)).range(t).clamp(!0)}var i={update:function(){var t=this;this.settings.explanation=this.settings.explanation.map((function(n){return n.replace(/bubble/g,t.settings.shape)})),this.settings.text=[].concat(this.settings.explanation.filter((function(n){return!(t.settings.hideControls&&n.includes("controls"))}))).concat(this.settings.information).filter((function(t){return"string"==typeof t}))},id_var:"id",event_var:"event",event_order_var:"event_order",start_timepoint_var:"stdy",end_timepoint_var:"endy",duration_var:"duration",sequence_var:"seq",timepoint:0,timeUnit:"days since randomization",duration:null,resetDelay:15e3,events:null,eventCentral:null,eventCount:!0,eventChangeCount:null,eventChangeCountAesthetic:"color",drawStaticSeparately:!0,speed:"medium",speeds:{slow:1e3,medium:500,fast:100},playPause:"play",pulseOrbits:!1,loop:!0,width:null,height:null,padding:1,nOrbits:null,orbitRadius:150,nFoci:null,translate:!1,hideControls:!1,chargeStrength:null,staticLayout:"circular",manyBody:"forceManyBodyReuse",colorBy:{type:"frequency",variable:null,label:null},colors:n,colorScale:e,color:function(t){return e()(Math.min(t,e().domain().length))},fill:null,sizeBy:{type:"frequency",variable:null,label:null},minRadius:null,maxRadius:null,shape:"circle",modal:!0,modalSpeed:15e3,modalIndex:0,explanation:["Each bubble in this animation represents an individual.",'As <span class = "fdg-emphasized">time progresses</span> and individuals experience events, their bubble gravitates toward the focus or "planet" representing that event.','The <span class = "fdg-emphasized">number of events</span> an individual has experienced determines the color and/or size of their bubble.','<span class = "fdg-emphasized">Static bubbles</span> represent individuals who never experience an event.','Use the <span class = "fdg-emphasized">controls</span> on the right to interact with and alter the animation.',"Continue watching to learn how these individuals progress over the course of [duration] days."],information:null};function s(t,n,e){return n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}function a(t,n){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable}))),e.push.apply(e,i)}return e}function r(t){for(var n=1;n<arguments.length;n++){var e=null!=arguments[n]?arguments[n]:{};n%2?a(Object(e),!0).forEach((function(n){s(t,n,e[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):a(Object(e)).forEach((function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))}))}return t}function o(t){return function(t){if(Array.isArray(t))return l(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||c(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(t,n){if(t){if("string"==typeof t)return l(t,n);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?l(t,n):void 0}}function l(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,i=new Array(n);e<n;e++)i[e]=t[e];return i}function u(t,n){var e;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(e=c(t))||n&&t&&"number"==typeof t.length){e&&(t=e);var i=0,s=function(){};return{s:s,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,r=!0,o=!1;return{s:function(){e=t[Symbol.iterator]()},n:function(){var t=e.next();return r=t.done,t},e:function(t){o=!0,a=t},f:function(){try{r||null==e.return||e.return()}finally{if(o)throw a}}}}function d(t,n){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"div",i=n.append(e).classed("fdg-".concat(t),!0);return i}function g(t){var n=d("controls",t).classed("fdg-hidden",this.settings.hideControls);d("hide",n,"span");return{controls:n}}function h(t){var n=d("stopwatch",t).style("width","100%");return n.width=n.node().clientWidth,n.innerRadius=n.width/8,n.svg=d("stopwatch__svg",n,"svg").attr("width",n.width).attr("height",n.width),n.arc=d3.arc().innerRadius(n.innerRadius).outerRadius(n.width/2-1).cornerRadius(12).startAngle(0),n.g=d("stopwatch__path",n.svg,"g").attr("transform","translate(".concat(n.width/2,",").concat(n.width/2,")")),n.background=d("stopwatch__path",n.g,"path").datum({endAngle:2*Math.PI}).attr("d",n.arc).style("fill","white").style("stroke","black").style("stroke-width",.5),n.foreground=d("stopwatch__path",n.g,"path").datum({endAngle:0}).attr("d",n.arc).style("fill","#a6d96a").style("stroke","black").style("stroke-width",.5),n.percentBackground=d("stopwatch__text",n.g,"text").attr("text-anchor","middle").attr("alignment-baseline","middle").style("font-weight","bold").style("stroke","white").style("stroke-width","4px").text("0%"),n.percentForeground=d("stopwatch__text",n.g,"text").attr("text-anchor","middle").attr("alignment-baseline","middle").style("font-weight","bold").text("0%"),n}function f(t){var n=this.settings.resetDelay/1e3;return d("countdown",t).classed("fdg-sidebar__label",!0).selectAll("div").data(d3.range(-1,n)).join("div").text((function(t){return"Looping in ".concat(t+1," second").concat(0===t?"":"s")})).classed("fdg-hidden",(function(t){return t!==n-1})).classed("fdg-invisible",(function(t){return t===n-1}))}function p(t){var n=d("sidebar",t),e=d("legends",n),i=d("progress",n),s=d("timer",i).classed("fdg-sidebar__label",!0);return{sidebar:n,legends:e,stopwatch:h.call(this,i),progress:i,timer:s,countdown:f.call(this,i),freqTable:d("freq-table",n)}}function v(t){var n=d("animation",t);this.settings.width=n.node().clientWidth,this.settings.height=n.node().clientHeight;var e=d("svg--background",n,"svg").attr("width",this.settings.width).attr("height",this.settings.height),i=d("canvas",n,"canvas").attr("width",this.settings.width).attr("height",this.settings.height);i.context=i.node().getContext("2d");var s=d("svg--foreground",n,"svg").attr("width",this.settings.width).attr("height",this.settings.height),a=d("modal",n);return{animation:n,svgBackground:e,canvas:i,svgForeground:s,modal:d("modal__text",a)}}function y(t){var n=this;this.settings.orbitRadius=this.settings.width/(t.orbit.length+1);var e=this.settings.orbitRadius/2,i=this.settings.height/2;Math.PI,this.settings.nFoci||(t.event.length,this.settings.eventCentral);t.event.forEach((function(t,s){t.radius=t.order*n.settings.orbitRadius,t.theta=2*Math.PI*t.position/360,t.x=0===t.order?e:e+t.radius*Math.cos(t.theta),t.y=0===t.order?i:i+t.radius*Math.sin(t.theta)})),t.orbit.forEach((function(t,s){t.cx=e,t.cy=i,t.r=(s+1)*n.settings.orbitRadius}))}function m(t,n,e){var i=void 0===n?null:n,s=function(t,n){var e=atob(t);if(n){for(var i=new Uint8Array(e.length),s=0,a=e.length;s<a;++s)i[s]=e.charCodeAt(s);return String.fromCharCode.apply(null,new Uint16Array(i.buffer))}return e}(t,void 0!==e&&e),a=s.indexOf("\n",10)+1,r=s.substring(a)+(i?"//# sourceMappingURL="+i:""),o=new Blob([r],{type:"application/javascript"});return URL.createObjectURL(o)}var b,C,x,I,B=(b="Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKCkgewogICAgJ3VzZSBzdHJpY3QnOwoKICAgIHNlbGYuaW1wb3J0U2NyaXB0cygnaHR0cHM6Ly9kM2pzLm9yZy9kMy1kaXNwYXRjaC52Mi5taW4uanMnKTsKICAgIHNlbGYuaW1wb3J0U2NyaXB0cygnaHR0cHM6Ly9kM2pzLm9yZy9kMy1xdWFkdHJlZS52Mi5taW4uanMnKTsKICAgIHNlbGYuaW1wb3J0U2NyaXB0cygnaHR0cHM6Ly9kM2pzLm9yZy9kMy10aW1lci52Mi5taW4uanMnKTsKICAgIHNlbGYuaW1wb3J0U2NyaXB0cygnaHR0cHM6Ly9kM2pzLm9yZy9kMy1mb3JjZS52Mi5taW4uanMnKTsgLy9zZWxmLmltcG9ydFNjcmlwdHMoJ2h0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9ucG0vZDMtZm9yY2UtcmV1c2VAMS4wLjEvYnVpbGQvZDMtZm9yY2UtcmV1c2UubWluLmpzJyk7CgogICAgc2VsZi5pbXBvcnRTY3JpcHRzKCdodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvbnBtL2QzLWZvcmNlLXNhbXBsZWRAMS4wLjAvYnVpbGQvZDMtZm9yY2Utc2FtcGxlZC5taW4uanMnKTsKCiAgICBvbm1lc3NhZ2UgPSBmdW5jdGlvbiBvbm1lc3NhZ2UoZXZlbnQpIHsKICAgICAgdmFyIF9ldmVudCRkYXRhID0gZXZlbnQuZGF0YSwKICAgICAgICAgIG5vZGVzID0gX2V2ZW50JGRhdGEubm9kZXMsCiAgICAgICAgICBsYXlvdXQgPSBfZXZlbnQkZGF0YS5sYXlvdXQsCiAgICAgICAgICBzdHJlbmd0aCA9IF9ldmVudCRkYXRhLnN0cmVuZ3RoLAogICAgICAgICAgb3JiaXRSYWRpdXMgPSBfZXZlbnQkZGF0YS5vcmJpdFJhZGl1cywKICAgICAgICAgIHggPSBfZXZlbnQkZGF0YS54LAogICAgICAgICAgeSA9IF9ldmVudCRkYXRhLnksCiAgICAgICAgICByYWRpdXMgPSBfZXZlbnQkZGF0YS5yYWRpdXMsCiAgICAgICAgICBjb2xvciA9IF9ldmVudCRkYXRhLmNvbG9yOwogICAgICB2YXIgc2ltdWxhdGlvbiA9IGQzLmZvcmNlU2ltdWxhdGlvbigpLm5vZGVzKG5vZGVzKTsKICAgICAgaWYgKGxheW91dCA9PT0gJ2NpcmN1bGFyJykgc2ltdWxhdGlvbi5mb3JjZSgnY29sbGlkZScsIGQzLmZvcmNlQ29sbGlkZSgpLnJhZGl1cyhyYWRpdXMgKyAwLjUpKSAvLyBjb2xsaXNpb24gZGV0ZWN0aW9uCiAgICAgIC8vLmZvcmNlKCdjaGFyZ2UnLCBkMy5mb3JjZU1hbnlCb2R5KCkuc3RyZW5ndGgoc3RyZW5ndGgpKSAvLyBjaGFyZ2UKICAgICAgLy8uZm9yY2UoJ2NoYXJnZScsIGQzLmZvcmNlTWFueUJvZHlSZXVzZSgpLnN0cmVuZ3RoKHN0cmVuZ3RoKSkgLy8gY2hhcmdlCiAgICAgIC5mb3JjZSgnY2hhcmdlJywgZDMuZm9yY2VNYW55Qm9keVNhbXBsZWQoKS5zdHJlbmd0aChzdHJlbmd0aCkpIC8vIGNoYXJnZQogICAgICAuZm9yY2UoJ3gnLCBkMy5mb3JjZVgoeCkuc3RyZW5ndGgoMC4zKSkuZm9yY2UoJ3knLCBkMy5mb3JjZVkoeSkuc3RyZW5ndGgoMC4zKSk7ZWxzZSBpZiAobGF5b3V0ID09PSAncmFkaWFsJykgc2ltdWxhdGlvbi5mb3JjZSgnY29sbGlkZScsIGQzLmZvcmNlQ29sbGlkZSgpLnJhZGl1cyhyYWRpdXMgKyAwLjUpKSAvLyBjb2xsaXNpb24gZGV0ZWN0aW9uCiAgICAgIC5mb3JjZSgncicsIGQzLmZvcmNlUmFkaWFsKG9yYml0UmFkaXVzIC8gMikpOyAvLyBwb3NpdGlvbmluZwogICAgICAvLyBzdG9wIHNpbXVsYXRpb24KCiAgICAgIHNpbXVsYXRpb24uc3RvcCgpOyAvLyBpbmNyZW1lbnQgc2ltdWxhdGlvbiBtYW51YWxseQoKICAgICAgZm9yICh2YXIgaSA9IDAsIG4gPSBNYXRoLmNlaWwoTWF0aC5sb2coc2ltdWxhdGlvbi5hbHBoYU1pbigpKSAvIE1hdGgubG9nKDEgLSBzaW11bGF0aW9uLmFscGhhRGVjYXkoKSkpOyBpIDwgbjsgKytpKSB7CiAgICAgICAgc2ltdWxhdGlvbi50aWNrKCk7CiAgICAgIH0gLy8gcmV0dXJuIHVwZGF0ZWQgbm9kZXMgYXJyYXkgdG8gYmUgZHJhd24gYW5kIHJlbmRlcmVkCgoKICAgICAgcG9zdE1lc3NhZ2UoewogICAgICAgIG5vZGVzOiBub2RlcywKICAgICAgICByYWRpdXM6IHJhZGl1cywKICAgICAgICBjb2xvcjogY29sb3IKICAgICAgfSk7CiAgICB9OwoKfSgpKTsKCg==",C="data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZm9yY2VTaW11bGF0aW9uV29ya2VyLmpzIiwic291cmNlcyI6WyJzcmMvaW5pdC9hZGRTdGF0aWNGb3JjZVNpbXVsYXRpb24vZm9yY2VTaW11bGF0aW9uV29ya2VyLmpzIl0sInNvdXJjZXNDb250ZW50IjpbInNlbGYuaW1wb3J0U2NyaXB0cygnaHR0cHM6Ly9kM2pzLm9yZy9kMy1kaXNwYXRjaC52Mi5taW4uanMnKTtcclxuc2VsZi5pbXBvcnRTY3JpcHRzKCdodHRwczovL2QzanMub3JnL2QzLXF1YWR0cmVlLnYyLm1pbi5qcycpO1xyXG5zZWxmLmltcG9ydFNjcmlwdHMoJ2h0dHBzOi8vZDNqcy5vcmcvZDMtdGltZXIudjIubWluLmpzJyk7XHJcbnNlbGYuaW1wb3J0U2NyaXB0cygnaHR0cHM6Ly9kM2pzLm9yZy9kMy1mb3JjZS52Mi5taW4uanMnKTtcclxuLy9zZWxmLmltcG9ydFNjcmlwdHMoJ2h0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9ucG0vZDMtZm9yY2UtcmV1c2VAMS4wLjEvYnVpbGQvZDMtZm9yY2UtcmV1c2UubWluLmpzJyk7XHJcbnNlbGYuaW1wb3J0U2NyaXB0cyhcclxuICAgICdodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvbnBtL2QzLWZvcmNlLXNhbXBsZWRAMS4wLjAvYnVpbGQvZDMtZm9yY2Utc2FtcGxlZC5taW4uanMnXHJcbik7XHJcblxyXG5vbm1lc3NhZ2UgPSBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgIGNvbnN0IHtcclxuICAgICAgICBub2RlcywgLy8gZGF0YVxyXG4gICAgICAgIGxheW91dCxcclxuICAgICAgICBzdHJlbmd0aCxcclxuICAgICAgICBvcmJpdFJhZGl1cywgLy8gZm9yY2Ugc2ltdWxhdGlvbiBzZXR0aW5nc1xyXG4gICAgICAgIHgsXHJcbiAgICAgICAgeSwgLy8gY29vcmRpbmF0ZXNcclxuICAgICAgICByYWRpdXMsXHJcbiAgICAgICAgY29sb3IsIC8vIGFlc3RoZXRpY3NcclxuICAgIH0gPSBldmVudC5kYXRhO1xyXG5cclxuICAgIGNvbnN0IHNpbXVsYXRpb24gPSBkMy5mb3JjZVNpbXVsYXRpb24oKS5ub2Rlcyhub2Rlcyk7XHJcblxyXG4gICAgaWYgKGxheW91dCA9PT0gJ2NpcmN1bGFyJylcclxuICAgICAgICBzaW11bGF0aW9uXHJcbiAgICAgICAgICAgIC5mb3JjZSgnY29sbGlkZScsIGQzLmZvcmNlQ29sbGlkZSgpLnJhZGl1cyhyYWRpdXMgKyAwLjUpKSAvLyBjb2xsaXNpb24gZGV0ZWN0aW9uXHJcbiAgICAgICAgICAgIC8vLmZvcmNlKCdjaGFyZ2UnLCBkMy5mb3JjZU1hbnlCb2R5KCkuc3RyZW5ndGgoc3RyZW5ndGgpKSAvLyBjaGFyZ2VcclxuICAgICAgICAgICAgLy8uZm9yY2UoJ2NoYXJnZScsIGQzLmZvcmNlTWFueUJvZHlSZXVzZSgpLnN0cmVuZ3RoKHN0cmVuZ3RoKSkgLy8gY2hhcmdlXHJcbiAgICAgICAgICAgIC5mb3JjZSgnY2hhcmdlJywgZDMuZm9yY2VNYW55Qm9keVNhbXBsZWQoKS5zdHJlbmd0aChzdHJlbmd0aCkpIC8vIGNoYXJnZVxyXG4gICAgICAgICAgICAuZm9yY2UoJ3gnLCBkMy5mb3JjZVgoeCkuc3RyZW5ndGgoMC4zKSlcclxuICAgICAgICAgICAgLmZvcmNlKCd5JywgZDMuZm9yY2VZKHkpLnN0cmVuZ3RoKDAuMykpO1xyXG4gICAgZWxzZSBpZiAobGF5b3V0ID09PSAncmFkaWFsJylcclxuICAgICAgICBzaW11bGF0aW9uXHJcbiAgICAgICAgICAgIC5mb3JjZSgnY29sbGlkZScsIGQzLmZvcmNlQ29sbGlkZSgpLnJhZGl1cyhyYWRpdXMgKyAwLjUpKSAvLyBjb2xsaXNpb24gZGV0ZWN0aW9uXHJcbiAgICAgICAgICAgIC5mb3JjZSgncicsIGQzLmZvcmNlUmFkaWFsKG9yYml0UmFkaXVzIC8gMikpOyAvLyBwb3NpdGlvbmluZ1xyXG5cclxuICAgIC8vIHN0b3Agc2ltdWxhdGlvblxyXG4gICAgc2ltdWxhdGlvbi5zdG9wKCk7XHJcblxyXG4gICAgLy8gaW5jcmVtZW50IHNpbXVsYXRpb24gbWFudWFsbHlcclxuICAgIGZvciAoXHJcbiAgICAgICAgdmFyIGkgPSAwLFxyXG4gICAgICAgICAgICBuID0gTWF0aC5jZWlsKE1hdGgubG9nKHNpbXVsYXRpb24uYWxwaGFNaW4oKSkgLyBNYXRoLmxvZygxIC0gc2ltdWxhdGlvbi5hbHBoYURlY2F5KCkpKTtcclxuICAgICAgICBpIDwgbjtcclxuICAgICAgICArK2lcclxuICAgICkge1xyXG4gICAgICAgIHNpbXVsYXRpb24udGljaygpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIHJldHVybiB1cGRhdGVkIG5vZGVzIGFycmF5IHRvIGJlIGRyYXduIGFuZCByZW5kZXJlZFxyXG4gICAgcG9zdE1lc3NhZ2UoeyBub2RlcywgcmFkaXVzLCBjb2xvciB9KTtcclxufTtcclxuIl0sIm5hbWVzIjpbInNlbGYiLCJpbXBvcnRTY3JpcHRzIiwib25tZXNzYWdlIiwiZXZlbnQiLCJkYXRhIiwibm9kZXMiLCJsYXlvdXQiLCJzdHJlbmd0aCIsIm9yYml0UmFkaXVzIiwieCIsInkiLCJyYWRpdXMiLCJjb2xvciIsInNpbXVsYXRpb24iLCJkMyIsImZvcmNlU2ltdWxhdGlvbiIsImZvcmNlIiwiZm9yY2VDb2xsaWRlIiwiZm9yY2VNYW55Qm9keVNhbXBsZWQiLCJmb3JjZVgiLCJmb3JjZVkiLCJmb3JjZVJhZGlhbCIsInN0b3AiLCJpIiwibiIsIk1hdGgiLCJjZWlsIiwibG9nIiwiYWxwaGFNaW4iLCJhbHBoYURlY2F5IiwidGljayIsInBvc3RNZXNzYWdlIl0sIm1hcHBpbmdzIjoiOzs7SUFBQUEsSUFBSSxDQUFDQyxhQUFMLENBQW1CLHdDQUFuQjtJQUNBRCxJQUFJLENBQUNDLGFBQUwsQ0FBbUIsd0NBQW5CO0lBQ0FELElBQUksQ0FBQ0MsYUFBTCxDQUFtQixxQ0FBbkI7SUFDQUQsSUFBSSxDQUFDQyxhQUFMLENBQW1CLHFDQUFuQjs7SUFFQUQsSUFBSSxDQUFDQyxhQUFMLENBQ0ksbUZBREo7O0lBSUFDLFNBQVMsR0FBRyxtQkFBVUMsS0FBVixFQUFpQjtJQUFBLG9CQVVyQkEsS0FBSyxDQUFDQyxJQVZlO0lBQUEsTUFFckJDLEtBRnFCLGVBRXJCQSxLQUZxQjtJQUFBLE1BR3JCQyxNQUhxQixlQUdyQkEsTUFIcUI7SUFBQSxNQUlyQkMsUUFKcUIsZUFJckJBLFFBSnFCO0lBQUEsTUFLckJDLFdBTHFCLGVBS3JCQSxXQUxxQjtJQUFBLE1BTXJCQyxDQU5xQixlQU1yQkEsQ0FOcUI7SUFBQSxNQU9yQkMsQ0FQcUIsZUFPckJBLENBUHFCO0lBQUEsTUFRckJDLE1BUnFCLGVBUXJCQSxNQVJxQjtJQUFBLE1BU3JCQyxLQVRxQixlQVNyQkEsS0FUcUI7SUFZekIsTUFBTUMsVUFBVSxHQUFHQyxFQUFFLENBQUNDLGVBQUgsR0FBcUJWLEtBQXJCLENBQTJCQSxLQUEzQixDQUFuQjtJQUVBLE1BQUlDLE1BQU0sS0FBSyxVQUFmLEVBQ0lPLFVBQVUsQ0FDTEcsS0FETCxDQUNXLFNBRFgsRUFDc0JGLEVBQUUsQ0FBQ0csWUFBSCxHQUFrQk4sTUFBbEIsQ0FBeUJBLE1BQU0sR0FBRyxHQUFsQyxDQUR0QjtJQUVJO0lBQ0E7SUFISixHQUlLSyxLQUpMLENBSVcsUUFKWCxFQUlxQkYsRUFBRSxDQUFDSSxvQkFBSCxHQUEwQlgsUUFBMUIsQ0FBbUNBLFFBQW5DLENBSnJCO0lBQUEsR0FLS1MsS0FMTCxDQUtXLEdBTFgsRUFLZ0JGLEVBQUUsQ0FBQ0ssTUFBSCxDQUFVVixDQUFWLEVBQWFGLFFBQWIsQ0FBc0IsR0FBdEIsQ0FMaEIsRUFNS1MsS0FOTCxDQU1XLEdBTlgsRUFNZ0JGLEVBQUUsQ0FBQ00sTUFBSCxDQUFVVixDQUFWLEVBQWFILFFBQWIsQ0FBc0IsR0FBdEIsQ0FOaEIsRUFESixLQVFLLElBQUlELE1BQU0sS0FBSyxRQUFmLEVBQ0RPLFVBQVUsQ0FDTEcsS0FETCxDQUNXLFNBRFgsRUFDc0JGLEVBQUUsQ0FBQ0csWUFBSCxHQUFrQk4sTUFBbEIsQ0FBeUJBLE1BQU0sR0FBRyxHQUFsQyxDQUR0QjtJQUFBLEdBRUtLLEtBRkwsQ0FFVyxHQUZYLEVBRWdCRixFQUFFLENBQUNPLFdBQUgsQ0FBZWIsV0FBVyxHQUFHLENBQTdCLENBRmhCLEVBdkJxQjtJQTJCekI7O0lBQ0FLLEVBQUFBLFVBQVUsQ0FBQ1MsSUFBWCxHQTVCeUI7O0lBK0J6QixPQUNJLElBQUlDLENBQUMsR0FBRyxDQUFSLEVBQ0lDLENBQUMsR0FBR0MsSUFBSSxDQUFDQyxJQUFMLENBQVVELElBQUksQ0FBQ0UsR0FBTCxDQUFTZCxVQUFVLENBQUNlLFFBQVgsRUFBVCxJQUFrQ0gsSUFBSSxDQUFDRSxHQUFMLENBQVMsSUFBSWQsVUFBVSxDQUFDZ0IsVUFBWCxFQUFiLENBQTVDLENBRlosRUFHSU4sQ0FBQyxHQUFHQyxDQUhSLEVBSUksRUFBRUQsQ0FKTixFQUtFO0lBQ0VWLElBQUFBLFVBQVUsQ0FBQ2lCLElBQVg7SUFDSCxHQXRDd0I7OztJQXlDekJDLEVBQUFBLFdBQVcsQ0FBQztJQUFFMUIsSUFBQUEsS0FBSyxFQUFMQSxLQUFGO0lBQVNNLElBQUFBLE1BQU0sRUFBTkEsTUFBVDtJQUFpQkMsSUFBQUEsS0FBSyxFQUFMQTtJQUFqQixHQUFELENBQVg7SUFDSCxDQTFDRDs7Ozs7OyJ9",x=!1,function(t){return I=I||m(b,C,x),new Worker(I,t)});function Q(t,n,e,i){var s=new B;return s.postMessage({nodes:t,layout:this.settings.staticLayout,strength:this.settings.chargeStrength,orbitRadius:this.settings.orbitRadius,x:n,y:e,radius:this.settings.minRadius,color:i}),s}function F(t,n){var e=this;t.onmessage=function(t){var n="fdg-static--".concat(t.data.color.replace(/[^0-9_a-z]/gi,"-"));e.containers.svgBackground.selectAll(".".concat(n)).remove();var i=e.containers.svgBackground.insert("g",":first-child").classed("fdg-static ".concat(n),!0);"radial"==e.settings.staticLayout&&i.attr("transform","translate(".concat(e.settings.orbitRadius/2,",").concat(e.settings.height/2,")"));var s=i.selectAll(".fdg-static__mark").data(t.data.nodes).join("circle"===e.settings.shape?"circle":"rect").classed("fdg-static__mark",!0).attr("fill",t.data.color).attr("fill-opacity",.25);"circle"===e.settings.shape?s.attr("cx",(function(t){return t.x})).attr("cy",(function(t){return t.y})).attr("r",t.data.radius):s.attr("x",(function(n){return n.x-t.data.radius})).attr("y",(function(n){return n.y-t.data.radius})).attr("width",2*t.data.radius).attr("height",2*t.data.radius)}}function U(){var t=this;if(this.settings.drawStaticSeparately){this.containers.svgBackground.selectAll(".fdg-static").remove();var n=this.data.nested.filter((function(t){return t.value.noStateChange})).map((function(t){return{key:t.key,category:t.value.category}}));if("categorical"===this.settings.colorBy.type)this.metadata.event[0].foci.forEach((function(e){var i=n.filter((function(t){return t.category===e.key})),s=Q.call(t,i,e.x,e.y,t.colorScale(e.key));F.call(t,s)}));else{var e=Q.call(this,n,this.settings.orbitRadius/2,this.settings.height/2,this.colorScale(0));F.call(this,e)}}}function A(t,n){var e=this;return void 0!==n?t[n]:t.find((function(n,i){return n.start_timepoint<=e.settings.timepoint&&e.settings.timepoint<=n.end_timepoint||i===t.length-1}))}function L(t){var n=this;return t.filter((function(t){return t.start_timepoint<=n.settings.timepoint})).sort((function(t,n){return t.start_timepoint-n.start_timepoint})).filter((function(t,e,i){var s=i[e-1]?i[e-1].event:null;return!n.settings.eventChangeCount.includes(s)&&n.settings.eventChangeCount.includes(t.event)})).length}function S(t){return"color"!==this.settings.eventChangeCountAesthetic?Math.min(this.settings.minRadius+t,this.settings.maxRadius):this.settings.minRadius}function k(t){var n="frequency"!==this.settings.colorBy.type||"size"!==this.settings.eventChangeCountAesthetic?d3.rgb(this.colorScale(t)).toString():"rgb(170,170,170)",e=n.replace("rgb","rgba").replace(")",", 0.5)"),i=n.replace("rgb","rgba").replace(")",", 1)");return{color:n,fill:e,stroke:i}}function Z(t,n,e){var i=L.call(this,t,e),s="frequency"===this.settings.colorBy.type?i:n[this.settings.colorBy.variable];return r({nStateChanges:i,aesthetic:s,r:S.call(this,i)},k.call(this,s))}function w(){var t=this;this.metadata.event.forEach((function(t){t.prevCount=t.count})),this.data.nested.forEach((function(n){n.value.statePrevious=n.value.state;var e=t.metadata.event.find((function(t){return t.value===n.value.state.event}));n.value.coordinates={x:e.x,y:e.y},n.value.distance=Math.sqrt(Math.pow(e.x-n.x,2)+Math.pow(e.y-n.y,2)),n.value.distance<t.settings.orbitRadius/4&&(n.value.state=A.call(t,n.value.group));var i=Z.call(t,n.value.group,n.value.state,n.value.statePrevious);Object.assign(n.value,i)})),this.metadata.event.forEach((function(n){n.data=t.data.nested.filter((function(t,e){return t.value.state.event===n.value})),n.count=n.data.length,n.cumulative=t.data.filter((function(e){return e.event===n.value&&e.start_timepoint<=t.settings.timepoint})).length,n.change=n.count-n.prevCount}))}function R(){var t=this.containers.animation.node();this.settings.width=t.clientWidth,this.settings.height=this.containers.animation.node().clientHeight,this.containers.stopwatch.width=this.containers.stopwatch.node().clientWidth,this.containers.stopwatch.innerRadius=this.containers.stopwatch.width/8,this.containers.stopwatch.svg.attr("width",this.containers.stopwatch.width).attr("height",this.containers.stopwatch.width),this.containers.stopwatch.arc.innerRadius(this.containers.stopwatch.innerRadius).outerRadius(this.containers.stopwatch.width/2-1),this.containers.stopwatch.g.attr("transform","translate(".concat(this.containers.stopwatch.width/2,",").concat(this.containers.stopwatch.width/2,")")),this.containers.stopwatch.background.attr("d",this.containers.stopwatch.arc),this.containers.stopwatch.foreground.attr("d",this.containers.stopwatch.arc),this.containers.svgBackground.attr("width",this.settings.width).attr("height",this.settings.height),this.containers.canvas.attr("width",this.settings.width).attr("height",this.settings.height),this.containers.svgForeground.attr("width",this.settings.width).attr("height",this.settings.height),y.call(this,this.metadata),this.orbits.attr("cx",(function(t){return t.cx})).attr("cy",(function(t){return t.cy})).attr("r",(function(t){return t.r})),w.call(this),this.forceSimulation.force("x",d3.forceX().x((function(t){return t.value.coordinates.x})).strength(.3)).force("y",d3.forceY().y((function(t){return t.value.coordinates.y})).strength(.3)),U.call(this),this.focusAnnotations.attr("transform",(function(t){return"translate(".concat(t.x,",").concat(t.y,")")}))}function G(){var t=d("main",d3.select(this.element)),n=g.call(this,t),e=p.call(this,t),i=v.call(this,t);return window.addEventListener("resize",R.bind(this)),r(r(r({main:t},n),e),i)}function J(){var t=this,n=d3.nest().key((function(t){return t.id})).rollup((function(n){return{duration:d3.sum(n,(function(t){return+t.duration})),static:1===n.length,category:"categorical"===t.settings.colorBy.type?n[0][t.settings.colorBy.variable]:null}})).entries(this.data);return n.forEach((function(t,n){Object.assign(t,t.value),t.value=t.key,t.duration=t.value,delete t.key})),n}function V(){var t=d3.nest().key((function(t){return t.event})).rollup((function(t){var n=t[0];return{order:parseInt(n.event_order),position:n.hasOwnProperty("event_position")?parseInt(n.event_position):null,count:0,prevCount:0,cumulative:0,nEvents:t.length}})).entries(this.data);return t.forEach((function(t){Object.assign(t,t.value),t.value=t.key,delete t.key})),d3.nest().key((function(t){return t.order})).rollup((function(t){var n=t.length,e=d3.range(-45,46);t.forEach((function(t,i){t.position=null===t.position?d3.quantile(e,(i+1)/(n+1)):t.position}))})).entries(t),t.sort((function(t,n){return t.order-n.order||n.nEvents-t.nEvents})),t}function W(t){var n=this;return d3.nest().key((function(t){return t.order})).entries(t.filter((function(t){return t.value!==n.settings.eventCentral})))}function X(){var t=this,n={};n.id=J.call(this),this.settings.duration=this.settings.duration||d3.max(n.id,(function(t){return t.duration})),this.settings.text=this.settings.text.filter((function(e){return!(/static/i.test(e)&&(n.id.every((function(t){return!1===t.static}))||!1===t.settings.drawStaticSeparately))})).map((function(n){return n.replace("[duration]",d3.format(",d")(t.settings.duration))})),this.settings.minRadius=this.settings.minRadius||3e3/n.id.filter((function(n){return!(t.settings.drawStaticSeparately&&n.static)})).length,this.settings.staticRadius=this.settings.staticRadius||3e3/n.id.length,this.settings.maxRadius=this.settings.maxRadius||this.settings.minRadius+this.settings.colors().length,this.settings.chargeStrength=-2e3/n.id.filter((function(n){return!(t.settings.drawStaticSeparately&&n.static)})).length,this.settings.staticChargeStrength=-2e3/n.id.length,this.settings.fill=this.settings.fill||n.id.length<=2500,n.event=V.call(this),this.settings.eventCentral=this.settings.eventCentral||n.event[0].value,this.settings.nFoci=this.settings.nFoci||n.event.length-!!this.settings.eventCentral,this.settings.eventChangeCount=this.settings.eventChangeCount||n.event.slice(1).map((function(t){return t.value})),n.orbit=W.call(this,n.event),y.call(this,n);var e,i=this.settings.colors();if("frequency"===this.settings.colorBy.type)e=d3.range(i.length),this.colorScale=d3.scaleLinear().domain(e).range(i).clamp(!0);else if("continuous"===this.settings.colorBy.type){e=d3.extent(this.data,(function(n){return n[t.settings.colorBy.variable]})),this.colorScale=d3.scaleSequential(d3.interpolateRdYlGn).domain(e);var s=this.colorScale.interpolator();this.settings.colorBy.mirror&&this.colorScale.interpolator((function(t){return s(1-t)}))}else"categorical"===this.settings.colorBy.type&&(e=o(new Set(this.data.map((function(n){return n[t.settings.colorBy.variable]}))).values()).sort(),this.colorScale=d3.scaleOrdinal().domain(e).range(d3.schemeTableau10),this.settings.colorBy.theta=2*Math.PI/e.length,n.event.forEach((function(n){n.foci=e.map((function(e,i){return{key:e,x:n.x+50*Math.cos(i*t.settings.colorBy.theta),y:n.y+50*Math.sin(i*t.settings.colorBy.theta)}}))})));return this.domain=e,n}function M(){var t=this;this.settings.pulseOrbits&&this.orbits.each((function(n){n.change=d3.sum(n.values,(function(t){return t.change})),n.change>0&&d3.select(this).transition().duration(t.settings.speeds[t.settings.speed]/2).attr("stroke-width",.5*n.change).transition().duration(t.settings.speeds[t.settings.speed]/2).attr("stroke-width",.5)}))}function N(){var t=this;this.settings.progress=this.settings.timepoint/this.settings.duration,this.controls.timepoint.inputs.property("value",this.settings.timepoint),this.containers.timer.text("".concat(this.settings.timepoint," ").concat(this.settings.timeUnit)),this.containers.progress.attr("title","The animation is ".concat(d3.format(".1%")(this.settings.progress)," complete with ").concat(this.settings.duration-this.settings.timepoint," ").concat(this.settings.timeUnit.split(" ")[0]," to go.")),this.containers.stopwatch.foreground.transition().duration(this.settings.speed).attrTween("d",this.util.arcTween(this.settings.progress*Math.PI*2,this.containers.stopwatch.arc)).style("fill",d3.interpolateRdYlGn(1-this.settings.progress)),this.containers.stopwatch.percentBackground.text(this.settings.progress<.0095?d3.format(".1%")(this.settings.progress):d3.format(".0%")(this.settings.progress)),this.containers.stopwatch.percentForeground.text(this.settings.progress<.0095?d3.format(".1%")(this.settings.progress):d3.format(".0%")(this.settings.progress)),this.settings.eventCount&&this.focusAnnotations.selectAll("tspan.fdg-focus-annotation__event-count").text((function(n){return"".concat(n.count," (").concat(d3.format(".1%")(n.count/t.data.nested.length),")")})),this.freqTable.tr.selectAll("td").data((function(t){return[t.value,t.cumulative]})).join("td").text((function(t){return"number"==typeof t?d3.format(",d")(t):t}))}function Y(){w.call(this),M.call(this),N.call(this)}function E(){1===this.settings.timepoint&&this.forceSimulation.force("center",null),this.forceSimulation.alpha(1).force("x",d3.forceX().x((function(t){return t.value.coordinates.x})).strength(.3)).force("y",d3.forceY().y((function(t){return t.value.coordinates.y})).strength(.3)).restart()}function j(){var t=this,n=this.settings.resetDelay/1e3-1;return this.containers.countdown.classed("fdg-invisible",!1).classed("fdg-hidden",(function(t){return t!==n})),window.setInterval((function(){n--,t.containers.countdown.classed("fdg-hidden",(function(t){return t!==n}))}),1e3)}function z(t){d3.select(this).transition().duration(t/15).delay(t-t/15*2).style("opacity",0)}function H(t,n){t.style("opacity",0).transition().duration(n/15).style("opacity",1).on("end",(function(){z.call(this,n)}))}function D(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"outline",e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"thick groove rgba(215,25,28,0)",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"thick groove rgba(215,25,28,.5)";t.style(n,e).transition().duration(this.settings.modalSpeed/15).style(n,i).transition().duration(this.settings.modalSpeed/15).delay(this.settings.modalSpeed-this.settings.modalSpeed/15*2).style(n,e).on("end",(function(){return t.style(n,null)}))}function _(){switch(this.modalText=this.settings.text[this.settings.modalIndex],this.settings.modalIndex===this.settings.text.length-1&&this.modal.stop(),this.containers.modal.html(this.modalText).call(H,this.settings.modalSpeed),!0){case/time/i.test(this.modalText):D.call(this,this.containers.progress);break;case/color/i.test(this.modalText):D.call(this,this.containers.legends);break;case/static/i.test(this.modalText):D.call(this,this.containers.svgBackground.selectAll("circle.fdg-static__circle"),"stroke","rgba(215,25,28,0)","rgba(215,25,28,.5)");break;case/controls/i.test(this.modalText):D.call(this,this.containers.controls)}}function T(){var t=this;_.call(this),this.modal=d3.interval((function(){t.settings.modalIndex++,_.call(t)}),this.settings.modalSpeed)}function K(){var t=this;this.settings.timepoint=0,this.settings.modalIndex=0,this.controls.timepoint.inputs.attr("value",0),this.metadata.event.forEach((function(t){t.prevCount=0,t.count=0,t.cumulative=0})),this.data.nested.forEach((function(n){n.value.statePrevious=null,n.value.state=A.call(t,n.value.group,0);var e=Z.call(t,n.value.group,n.value.state,n.value.statePrevious);Object.assign(n.value,e)})),this.modal&&this.modal.stop(),T.call(this)}function O(t){var n=this,e=window.setTimeout((function(){K.call(n),n.containers.timer.text("".concat(n.settings.timepoint," ").concat(n.settings.timeUnit)),n.settings.progress=0,n.containers.stopwatch.foreground.transition().duration(n.settings.speed).attrTween("d",n.util.arcTween(n.settings.progress*Math.PI*2,n.containers.stopwatch.arc)).style("fill",d3.interpolateRdYlGn(1-n.settings.progress)),window.clearInterval(t),window.clearTimeout(e),n.containers.countdown.classed("fdg-invisible",(function(t){return t===n.settings.resetDelay/1e3-1})).classed("fdg-hidden",(function(t){return t!==n.settings.resetDelay/1e3-1})),n.interval=$.call(n)}),this.settings.resetDelay);return e}function P(){this.interval.stop(),E.call(this);var t=j.call(this);O.call(this,t)}var q=function(t){this.settings.timepoint+=!!t,this.settings.timepoint<=this.settings.duration?Y.call(this):!0===this.settings.loop&&P.call(this),E.call(this)};function $(){return d3.interval(q.bind(this),this.settings.speeds[this.settings.speed])}var tt=[{action:"play",label:"Play",html:"&#9658;"},{action:"pause",label:"Pause",html:"&#10074;&#10074;"}];function nt(){var t=this;this.settings.playPause=tt.find((function(n){return n.action!==t.settings.playPause})).action,this.controls.playPause.inputs.attr("title","".concat(tt.find((function(n){return n.action!==t.settings.playPause})).label," animation")).html(tt.find((function(n){return n.action!==t.settings.playPause})).html),"play"===this.settings.playPause?this.interval=$.call(this):this.interval.stop()}function et(){var t=this,n=this,e=this.controls.container.append("div").classed("fdg-control fdg-control--speed",!0),i=e.selectAll("div").data(Object.keys(this.settings.speeds).map((function(n){return{label:n,value:t.settings.speeds[n]}}))).enter().append("div").attr("class",(function(n){return"fdg-button ".concat(n.label," ").concat(n.label===t.settings.speed?"current":"")})).attr("title",(function(n){return"Advance the animation every ".concat(t.settings.speeds[n.label]/1e3," second(s).")})).text((function(t){return t.label}));return i.on("click",(function(t){n.settings.speed=t.label,i.classed("current",(function(n){return n.label===t.label})),"play"===n.settings.playPause&&(n.interval.stop(),n.interval=$.call(n))})),{container:e,inputs:i}}function it(){var t=this,n=this.controls.container.append("div").classed("fdg-control fdg-control--play-pause",!0),e=n.append("div").classed("fdg-button fdg-input",!0).attr("title","".concat(tt.find((function(n){return n.action!==t.settings.playPause})).label," animation.")).html(tt.find((function(n){return n.action!==t.settings.playPause})).html);return e.on("click",(function(){nt.call(t)})),{container:n,inputs:e}}function st(){var t=this,n=this.controls.container.append("div").classed("fdg-control fdg-control--step",!0),e=n.append("div").classed("fdg-button fdg-input",!0).attr("title","Advance animation by one time unit.").text("Step");return e.on("click",(function(){"pause"!==t.settings.playPause&&nt.call(t),q.call(t,!0)})),{container:n,inputs:e}}function at(){var t=this,n=this,e=this.controls.container.append("div").classed("fdg-control fdg-control--timepoint",!0),i=e.append("div").classed("fdg-button fdg-input",!0).append("input").attr("type","number").attr("title","Choose a timepoint.").attr("value",+this.settings.timepoint).attr("min",1).attr("max",this.settings.duration);return i.on("click",(function(){"pause"!==t.settings.playPause&&nt.call(t)})),i.on("change",(function(){"pause"!==n.settings.playPause&&nt.call(n),n.settings.timepoint=+this.value-1,q.call(n,!0)})),{container:e,inputs:i}}function rt(){var t=this,n=this.controls.container.append("div").classed("fdg-control fdg-control--reset",!0),e=n.append("div").classed("fdg-button fdg-input",!0).attr("title","Reset animation.").html("&#x21ba;");return e.on("click",(function(){K.call(t),"play"!==t.settings.playPause&&nt.call(t)})),{container:n,inputs:e}}function ot(){var t=this,n=this,e=this.controls.container.append("div").classed("fdg-control fdg-control--event-list",!0),i=e.selectAll("div").data(this.metadata.event).enter().append("div").attr("class",(function(n){return"fdg-button ".concat(t.settings.eventChangeCount.includes(n.value)?"current":"")})).attr("title",(function(n){return"".concat(t.settings.eventChangeCount.includes(n.value)?"Remove":"Add"," ").concat(n.value," ").concat(t.settings.eventChangeCount.includes(n.value)?"from":"to"," the list of events that control bubble ").concat("both"===t.settings.eventChangeCountAesthetic?"color and size":t.settings.eventChangeCountAesthetic,".")})).text((function(t){return t.value}));return i.on("click",(function(t){var e=this;this.classList.toggle("current"),n.settings.eventChangeCount.includes(this.textContent)?n.settings.eventChangeCount.splice(n.settings.eventChangeCount.findIndex((function(t){return t===e.textContent})),1):n.settings.eventChangeCount.push(this.textContent),this.title="".concat(n.settings.eventChangeCount.includes(t.value)?"Remove":"Add"," ").concat(t.value," ").concat(n.settings.eventChangeCount.includes(t.value)?"from":"to"," the list of events that control bubble ").concat("both"===n.settings.eventChangeCountAesthetic?"color and size":n.settings.eventChangeCountAesthetic,"."),n.controls.colorSizeToggle.inputs.attr("title",(function(t){return"Quantify the number of ".concat(n.util.csv(n.settings.eventChangeCount)," events by ").concat("both"!==t?t:"color and size",".")})),n.legends.container.classed("fdg-invisible",0===n.settings.eventChangeCount.length).selectAll("span.fdg-measure").text(n.util.csv(n.settings.eventChangeCount)),q.call(n,!1)})),{container:e,inputs:i}}function ct(){var t=this,n=this,e=this.controls.container.append("div").classed("fdg-control fdg-control--color-size",!0),i=e.selectAll("div").data(["color","size","both"]).enter().append("div").attr("class",(function(n){return"fdg-button ".concat(n," ").concat(n===t.settings.eventChangeCountAesthetic?"current":"")})).attr("title",(function(e){return"Quantify the number of ".concat(n.util.csv(t.settings.eventChangeCount)," events by ").concat("both"!==e?e:"color and size")})).text((function(t){return t}));return i.on("click",(function(t){i.classed("current",(function(n){return n===t})),n.settings.eventChangeCountAesthetic=t,n.controls.eventList.inputs.attr("title",(function(t){return"".concat(n.settings.eventChangeCount.includes(t.value)?"Remove":"Add"," ").concat(t.value," ").concat(n.settings.eventChangeCount.includes(t.value)?"from":"to"," the list of events that control bubble ").concat("both"===n.settings.eventChangeCountAesthetic?"color and size":n.settings.eventChangeCountAesthetic,".")})),n.legends.container.selectAll(".fdg-legend").classed("fdg-hidden",(function(){return!Array.from(this.classList).some((function(n){return n.includes(t)}))})),q.call(n,!1)})),{container:e,inputs:i}}function lt(){this.controls={container:this.containers.controls},this.controls.speed=et.call(this),this.controls.playPause=it.call(this),this.controls.step=st.call(this),this.controls.timepoint=at.call(this),this.controls.reset=rt.call(this),"frequency"===this.settings.colorBy.type&&(this.controls.eventList=ot.call(this),this.controls.colorSizeToggle=ct.call(this)),this.controls.container.selectAll(".fdg-button").on("mousedown",(function(){this.classList.toggle("clicked")})).on("mouseup",(function(){this.classList.toggle("clicked")})).on("mouseout",(function(){this.classList.contains("clicked")&&this.classList.toggle("clicked")}))}function ut(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:256,e=document.createElement("canvas");e.width=n,e.height=1;for(var i=e.getContext("2d"),s=0;s<n;++s)i.fillStyle=t(s/(n-1)),i.fillRect(s,0,1,1);return e}var dt={color:function(t,n){var e=this;return t.selectAll("rect.legend-mark").data(this.settings.colors()).enter().append("rect").classed("legend-mark",!0).attr("x",(function(t,i){return i*(n[0]/e.settings.colors().length)})).attr("y",0).attr("width",n[0]/this.settings.colors().length).attr("height",n[1]/3).attr("fill",(function(t){return t})).attr("fill-opacity",.5).attr("stroke",(function(t){return t})).attr("stroke-opacity",1)},size:function(t,n){var e=this,i=t.selectAll("circle.legend-mark").data(this.settings.colors()).join("circle"===this.settings.shape?"circle":"rect").classed("legend-mark",!0).attr("fill",(function(t){return"#aaa"})).attr("fill-opacity",.5).attr("stroke",(function(t){return"#aaa"})).attr("stroke-opacity",1);return"circle"===this.settings.shape?i.attr("cx",(function(t,i){return i*(n[0]/e.settings.colors().length)+n[0]/e.settings.colors().length/2})).attr("cy",n[1]/4).attr("r",(function(t,n){return n+e.settings.minRadius})):i.attr("x",(function(t,i){return i*(n[0]/e.settings.colors().length)+n[0]/e.settings.colors().length/2-(i+e.settings.minRadius)})).attr("y",(function(t,i){return n[1]/4-(i+e.settings.minRadius)})).attr("width",(function(t,n){return 2*(n+e.settings.minRadius)})).attr("height",(function(t,n){return 2*(n+e.settings.minRadius)})),i},both:function(t,n){var e=this,i=t.selectAll("circle.legend-mark").data(this.settings.colors()).join("circle"===this.settings.shape?"circle":"rect").classed("legend-mark",!0).attr("fill",(function(t){return t})).attr("fill-opacity",.5).attr("stroke",(function(t){return t})).attr("stroke-opacity",1);return"circle"===this.settings.shape?i.attr("cx",(function(t,i){return i*(n[0]/e.settings.colors().length)+n[0]/e.settings.colors().length/2})).attr("cy",n[1]/4).attr("r",(function(t,n){return n+e.settings.minRadius})):i.attr("x",(function(t,i){return i*(n[0]/e.settings.colors().length)+n[0]/e.settings.colors().length/2-(i+e.settings.minRadius)})).attr("y",(function(t,i){return n[1]/4-(i+e.settings.minRadius)})).attr("width",(function(t,n){return 2*(n+e.settings.minRadius)})).attr("height",(function(t,n){return 2*(n+e.settings.minRadius)})),i}};function gt(t){var n=[200,50],e=this.legends.container.append("div").classed("fdg-legend fdg-legend--".concat(t),!0).classed("fdg-hidden",this.settings.eventChangeCountAesthetic!==t||0===this.settings.eventChangeCount.length),i=e.append("div").classed("fdg-sidebar__label fdg-legend__label",!0).html('Number of <span class = "fdg-measure">'.concat(this.util.csv(this.settings.eventChangeCount),"</span> events")),s=e.append("svg").attr("width",n[0]).attr("height",n[1]).append("g"),a=dt[t].call(this,s,n),r=s.append("text").attr("x",n[0]/this.settings.colors().length/2).attr("y",n[1]/2+16).attr("text-anchor","middle").text("0"),o=s.append("text").attr("x",n[0]-n[0]/this.settings.colors().length/2).attr("y",n[1]/2+16).attr("text-anchor","middle").text("".concat(this.settings.colors().length-1,"+"));return{container:e,label:i,svg:s,marks:a,lower:r,upper:o}}function ht(){var t=this;if(this.legends={container:this.containers.legends},"continuous"===this.settings.colorBy.type)this.legends.container.append("div").classed("fdg-legend fdg-legend--continuous",!0).node().appendChild(function(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=n.color,i=n.title,s=n.tickSize,a=void 0===s?6:s,r=n.width,o=void 0===r?320:r,c=n.height,l=void 0===c?44+a:c,u=n.marginTop,d=void 0===u?18:u,g=n.marginRight,h=void 0===g?0:g,f=n.marginBottom,p=void 0===f?16+a:f,v=n.marginLeft,y=void 0===v?0:v,m=n.ticks,b=void 0===m?o/64:m,C=n.tickFormat,x=n.tickValues,I=d3.create("svg").attr("width",o).attr("height",l).attr("viewBox",[0,0,o,l]).style("overflow","visible"),B=function(t){return t.selectAll(".tick line").attr("y1",d+p-l)};if(e.interpolate){var Q=Math.min(e.domain().length,e.range().length);t=e.copy().rangeRound(d3.quantize(d3.interpolate(y,o-h),Q)),I.append("image").attr("x",y).attr("y",d).attr("width",o-y-h).attr("height",l-d-p).attr("preserveAspectRatio","none").attr("xlink:href",ut.call(this,e.copy().domain(d3.quantize(d3.interpolate(0,1),Q))).toDataURL())}else if(e.interpolator){if(t=Object.assign(e.copy().interpolator(d3.interpolateRound(y,o-h)),{range:function(){return[y,o-h]}}),I.append("image").attr("x",y).attr("y",d).attr("width",o-y-h).attr("height",l-d-p).attr("preserveAspectRatio","none").attr("xlink:href",ut.call(this,e.interpolator()).toDataURL()),!t.ticks){if(void 0===x){var F=Math.round(b+1);x=d3.range(F).map((function(t){return d3.quantile(e.domain(),t/(F-1))}))}"function"!=typeof C&&(C=d3.format(void 0===C?",f":C))}}else if(e.invertExtent){var U=e.thresholds?e.thresholds():e.quantiles?e.quantiles():e.domain(),A=void 0===C?function(t){return t}:"string"==typeof C?d3.format(C):C;t=d3.scaleLinear().domain([-1,e.range().length-1]).rangeRound([y,o-h]),I.append("g").selectAll("rect").data(e.range()).join("rect").attr("x",(function(n,e){return t(e-1)})).attr("y",d).attr("width",(function(n,e){return t(e)-t(e-1)})).attr("height",l-d-p).attr("fill",(function(t){return t})),x=d3.range(U.length),C=function(t){return A(U[t],t)}}else t=d3.scaleBand().domain(e.domain()).rangeRound([y,o-h]),I.append("g").selectAll("rect").data(e.domain()).join("rect").attr("x",t).attr("y",d).attr("width",Math.max(0,t.bandwidth()-1)).attr("height",l-d-p).attr("fill",e),B=function(){};return I.append("g").attr("transform","translate(0,".concat(l-p,")")).call(d3.axisBottom(t).ticks(b,"string"==typeof C?C:void 0).tickFormat("function"==typeof C?C:void 0).tickSize(a).tickValues(x)).call(B).call((function(t){return t.select(".domain").remove()})).call((function(t){return t.append("text").classed("fdg-sidebar__label fdg-legend__label",!0).attr("x",y).attr("y",d+p-l-6).attr("fill","currentColor").attr("text-anchor","middle").attr("transform","translate(".concat(o/2,",0)")).attr("font-weight","bold").attr("font-size","1.25rem").text(i)})),I.node()}({color:this.colorScale,title:this.settings.colorBy.label,width:200,height:50,tickValues:[this.colorScale.domain()[0],(this.colorScale.domain()[1]-this.colorScale.domain()[0])/2,this.colorScale.domain()[1]]}));else if("categorical"===this.settings.colorBy.type){var n=this.legends.container.append("div").classed("fdg-legend fdg-legend--categorical",!0);n.append("div").classed("fdg-sidebar__label fdg-legend__label",!0).text(this.settings.colorBy.label);var e=n.append("svg").attr("width",200).attr("height",20*this.colorScale.domain().length).selectAll("g").data(this.colorScale.domain()).join("g");e.append("circle").attr("cx",20).attr("cy",(function(t,n){return 20*n+10})).attr("r",7).attr("fill",(function(n){return t.colorScale(n)})),e.append("text").attr("font-size","1rem").attr("x",35).attr("y",(function(t,n){return 20*n+12})).attr("alignment-baseline","middle").text((function(n){return"".concat(n," (n=").concat(t.metadata.id.filter((function(t){return t.category===n})).length,")")}))}else"frequency"===this.settings.colorBy.type&&(this.legends.color=gt.call(this,"color"),this.legends.size=gt.call(this,"size"),this.legends.both=gt.call(this,"both"))}function ft(){var t={container:this.containers.freqTable};return t.table=t.container.append("table"),t.thead=t.table.append("thead"),t.th=t.thead.append("th").classed("fdg-sidebar__label",!0).attr("colspan",2).text("Cumulative Number of Events"),t.tbody=t.table.append("tbody"),t.tr=t.tbody.selectAll("tr").data(this.metadata.event.slice(1)).join("tr"),t.td=t.tr.selectAll("td").data((function(t){return[t.value,t.cumulative]})).join("td").text((function(t){return"number"==typeof t?d3.format(",d")(t):t})),t}function pt(){var t=this.containers.svgBackground.append("g").classed("fdg-g fdg-g--orbits",!0);return t.append("defs").selectAll("filter").data(this.metadata.orbit).join("filter").attr("id",(function(t,n){return"orbit--".concat(n)})).append("feDropShadow").attr("dx",0).attr("dy",0).attr("stdDeviation",5).attr("flood-color","black"),t.selectAll("circle.orbit").data(this.metadata.orbit).enter().append("circle").classed("orbit",!0).attr("cx",(function(t){return t.cx})).attr("cy",(function(t){return t.cy})).attr("r",(function(t){return t.r})).attr("fill","none").attr("stroke","#aaa").attr("stroke-width",".5").style("filter",(function(t,n){return"url(#orbit--".concat(n,")")}))}function vt(){var t=this,n=this.containers.svgForeground.append("g").classed("fdg-g fdg-g--focus-annotations",!0).selectAll("g.fdg-focus-annotation").data(this.metadata.event).join("g").classed("fdg-focus-annotation",!0).attr("transform",(function(t){return"translate(".concat(t.x,",").concat(t.y,")")})),e=function(n){return Math.round(n.x)===Math.round(t.settings.orbitRadius/2)},i=function(n){return 1===n.order||Math.round(n.x)<Math.round(t.settings.width/2)},s=function(t){return e(t)?"middle":i(t)?"start":"end"},a=function(n){return Math.round(n.y)===Math.round(t.settings.height/2)},r=function(n){return Math.round(n.y)<Math.round(t.settings.height/2)};return["background","foreground"].forEach((function(o){var c=n.append("text").classed("fdg-focus-annotation__text fdg-focus-annotation__".concat(o),!0);c.style("transform",(function(t){return"translate(".concat(function(t){return e(t)?0:i(t)?"2em":"-2em"}(t),",").concat(function(t){return a(t)?0:r(t)?"-2em":"2em"}(t),")")}));var l=c.append("tspan").classed("fdg-focus-annotation__label",!0).attr("x",0).attr("text-anchor",(function(t){return s(t)})).text((function(t){return t.value})),u=c.append("tspan").classed("fdg-focus-annotation__event-count",!0).classed("fdg-hidden",!1===t.settings.eventCount).attr("x",0).attr("dy","1.3em").attr("text-anchor",(function(t){return s(t)}));"categorical"===t.settings.colorBy.type&&(c.style("transform",(function(t){return"translate(0,".concat(a(t)?"0":r(t)?"5em":"-5em",")")})),l.attr("text-anchor","middle"),u.attr("text-anchor","middle"))})),n}function yt(){lt.call(this),ht.call(this),this.containers.timer.text("".concat(this.settings.timepoint," ").concat(this.settings.timeUnit)),this.freqTable=ft.call(this),this.orbits=pt.call(this),this.focusAnnotations=vt.call(this)}function mt(){var t,n={},e=u(Object.keys(this.settings).filter((function(t){return/_var$/.test(t)})));try{for(e.s();!(t=e.n()).done;){var i=t.value;n[i.replace(/_var$/,"")]=this.data[0].hasOwnProperty(this.settings[i])}}catch(t){e.e(t)}finally{e.f()}return n}function bt(){var t=this;this.data.forEach((function(n){var e,i=u(Object.keys(t.settings).filter((function(t){return/_var$/.test(t)})));try{for(i.s();!(e=i.n()).done;){var s=e.value,a=s.replace(/_var$/,"");n[a]=["event_order","start_timepoint","end_timepoint","duration","sequence"].includes(a)?+n[t.settings[s]]:n[t.settings[s]]}}catch(t){i.e(t)}finally{i.f()}}))}function Ct(t){d3.nest().key((function(t){return t.id})).rollup((function(n){n.forEach((function(e,i){t.duration&&!t.start_timepoint&&(0===i?(e.start_timepoint=1,e.end_timepoint=e.duration):(e.start_timepoint=n[i-1].end_timepoint+1,e.end_timepoint=e.start_timepoint+e.duration-1)),t.start_timepoint&&!t.end_timepoint&&(e.end_timepoint=i<n.length-1?n[i+1].start_timepoint-1:e.duration?e.start_timepoint+e.duration-1:e.start_timepoint),!t.duration&&t.start_timepoint&&t.end_timepoint&&(e.duration=e.start_timepoint-e.end_timepoint+1)})),t.sequence?n.sort((function(t,n){return t.seq-n.seq})):n.sort((function(t,n){return t.start_timepoint-n.start_timepoint})).forEach((function(t,n){t.seq=n}))})).entries(this.data)}function xt(){var t=this.data.every((function(t){return/^-?\d+\.?\d*$/.test(t.id)||/^-?\d*\.?\d+$/.test(t.id)}));this.data.sort((function(n,e){var i=t?+n.id-+e.id:n.id<e.id?-1:e.id<n.id?1:0,s=n.seq-e.seq;return i||s}))}function It(){var t=mt.call(this);bt.call(this),Ct.call(this,t),xt.call(this)}function Bt(){var t=this;return d3.nest().key((function(t){return t.id})).rollup((function(n){var e=d3.sum(n,(function(t){return t.duration})),i="categorical"===t.settings.colorBy.type?n[0][t.settings.colorBy.variable]:null,s=A.call(t,n,0),a=1===n.length&&s.event===t.settings.eventCentral,o=t.metadata.event.find((function(t){return t.value===s.event})),c={x:o.x,y:o.y},l=Z.call(t,n,s,null);return r({group:n,duration:e,category:i,statePrevious:null,state:s,noStateChange:a,coordinates:c},l)})).entries(this.data)}function Qt(){var t=this;It.call(this),this.data.nested=Bt.call(this),this.metadata.event.forEach((function(n){n.data=t.data.nested.filter((function(t){return t.value.state.event===n.value}))}))}function Ft(t){return function(){return t}}function Ut(){var t,n,e,i,s,a,r,o,c=Ft(-30),l=0,u=1,d=1/0,g=function(){return 15},h=function(t){return Math.pow(t.length,.75)},f=function(t){return Math.pow(t.length,.25)},p=function(t){return t.length<100?1:t.length<200?3:Math.sqrt(t.length)},v=Math.random;function y(n){var e,i,a,r,o=Math.floor(v()*t.length),c=t[o],l=(n.x-c.x)*(n.x-c.x)+(n.y-c.y)*(n.y-c.y),u=-1/0,d=-1;if(!(n.nearest.indexOf(o)>=0))if(n.nearest.length<s)n.nearest.push(o);else{for(;++d<n.nearest.length;)e=n.nearest[d],i=t[e],(a=Math.hypot(n.x-i.x,n.y-i.y))>u&&(r=d,u=a);l<u&&(n.nearest[r]=o)}}function m(s){var a,c,l,g,h,f,p;for(c=function(n,e){e=Math.floor(e);var i,s,a,r=t.length,o=r-e;for(i=r-1;i>=o;--i)a=n[s=Math.floor(v()*i)],n[s]=n[i],n[i]=a;return n.slice(o)}(i,r),a=c.length-1;a>=0;--a)(l=t[c[a]])!==s&&((p=(h=l.x-s.x)*h+(f=l.y-s.y)*f)>=d||(0===h&&(p+=(h=1e-6*(v()-.5))*h),0===f&&(p+=(f=1e-6*(v()-.5))*f),p<u&&(p=Math.sqrt(u*p)),g=e[s.index]*n*o/p,s.vx+=h*g,s.vy+=f*g))}function b(i){var a,r,c,l,g,h,f;if(s&&y(i),r=i.nearest,s)for(a=r.length-1;a>=0;--a)(c=t[r[a]])!==i&&((f=(g=c.x-i.x)*g+(h=c.y-i.y)*h)>=d||(0===g&&(f+=(g=1e-6*(v()-.5))*g),0===h&&(f+=(h=1e-6*(v()-.5))*h),f<u&&(f=Math.sqrt(u*f)),l=e[i.index]*n*o/f,i.vx+=g*l,i.vy+=h*l))}function C(e){var i=0,r=l,o=t.length,c=l+a;for(n=e;i<o||r<c;++i,++r)r<c&&m(t[r%o]),s&&i<o&&b(t[i]);l=c%o}function x(){if(t){var l,u,d=t.length;for(i=new Array(d),l=0;l<d;++l)i[l]=l;for(e=new Array(d),s=(s=Math.min(Math.ceil(g(t)),d))<0?0:Math.min(s,t.length),a=(a=Math.ceil(h(t)))<0?0:Math.min(a,d),r=(r=Math.ceil(f(t)))<0?0:Math.min(r,d),o=p(t),n=1,l=0;l<d;++l)for(u=t[l],e[u.index]=+c(u,l,t),u.nearest=[];u.nearest.length<s;)y(u)}}return C.initialize=function(n){t=n,x()},C.strength=function(t){return arguments.length?(c="function"==typeof t?t:Ft(+t),x(),C):c},C.distanceMin=function(t){return arguments.length?(u=t*t,C):Math.sqrt(u)},C.distanceMax=function(t){return arguments.length?(d=t*t,C):Math.sqrt(d)},C.neighborSize=function(t){return arguments.length?(g="function"==typeof t?t:Ft(+t),x(),C):g},C.updateSize=function(t){return arguments.length?(h="function"==typeof t?t:Ft(+t),x(),C):h},C.sampleSize=function(t){return arguments.length?(f="function"==typeof t?t:Ft(+t),x(),C):f},C.chargeMultiplier=function(t){return arguments.length?(p="function"==typeof t?t:Ft(+t),x(),C):p},C.source=function(t){return arguments.length?(v=t,C):v},C}function At(){var t=this;this.containers.canvas.context.clearRect(0,0,this.settings.width,this.settings.height),this.containers.canvas.context.save(),this.data.nested.sort((function(t,n){return t.value.stateChanges-n.value.stateChanges})).forEach((function(n,e){t.containers.canvas.context.beginPath(),"circle"===t.settings.shape?(t.containers.canvas.context.moveTo(n.x+n.r,n.y),t.containers.canvas.context.arc(n.x,n.y,n.value.r,0,2*Math.PI),t.settings.fill&&(t.containers.canvas.context.fillStyle=n.value.fill,t.containers.canvas.context.fill()),t.containers.canvas.context.strokeStyle=n.value.stroke,t.containers.canvas.context.stroke()):(t.containers.canvas.context.rect(n.x-n.value.r,n.y-n.value.r,2*n.value.r,2*n.value.r),t.settings.fill&&(t.containers.canvas.context.fillStyle=n.value.fill,t.containers.canvas.context.fill()),t.containers.canvas.context.strokeStyle=n.value.stroke,t.containers.canvas.context.stroke())})),this.containers.canvas.context.restore()}function Lt(){this.forceSimulation=d3.forceSimulation().nodes(this.data.nested.filter((function(t){return!t.value.noStateChange}))).alphaDecay(.01).velocityDecay(.9).force("center",d3.forceCenter(this.settings.orbitRadius/2,this.settings.height/2)).force("x",d3.forceX().x((function(t){return t.value.coordinates.x})).strength(.3)).force("y",d3.forceY().y((function(t){return t.value.coordinates.y})).strength(.3)).force("charge",Ut().strength(5*this.settings.chargeStrength)).force("collide",d3.forceCollide().radius((function(t){return t.value.r+.5}))).on("tick",At.bind(this))}function St(){T.call(this),U.call(this),Lt.call(this),"play"===this.settings.playPause&&(this.interval=$.call(this))}return function(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"body",s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a={data:n,element:e,settings:Object.assign(i,s),util:t};return i.update.call(a),a.containers=G.call(a),a.metadata=X.call(a),yt.call(a),Qt.call(a),St.call(a),a}}));
